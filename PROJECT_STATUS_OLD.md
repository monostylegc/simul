# Spine Surgery Planner â€” í”„ë¡œì íŠ¸ ëª©í‘œ ë° ì›Œí¬í”Œë¡œìš°

ìµœì¢… ì—…ë°ì´íŠ¸: 2026-02-25 (CT/DICOM íŒŒì´í”„ë¼ì¸ End-to-End ê²€ì¦ + ë²„ê·¸ ìˆ˜ì •)

---

## í”„ë¡œì íŠ¸ ëª©í‘œ

**UBE/Biportal ë‚´ì‹œê²½ ì²™ì¶” ìˆ˜ìˆ  ê³„íš ë° ì‹œë®¬ë ˆì´ì…˜ ë„êµ¬**

í™˜ìì˜ CT/MRI ì˜ìƒìœ¼ë¡œë¶€í„° ìˆ˜ìˆ  ì „ ê³„íšì„ ìˆ˜ë¦½í•˜ê³ , ë‚˜ì‚¬/ì¼€ì´ì§€ ë“± ì„í”Œë€íŠ¸ ë°°ì¹˜ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ë©°, êµ¬ì¡°í•´ì„ì„ í†µí•´ ìˆ˜ìˆ  ì•ˆì „ì„±ì„ ì‚¬ì „ ê²€ì¦í•˜ëŠ” end-to-end í”Œë«í¼.

### í•µì‹¬ ê°€ì¹˜
- **ìˆ˜ìˆ  ì „ ê³„íš ìµœì í™”**: í™˜ìë³„ í•´ë¶€í•™ì  êµ¬ì¡°ì— ë§ì¶˜ ì„í”Œë€íŠ¸ ìœ„ì¹˜/í¬ê¸° ê²°ì •
- **êµ¬ì¡°ì  ì•ˆì „ì„± ê²€ì¦**: ìœ í•œìš”ì†Œ í•´ì„(FEM/PD/SPG)ìœ¼ë¡œ ë¼ˆ-ì„í”Œë€íŠ¸ ê³„ë©´ ì‘ë ¥ ì‚¬ì „ í‰ê°€
- **ì›¹ ê¸°ë°˜ í†µí•© í”Œë«í¼**: ë³„ë„ ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ì¹˜ ì—†ì´ ë¸Œë¼ìš°ì €ì—ì„œ ì „ì²´ ì›Œí¬í”Œë¡œìš° ìˆ˜í–‰
- **ë³‘ì› ë°°í¬ ëŒ€ì‘**: Windows í™˜ê²½ í˜¸í™˜, ì§ê´€ì  CAE ìŠ¤íƒ€ì¼ UI

### ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Three.js ì›¹ ì‹œë®¬ë ˆì´í„° (ë¸Œë¼ìš°ì €)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ main.js  â”‚ pre.js   â”‚ post.js  â”‚implant.jsâ”‚ voxel.js â”‚          â”‚
â”‚  â”‚ ì”¬/UI    â”‚ ì „ì²˜ë¦¬   â”‚ í›„ì²˜ë¦¬   â”‚ ì„í”Œë€íŠ¸ â”‚ ë³µì…€í™”   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚          â”‚          â”‚                                       â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                  â”‚ ws.js (WebSocket)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ JSON ì–‘ë°©í–¥ í†µì‹ 
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚ FastAPI ì„œë²„ (Python)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚     ws_handler.py (ë¼ìš°íŒ…)     â”‚                                  â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                                  â”‚
â”‚     â”‚        â”‚        â”‚        â”‚                                     â”‚
â”‚  â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ì„¸ê·¸ë©˜â”‚ â”‚ë©”ì‰¬ â”‚ â”‚ìë™  â”‚ â”‚í•´ì„         â”‚                         â”‚
â”‚  â”‚í…Œì´ì…˜â”‚ â”‚ì¶”ì¶œ â”‚ â”‚ì¬ë£Œ  â”‚ â”‚íŒŒì´í”„ë¼ì¸   â”‚                         â”‚
â”‚  â”‚íŒŒì´í”„â”‚ â”‚íŒŒì´í”„â”‚ â”‚ë§¤í•‘  â”‚ â”‚             â”‚                         â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚     â”‚       â”‚       â”‚       â”‚                                       â”‚
â”‚  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚           í†µí•© FEA í”„ë ˆì„ì›Œí¬ (Taichi GPU)               â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚       â”‚
â”‚  â”‚  â”‚ FEM â”‚  â”‚ Peridynamics â”‚  â”‚ SPG â”‚  â”‚Scene â”‚          â”‚       â”‚
â”‚  â”‚  â”‚ì •ì  â”‚  â”‚ NOSB-PD      â”‚  â”‚ë¬´ê²©ìâ”‚  â”‚ì ‘ì´‰  â”‚          â”‚       â”‚
â”‚  â”‚  â”‚ë™ì  â”‚  â”‚ íŒŒê´´í•´ì„     â”‚  â”‚ê·¹í•œë³€â”‚  â”‚í•´ì„  â”‚          â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## End-to-End ì›Œí¬í”Œë¡œìš° (7ë‹¨ê³„)

```
DICOM í´ë” â”€â”€â†’ [0] DICOMâ†’NIfTI ë³€í™˜ â”€â”€â†’ [1] ì„¸ê·¸ë©˜í…Œì´ì…˜ â”€â”€â†’ [2] 3D ëª¨ë¸ ìƒì„± â”€â”€â†’ [3] ìˆ˜ìˆ  ë„êµ¬ ë°°ì¹˜
                                                                                            â”‚
                                          [6] í›„ì²˜ë¦¬ ì‹œê°í™” â†â”€â”€ [5] êµ¬ì¡°í•´ì„ â†â”€â”€ [4] ì „ì²˜ë¦¬  â†â”˜
```

> **ì›í´ë¦­ ìë™í™”**: 0ë‹¨ê³„~2ë‹¨ê³„ëŠ” DICOM í´ë” ì„ íƒë§Œìœ¼ë¡œ ìë™ ì—°ì‡„ ì‹¤í–‰ ê°€ëŠ¥

### 0ë‹¨ê³„: DICOM ì›í´ë¦­ íŒŒì´í”„ë¼ì¸ â€” âœ… ì™„ë£Œ

ë³‘ì›ì—ì„œ DICOM í´ë”ë¥¼ ì„ íƒí•˜ë©´ ë³€í™˜â†’ì„¸ê·¸ë©˜í…Œì´ì…˜â†’ë©”ì‰¬ ì¶”ì¶œâ†’3D í‘œì‹œê¹Œì§€ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | DICOM í´ë” (webkitdirectoryë¡œ ë¸Œë¼ìš°ì €ì—ì„œ í´ë” ì„ íƒ) |
| **ì¶œë ¥** | 3D í‘œë©´ ë©”ì‰¬ (Three.js ë Œë”ë§) |
| **ìë™í™” ë‹¨ê³„** | DICOM ì—…ë¡œë“œ â†’ NIfTI ë³€í™˜ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ ë©”ì‰¬ ì¶”ì¶œ (4ë‹¨ê³„ ì—°ì‡„) |
| **DICOM ë³€í™˜** | SimpleITK `ImageSeriesReader` â€” ë³µìˆ˜ ì‹œë¦¬ì¦ˆ ì‹œ ìµœëŒ€ ìŠ¬ë¼ì´ìŠ¤ ìë™ ì„ íƒ |
| **Modality ê°ì§€** | DICOM íƒœê·¸ì—ì„œ CT/MR ìë™ ê°ì§€ â†’ ì—”ì§„ ìë™ ì„ íƒ (CTâ†’TotalSeg, MRâ†’TotalSpineSeg) |
| **GPU í´ë°±** | GPU ì‹¤íŒ¨ ì‹œ CPU ìë™ ì¬ì‹œë„ |
| **í•µì‹¬ íŒŒì¼** | `src/server/dicom_converter.py`, `src/server/ws_handler.py` |

**í”„ë¡œí† ì½œ**: REST `POST /api/upload_dicom` (íŒŒì¼ ì—…ë¡œë“œ) â†’ WS `run_dicom_pipeline` â†’ `pipeline_step` (ì§„í–‰ë¥ ) â†’ `pipeline_result` (ìµœì¢… ë©”ì‰¬)

---

### 1ë‹¨ê³„: ì„¸ê·¸ë©˜í…Œì´ì…˜ (CT/MRI â†’ ë¼ë²¨ë§µ) â€” âœ… ì™„ë£Œ

í™˜ìì˜ CT ë˜ëŠ” MRI ì˜ìƒì—ì„œ ì²™ì¶”ê³¨, ë””ìŠ¤í¬, ì—°ì¡°ì§ì„ ìë™ìœ¼ë¡œ ë¶„ë¥˜í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | CT/MRI NIfTI íŒŒì¼ (`.nii.gz`) |
| **ì¶œë ¥** | ë¼ë²¨ë§µ NIfTI (ê° ë³µì…€ì— SpineLabel ê°’ í• ë‹¹) |
| **ì§€ì› ì—”ì§„** | TotalSegmentator (CT), TotalSpineSeg (MRI), SpineUnified (CT+MRI í†µí•©, nnU-Net v2) |
| **ë¼ë²¨ ì²´ê³„** | `SpineLabel` IntEnum â€” ì²™ì¶”ê³¨ C1~Sacrum (101~125), ë””ìŠ¤í¬ C2C3~L5S1 (201~223), ì—°ì¡°ì§ (301~302) |
| **í•µì‹¬ API** | `create_engine("totalseg"|"totalspineseg"|"spine_unified")` â†’ `engine.segment(input, output)` |
| **í•µì‹¬ íŒŒì¼** | `src/segmentation/{factory.py, base.py, labels.py, totalseg.py, totalspineseg.py, nnunet_spine.py}` |

**ë°ì´í„° íë¦„**: NIfTI â†’ ì—”ì§„ë³„ ì¶”ë¡  â†’ ì—”ì§„ ê³ ìœ  ë¼ë²¨ â†’ `convert_to_standard()` â†’ SpineLabel í†µí•© ë¼ë²¨ë§µ

---

### 2ë‹¨ê³„: 3D ëª¨ë¸ ìƒì„± (ë¼ë²¨ë§µ â†’ í‘œë©´ ë©”ì‰¬) â€” âœ… ì™„ë£Œ

ë¼ë²¨ë§µì—ì„œ ê° í•´ë¶€í•™ì  êµ¬ì¡°ë¬¼ì˜ 3D í‘œë©´ ë©”ì‰¬ë¥¼ ì¶”ì¶œí•˜ì—¬ ì›¹ ë·°ì–´ì— í‘œì‹œí•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | ë¼ë²¨ë§µ NIfTI + ì¶”ì¶œí•  ë¼ë²¨ ëª©ë¡ |
| **ì¶œë ¥** | ë¼ë²¨ë³„ ë©”ì‰¬ `{vertices[][], faces[][], material_type, color}` |
| **ì•Œê³ ë¦¬ì¦˜** | scikit-image `marching_cubes` (ì´ì§„ë§ˆìŠ¤í¬ â†’ ì‚¼ê°í˜• í‘œë©´) |
| **í›„ì²˜ë¦¬** | ì„ íƒì  ê°€ìš°ì‹œì•ˆ í‰í™œí™” (`sigma=0.8`) |
| **ìƒ‰ìƒ êµ¬ë¶„** | bone `#e6d5c3`, disc `#6ba3d6`, soft_tissue `#f0a0b0` |
| **í•µì‹¬ API** | `extract_meshes(request, progress_callback)` |
| **í•µì‹¬ íŒŒì¼** | `src/server/mesh_extract_pipeline.py` |

**ë°ì´í„° íë¦„**: ë¼ë²¨ë§µ â†’ ë¼ë²¨ë³„ ì´ì§„ ë§ˆìŠ¤í¬ â†’ Marching Cubes â†’ í‘œë©´ ë©”ì‰¬ â†’ WebSocket â†’ Three.js BufferGeometry

---

### 3ë‹¨ê³„: ìˆ˜ìˆ  ë„êµ¬ ë°°ì¹˜ (ì„í”Œë€íŠ¸ ëª¨ë¸ë§) â€” âœ… ì™„ë£Œ

ë‚˜ì‚¬, ì¼€ì´ì§€, ë¡œë“œ ë“± ì„í”Œë€íŠ¸ STL ëª¨ë¸ì„ 3D í™˜ê²½ì—ì„œ ì§ì ‘ ë°°ì¹˜í•˜ê³  ìˆ˜ìˆ  ê³„íšì„ ì €ì¥í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | ì„í”Œë€íŠ¸ STL íŒŒì¼ + ì¬ë£Œ íƒ€ì… ì„ íƒ |
| **ì¶œë ¥** | ìˆ˜ìˆ  ê³„íš JSON `{implants: [{name, position[3], rotation[3], scale[3], material}]}` |
| **ì¸í„°ë™ì…˜** | TransformControls â€” ì´ë™(Translate) / íšŒì „(Rotate) / í¬ê¸°(Scale) ëª¨ë“œ ì „í™˜ |
| **ì¬ë£Œ í”„ë¦¬ì…‹** | titanium `#8899aa`, PEEK `#ccbb88`, cobalt-chrome `#99aacc`, stainless steel `#aaaaaa` |
| **ì €ì¥/ë³µì›** | `exportPlan()` â†’ JSON ë‹¤ìš´ë¡œë“œ, `importPlan(data)` â†’ ë³µì› |
| **ì¶”ê°€ ê¸°ëŠ¥** | êµ¬ì²´ ë“œë¦´(ë³µì…€ ì œê±°)ë¡œ ë¼ˆ ê°€ê³µ ì‹œë®¬ë ˆì´ì…˜, Undo/Redo ì§€ì› |
| **í•µì‹¬ íŒŒì¼** | `src/simulator/src/implant.js`, `src/simulator/src/voxel.js` |

**ë°ì´í„° íë¦„**: STL ë¡œë“œ â†’ Three.js Mesh ìƒì„± â†’ ì‚¬ìš©ì ë°°ì¹˜(ì´ë™/íšŒì „) â†’ ìˆ˜ìˆ  ê³„íš JSON ë‚´ë³´ë‚´ê¸°

---

### 4ë‹¨ê³„: ì „ì²˜ë¦¬ (ê²½ê³„ì¡°ê±´ + ì¬ë£Œ ì„¤ì •) â€” âœ… ì™„ë£Œ

í•´ì„ì„ ìœ„í•´ ê²½ê³„ì¡°ê±´(ê³ ì •/í•˜ì¤‘)ê³¼ ì¬ë£Œ ë¬¼ì„±ì„ ì„¤ì •í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | 3D ë©”ì‰¬/ë³µì…€ ëª¨ë¸ + ë¼ë²¨ë§µ |
| **ì¶œë ¥** | `AnalysisRequest {positions, volumes, boundary_conditions[], materials[], method}` |
| **ê²½ê³„ì¡°ê±´ ì„¤ì •** | (a) êµ¬ì²´ ë¸ŒëŸ¬ì‰¬: ë³µì…€ ë‹¨ìœ„ í˜ì¸íŒ… ì„ íƒ <br/> (b) ë©´ ì„ íƒ: BFS ê¸°ë°˜ ì—°ê²°ë©´ í™•ì¥ (ë²•ì„  ìœ ì‚¬ë„ cos(30Â°) ê¸°ì¤€) |
| **BC íƒ€ì…** | Fixed BC (ì´ˆë¡ ì‹œê°í™”) â€” ë³€ìœ„ êµ¬ì† <br/> Force BC (ë¹¨ê°• í™”ì‚´í‘œ) â€” í•˜ì¤‘ ì ìš© (Ctrl+ë“œë˜ê·¸ë¡œ ë°©í–¥ ì¡°ì •) |
| **ì¬ë£Œ í• ë‹¹** | ìë™: SpineLabel â†’ SPINE_MATERIAL_DB (8ì¢…) ìë™ ë§¤í•‘ (ì œì•ˆê°’) <br/> ìˆ˜ë™: E/Î½/Ï ì§ì ‘ í¸ì§‘ UI |
| **ì¬ë£Œ DB** | bone(15GPa), cancellous(1GPa), disc(10MPa), soft_tissue(1MPa), titanium(110GPa), PEEK(4GPa), cobalt-chrome(230GPa), stainless steel(200GPa) |
| **í•µì‹¬ íŒŒì¼** | `src/simulator/src/pre.js`, `src/server/auto_material.py` |

**ë°ì´í„° íë¦„**: ë³µì…€ ì„ íƒ â†’ BC ì ìš© â†’ ì¬ë£Œ í• ë‹¹ â†’ `buildAnalysisRequest(method)` â†’ AnalysisRequest JSON ì¡°ë¦½

---

### 5ë‹¨ê³„: êµ¬ì¡°í•´ì„ (FEA) â€” âœ… ì™„ë£Œ

í†µí•© FEA í”„ë ˆì„ì›Œí¬ë¡œ 3ê°€ì§€ í•´ì„ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì—¬ êµ¬ì¡° ì‘ë‹µì„ ê³„ì‚°í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | `AnalysisRequest {positions, volumes, method, boundary_conditions, materials}` |
| **ì¶œë ¥** | `{displacements[][], stress[], damage[], info{converged, iterations, elapsed_time}}` |
| **í•´ì„ ë°©ë²•** | **FEM** â€” ìœ í•œìš”ì†Œë²• (ì •ì /ë™ì , Newton-Raphson, Newmark-beta) <br/> **PD** â€” Peridynamics (NOSB-PD, ì¤€ì •ì /ëª…ì‹œì , íŒŒê´´ í•´ì„ ê°€ëŠ¥) <br/> **SPG** â€” Smoothed Particle Galerkin (ê·¹í•œ ë³€í˜•, ë¬´ê²©ìë²•) |
| **GPU ê°€ì†** | ìë™ ê°ì§€: CUDA â†’ Vulkan â†’ CPU í´ë°± |
| **ì •ë°€ë„** | ì „ì²´ f64 (ë°°ì •ë°€ë„) í†µì¼ |
| **ë‹¤ì¤‘ ë¬¼ì²´** | Scene API: ì´ì¢… ì†”ë²„ ê°„ ì ‘ì´‰ í•´ì„ (ë…¸ë“œ-ë…¸ë“œ í˜ë„í‹°, KDTree ê¸°ë°˜) |
| **ê°•ì²´** | RigidBody + PrescribedMotion: ê·œì • ìš´ë™(íšŒì „/ë³‘ì§„) ê°•ì²´, ë‚˜ì‚¬/ì„í”Œë€íŠ¸ ì‹œë®¬ë ˆì´ì…˜ |
| **ë§ˆì°° ì ‘ì´‰** | Coulomb ë§ˆì°°: penalty-regularized stick/slip, ì •ì /ë™ì  ë§ˆì°° ê³„ìˆ˜ |
| **ì§„í–‰ë¥ ** | WebSocket ì½œë°±: init â†’ setup â†’ bc â†’ material â†’ solving â†’ postprocess â†’ done |
| **í•µì‹¬ API** | `init()` â†’ `create_domain(Method.FEM|PD|SPG, ...)` â†’ `Solver(domain, material).solve()` |
| **í•µì‹¬ íŒŒì¼** | `src/server/analysis_pipeline.py`, `src/fea/framework/{runtime.py, domain.py, solver.py, scene.py}` |

**ë°ì´í„° íë¦„**: AnalysisRequest â†’ Taichi ì´ˆê¸°í™” â†’ Domain ìƒì„± â†’ BC/ì¬ë£Œ ì ìš© â†’ ì†”ë²„ ìˆ˜ë ´ â†’ ë³€ìœ„/ì‘ë ¥/ì†ìƒ â†’ WebSocket ì „ì†¡

---

### 6ë‹¨ê³„: í›„ì²˜ë¦¬ ì‹œê°í™” â€” âœ… ì™„ë£Œ

í•´ì„ ê²°ê³¼ë¥¼ 3D ì»¬ëŸ¬ë§µìœ¼ë¡œ ì‹œê°í™”í•˜ê³  ìˆ˜ìˆ  ì „/í›„ ë¹„êµ ë¶„ì„ì„ ìˆ˜í–‰í•œë‹¤.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì…ë ¥** | í•´ì„ ê²°ê³¼ `{displacements, stress, damage}` |
| **ì¶œë ¥** | Three.js Points Cloud (Jet ì»¬ëŸ¬ë§µ ì ìš©) + ì»¬ëŸ¬ë°” |
| **ì‹œê°í™” ëª¨ë“œ** | Displacement (ë³€ìœ„ í¬ê¸°) / Stress (von Mises ì‘ë ¥) / Damage (ì†ìƒ ì§€ìˆ˜ 0~1) |
| **ì¡°ì ˆ íŒŒë¼ë¯¸í„°** | ë³€ìœ„ í™•ëŒ€ë°°ìœ¨ (ê¸°ë³¸ 10Ã—), ì…ì í¬ê¸°, ì»¬ëŸ¬ë§µ ë²”ìœ„ |
| **ìˆ˜ìˆ  ì „/í›„ ë¹„êµ** | ìˆ˜ìˆ  ì „ ê²°ê³¼ ì €ì¥ â†’ ìˆ˜ìˆ  í›„ ê²°ê³¼ì™€ ì°¨ì´ ì‹œê°í™” |
| **ì˜ì—­ í•„í„°** | ì„í”Œë€íŠ¸ ì£¼ë³€ ë°˜ê²½ ì§€ì • â†’ í•´ë‹¹ ì˜ì—­ë§Œ ì‘ë ¥ ë¶„ì„ |
| **í•µì‹¬ íŒŒì¼** | `src/simulator/src/post.js`, `src/simulator/src/colormap.js` |

**ë°ì´í„° íë¦„**: í•´ì„ ê²°ê³¼ ìˆ˜ì‹  â†’ ëª¨ë“œë³„ ìŠ¤ì¹¼ë¼ ì •ê·œí™” â†’ Jet ì»¬ëŸ¬ë§µ ë³€í™˜ â†’ Points Cloud ë Œë”ë§ + ì»¬ëŸ¬ë°”

---

## í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
src/
â”œâ”€â”€ core/                          # í•µì‹¬ ìœ í‹¸ë¦¬í‹°
â”‚   â””â”€â”€ volume_io.py              # NIfTI/NPZ ë³¼ë¥¨ I/O
â”œâ”€â”€ fea/                          # ìœ í•œìš”ì†Œ/ë‹¤ì¤‘ ë¬¼ë¦¬ í•´ì„
â”‚   â”œâ”€â”€ fem/                      # ìœ í•œìš”ì†Œë²• (FEM)
â”‚   â”‚   â”œâ”€â”€ core/                # ë©”ì‰¬, ì ë¶„, ê¸°ë³¸ ìš”ì†Œ
â”‚   â”‚   â”œâ”€â”€ material/            # ì„ í˜• íƒ„ì„±, Neo-Hookean ì¬ë£Œ
â”‚   â”‚   â”œâ”€â”€ solver/              # ì •ì /ë™ì  ì†”ë²„ (Newton-Raphson, Newmark-Î², Central Diff)
â”‚   â”‚   â””â”€â”€ tests/               # FEM í…ŒìŠ¤íŠ¸ (39ê°œ)
â”‚   â”œâ”€â”€ peridynamics/            # Peridynamics (PD)
â”‚   â”‚   â”œâ”€â”€ core/                # ì…ì, ê²°í•©, ì†ìƒ, ì´ì›ƒ
â”‚   â”‚   â”œâ”€â”€ material/            # PD ì„ í˜• íƒ„ì„±
â”‚   â”‚   â”œâ”€â”€ solver/              # NOSB ëª…ì‹œì /ì¤€ì •ì  ì†”ë²„
â”‚   â”‚   â””â”€â”€ tests/               # PD í…ŒìŠ¤íŠ¸ (22ê°œ)
â”‚   â”œâ”€â”€ spg/                     # Smoothed Particle Galerkin (SPG)
â”‚   â”‚   â”œâ”€â”€ core/                # RKPM í˜•ìƒí•¨ìˆ˜, ì•ˆì •í™”ë ¥ ì»¤ë„
â”‚   â”‚   â”œâ”€â”€ material/            # SPG ì¬ë£Œ
â”‚   â”‚   â”œâ”€â”€ solver/              # SPG ëª…ì‹œì  ì†”ë²„
â”‚   â”‚   â””â”€â”€ tests/               # SPG í…ŒìŠ¤íŠ¸ (31ê°œ)
â”‚   â”œâ”€â”€ framework/               # í†µí•© í”„ë ˆì„ì›Œí¬ (í•µì‹¬ ì¸í„°í˜ì´ìŠ¤)
â”‚   â”‚   â”œâ”€â”€ runtime.py           # Taichi ëŸ°íƒ€ì„ ê´€ë¦¬ (GPU ìë™ ê°ì§€)
â”‚   â”‚   â”œâ”€â”€ domain.py            # í†µí•© Domain API (Method.FEM/PD/SPG)
â”‚   â”‚   â”œâ”€â”€ material.py          # í†µí•© Material í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ solver.py            # í†µí•© Solver ì¸í„°í˜ì´ìŠ¤
â”‚   â”‚   â”œâ”€â”€ scene.py             # ë‹¤ì¤‘ ë¬¼ì²´ ì ‘ì´‰ ì¥ë©´ ê´€ë¦¬
â”‚   â”‚   â”œâ”€â”€ contact.py           # ë…¸ë“œ-ë…¸ë“œ í˜ë„í‹° ì ‘ì´‰ (KDTree)
â”‚   â”‚   â”œâ”€â”€ result.py            # SolveResult ë°ì´í„° í´ë˜ìŠ¤
â”‚   â”‚   â””â”€â”€ _adapters/           # FEM/PD/SPG ì–´ëŒ‘í„° (Adapter íŒ¨í„´)
â”‚   â””â”€â”€ tests/                   # í†µí•© ë²¤ì¹˜ë§ˆí¬ (L4+disc+L5 ì••ì¶• ë“±)
â”œâ”€â”€ pipeline/                    # CLI íŒŒì´í”„ë¼ì¸ (Typer)
â”‚   â”œâ”€â”€ cli.py                   # 7ê°œ ì„œë¸Œì»¤ë§¨ë“œ (segment, solve, report, pipeline, server ë“±)
â”‚   â”œâ”€â”€ config.py                # Pydantic ì„¤ì • + TOML ë¡œë“œ
â”‚   â”œâ”€â”€ cache.py                 # SHA256 í•´ì‹œ ê¸°ë°˜ ìºì‹œ
â”‚   â””â”€â”€ stages/                  # ë‹¨ê³„ë³„ ì²˜ë¦¬ ëª¨ë“ˆ (segment, postprocess, voxelize, solve, report)
â”œâ”€â”€ segmentation/                # AI ì„¸ê·¸ë©˜í…Œì´ì…˜ ì—”ì§„
â”‚   â”œâ”€â”€ labels.py                # SpineLabel IntEnum (100ë²ˆëŒ€=ì²™ì¶”, 200ë²ˆëŒ€=ë””ìŠ¤í¬, 300ë²ˆëŒ€=ì—°ì¡°ì§)
â”‚   â”œâ”€â”€ factory.py               # create_engine("totalseg"|"totalspineseg"|"spine_unified")
â”‚   â”œâ”€â”€ totalseg.py              # TotalSegmentator ë˜í¼ (CT)
â”‚   â”œâ”€â”€ totalspineseg.py         # TotalSpineSeg ë˜í¼ (MRI)
â”‚   â”œâ”€â”€ nnunet_spine.py          # SpineUnified â€” nnU-Net v2 CT+MRI í†µí•©
â”‚   â””â”€â”€ training/                # í•™ìŠµ ë°ì´í„° ì¤€ë¹„ íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ server/                      # FastAPI ë°±ì—”ë“œ
â”‚   â”œâ”€â”€ app.py                   # REST(ì—…ë¡œë“œ) + WebSocket ì—”ë“œí¬ì¸íŠ¸ + ì •ì  íŒŒì¼ ì„œë¹™
â”‚   â”œâ”€â”€ models.py                # Pydantic ëª¨ë¸ (AnalysisRequest, SurgicalPlan ë“±)
â”‚   â”œâ”€â”€ ws_handler.py            # WebSocket ë©”ì‹œì§€ ë¼ìš°íŒ… (5ì¢… íŒŒì´í”„ë¼ì¸ í˜¸ì¶œ)
â”‚   â”œâ”€â”€ dicom_converter.py       # DICOMâ†’NIfTI ë³€í™˜ (SimpleITK, ë³µìˆ˜ ì‹œë¦¬ì¦ˆ ìë™ ì„ íƒ)
â”‚   â”œâ”€â”€ analysis_pipeline.py     # FEA í”„ë ˆì„ì›Œí¬ í˜¸ì¶œ íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ segmentation_pipeline.py # ì„¸ê·¸ë©˜í…Œì´ì…˜ ì—”ì§„ í˜¸ì¶œ (GPUâ†’CPU ìë™ í´ë°±)
â”‚   â”œâ”€â”€ mesh_extract_pipeline.py # Marching Cubes ë©”ì‰¬ ì¶”ì¶œ
â”‚   â”œâ”€â”€ auto_material.py         # SpineLabel â†’ ì¬ë£Œ ìë™ ë§¤í•‘ (8ì¢… DB)
â”‚   â””â”€â”€ tests/                   # ì„œë²„ í…ŒìŠ¤íŠ¸ (44ê°œ)
â””â”€â”€ simulator/                   # Three.js ì›¹ ì‹œë®¬ë ˆì´í„°
    â”œâ”€â”€ index.html               # ë©”ì¸ HTML (íƒ­ ê¸°ë°˜ CAE UI)
    â””â”€â”€ src/
        â”œâ”€â”€ main.js              # Three.js ì”¬/UI/ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (ë©”ì¸ ì—”íŠ¸ë¦¬)
        â”œâ”€â”€ pre.js               # PreProcessor â€” BC ì„¤ì •, ì¬ë£Œ í• ë‹¹, í•´ì„ ìš”ì²­ ì¡°ë¦½
        â”œâ”€â”€ post.js              # PostProcessor â€” ì»¬ëŸ¬ë§µ ì‹œê°í™”, ì „/í›„ ë¹„êµ
        â”œâ”€â”€ implant.js           # ImplantManager â€” STL ë°°ì¹˜, TransformControls
        â”œâ”€â”€ voxel.js             # VoxelGrid â€” ë³µì…€í™”, êµ¬ì²´ ë“œë¦´ë§
        â”œâ”€â”€ ws.js                # WSClient â€” WebSocket í†µì‹ 
        â”œâ”€â”€ colormap.js          # Jet ì»¬ëŸ¬ë§µ ìœ í‹¸ë¦¬í‹°
        â””â”€â”€ nrrd.js              # NRRD ë¡œë” (3D Slicer í˜¸í™˜)
```

---

## WebSocket í†µì‹  í”„ë¡œí† ì½œ

```
í´ë¼ì´ì–¸íŠ¸ â†’ ì„œë²„:
  {"type": "segment",             "data": SegmentationRequest}   # ì„¸ê·¸ë©˜í…Œì´ì…˜ ì‹¤í–‰
  {"type": "extract_meshes",      "data": MeshExtractRequest}    # 3D ë©”ì‰¬ ì¶”ì¶œ
  {"type": "auto_material",       "data": AutoMaterialRequest}   # ìë™ ì¬ë£Œ ë§¤í•‘
  {"type": "run_analysis",        "data": AnalysisRequest}       # FEA í•´ì„ ì‹¤í–‰
  {"type": "run_dicom_pipeline",  "data": DicomPipelineRequest}  # DICOM ì›í´ë¦­ ìë™í™”
  {"type": "ping"}                                               # ì—°ê²° í™•ì¸

REST ì—”ë“œí¬ì¸íŠ¸:
  POST /api/upload_dicom   files: List[UploadFile]  # DICOM ë‹¤ì¤‘ íŒŒì¼ ì—…ë¡œë“œ

ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸:
  {"type": "progress",         "data": {"step": "init|setup|bc|solving|done", ...}}
  {"type": "segment_result",   "data": {labels_path, n_labels, label_info[]}}
  {"type": "meshes_result",    "data": {meshes: [{vertices, faces, color}]}}
  {"type": "material_result",  "data": {materials: [{name, E, nu, density}]}}
  {"type": "result",           "data": {displacements, stress, damage, info}}
  {"type": "pipeline_step",    "data": {step, message, phase}}   # DICOM íŒŒì´í”„ë¼ì¸ ì§„í–‰ë¥ 
  {"type": "pipeline_result",  "data": {meshes, patient_info}}   # DICOM íŒŒì´í”„ë¼ì¸ ìµœì¢… ê²°ê³¼
  {"type": "error",            "data": {"message": "..."}}
```

---

## ê¸°ìˆ  ìŠ¤íƒ

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  |
|---------|------|
| **í”„ë¡ íŠ¸ì—”ë“œ** | Three.js (3D ë Œë”ë§), ES Modules, TransformControls |
| **ë°±ì—”ë“œ** | Python 3.13+, FastAPI, WebSocket, Pydantic |
| **í•´ì„ ì—”ì§„** | Taichi (GPU ê°€ì†), NumPy, SciPy |
| **ì„¸ê·¸ë©˜í…Œì´ì…˜** | TotalSegmentator, TotalSpineSeg, nnU-Net v2 |
| **ë©”ì‰¬ ì²˜ë¦¬** | scikit-image (Marching Cubes), STL ë¡œë” |
| **CLI** | Typer, Rich (ì½˜ì†” ì¶œë ¥) |
| **íŒ¨í‚¤ì§€ ê´€ë¦¬** | uv (ë¹Œë“œ: hatchling) |
| **í…ŒìŠ¤íŠ¸** | pytest (309 passed), Playwright (ì›¹ UI) |

---

## ì‹¤í–‰ ëª¨ë“œ

| ëª¨ë“œ | ëª…ë ¹ì–´ | ì„¤ëª… |
|------|--------|------|
| **ì›¹ í†µí•©** | `uv run spine-sim server --port 8000` | í•´ì„ ì„œë²„ + ì›¹ ì‹œë®¬ë ˆì´í„° í†µí•© |
| **ì›¹ ë‹¨ë…** | `cd src/simulator && python -m http.server 8080` | ì‹œë®¬ë ˆì´í„°ë§Œ (í•´ì„ ë¶ˆê°€) |
| **CLI íŒŒì´í”„ë¼ì¸** | `uv run spine-sim pipeline input.nii.gz -o output/` | CT â†’ í•´ì„ â†’ ë¦¬í¬íŠ¸ ìë™í™” |
| **ê°œë³„ ìŠ¤í…Œì´ì§€** | `uv run spine-sim segment|solve|report ...` | ë‹¨ê³„ë³„ ê°œë³„ ì‹¤í–‰ |

---

## ë‹¨ê³„ë³„ êµ¬í˜„ ìƒíƒœ ìš”ì•½

| ë‹¨ê³„ | ê¸°ëŠ¥ | ìƒíƒœ |
|------|------|------|
| 1. ì„¸ê·¸ë©˜í…Œì´ì…˜ | CT/MRI ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ (3 ì—”ì§„) | âœ… ì™„ë£Œ |
| 2. 3D ëª¨ë¸ ìƒì„± | Marching Cubes ë©”ì‰¬ ì¶”ì¶œ | âœ… ì™„ë£Œ |
| 3. ìˆ˜ìˆ  ë„êµ¬ ë°°ì¹˜ | ì„í”Œë€íŠ¸ STL ë°°ì¹˜ + ë“œë¦´ | âœ… ì™„ë£Œ |
| 4. ì „ì²˜ë¦¬ | BC ì„¤ì • + ì¬ë£Œ í• ë‹¹ | âœ… ì™„ë£Œ |
| 5. êµ¬ì¡°í•´ì„ | FEM/PD/SPG í†µí•© í”„ë ˆì„ì›Œí¬ | âœ… ì™„ë£Œ |
| 6. í›„ì²˜ë¦¬ | ì»¬ëŸ¬ë§µ ì‹œê°í™” + ë¹„êµ ë¶„ì„ | âœ… ì™„ë£Œ |
| â€” | ë‚´ì‹œê²½ ì‹œë®¬ë ˆì´ì…˜ (í¬íƒˆ ì‹œì•¼/ì‚¬ê°ì§€ëŒ€) | ğŸ”² ë¯¸êµ¬í˜„ |

---

# í”„ë¡œì íŠ¸ ì§„í–‰ ìƒí™©

ìµœì¢… ì—…ë°ì´íŠ¸: 2026-02-25

## ì˜¤ëŠ˜ ì‘ì—… ë‚´ì—­ (2026-02-25)

### ì™„ë£Œ

1. **êµ¬ì„± ëª¨ë¸(Constitutive Model) í™•ì¥ â€” Mooney-Rivlin + Ogden FEM êµ¬í˜„**

   ê¸°ì¡´ì— Linear Elastic + Neo-Hookeanë§Œ ì§€ì›í•˜ë˜ FEM ì¬ë£Œ ëª¨ë¸ì—
   **Mooney-Rivlin 2-íŒŒë¼ë¯¸í„° ì´ˆíƒ„ì„±**ê³¼ **1-term Ogden ì´ˆíƒ„ì„±** ëª¨ë¸ì„ ì‹ ê·œ êµ¬í˜„.

   - **`src/fea/fem/material/mooney_rivlin.py`** (ì‹ ê·œ 290ì¤„)
     - Ïˆ = C10Â·(Iâ‚-3) + C01Â·(Iâ‚‚-3) + (1/D1)Â·(J-1)Â²
     - Taichi GPU ì»¤ë„ (`@ti.data_oriented`) â€” compute_stress, compute_nodal_forces
     - `from_engineering(E, Î½)` ìë™ ë³€í™˜ ìœ í‹¸ë¦¬í‹°
   - **`src/fea/fem/material/ogden.py`** (ì‹ ê·œ 320ì¤„)
     - Ïˆ = (Î¼/Î±)Â·(Î»â‚^Î± + Î»â‚‚^Î± + Î»â‚ƒ^Î± - 3) + (1/D1)Â·(J-1)Â²
     - Cardano ê³µì‹ ê¸°ë°˜ 3D ê³ ìœ ì¹˜ ë¶„í•´ (B í…ì„œ â†’ ì£¼ì—°ì‹ ë¹„)
     - Rivlin-Ericksen í‘œí˜„ì‹ìœ¼ë¡œ ì‘ë ¥ í…ì„œ ì¬êµ¬ì„±
   - **`src/fea/fem/material/__init__.py`** â€” MooneyRivlin, Ogden export ì¶”ê°€

2. **í”„ë ˆì„ì›Œí¬ + ì„œë²„ êµ¬ì„± ëª¨ë¸ ë””ìŠ¤íŒ¨ì¹˜ í™•ì¥**

   - **`src/fea/framework/material.py`** â€” `constitutive_model` í•„ë“œ + `_create_fem_material()` ë¶„ê¸°
     (linear_elastic / neo_hookean / mooney_rivlin / ogden)
   - **`src/server/models/analysis.py`** â€” MaterialRegionì— constitutive_model Literal + C10/C01/D1/mu_ogden/alpha_ogden ì¶”ê°€
   - **`src/server/services/analysis.py`** â€” FEM ì¬ë£Œ ìƒì„±ì„ `FrameworkMaterial._create_fem_material()` ìœ„ì„ìœ¼ë¡œ ë³€ê²½

3. **í”„ë¡ íŠ¸ì—”ë“œ ë°ì´í„° ë ˆì´ì–´ í™•ì¥**

   - **`materials.svelte.ts`** â€” ConstitutiveModel íƒ€ì…, CONSTITUTIVE_MODELS ë©”íƒ€ì •ë³´,
     enuToMooneyRivlin/enuToOgden ë³€í™˜ ìœ í‹¸ë¦¬í‹°, MaterialEntry ì´ˆíƒ„ì„± íŒŒë¼ë¯¸í„° í•„ë“œ
   - **`PreProcessor.ts`** â€” ResolvedMaterialì— constitutiveModel + ì´ˆíƒ„ì„± íŒŒë¼ë¯¸í„°,
     buildAnalysisRequestì—ì„œ ì„œë²„ ì „ë‹¬ ì‹œ constitutive_model í¬í•¨

4. **MaterialLibraryPanel êµ¬ì„± ëª¨ë¸ ì„ íƒê¸° ì¶”ê°€**

   ì†ì„± í¸ì§‘ê¸°ì— "êµ¬ì„± ëª¨ë¸ (Constitutive Model)" ë“œë¡­ë‹¤ìš´ ì¶”ê°€:
   - **Linear Elastic / Neo-Hookean**: E/Î½/Ï ìŠ¬ë¼ì´ë” (ê¸°ì¡´)
   - **Mooney-Rivlin**: Câ‚â‚€/Câ‚€â‚/Dâ‚ ì§ì ‘ ì…ë ¥ + "E/Î½â†’ìë™ê³„ì‚°" ë²„íŠ¼
   - **Ogden**: Î¼/Î±/Dâ‚ ì§ì ‘ ì…ë ¥ + "E/Î½â†’ìë™ê³„ì‚°" ë²„íŠ¼
   - FEM ì „ìš© ê²½ê³  í‘œì‹œ ("âš  FEM ì „ìš© â€” PD/SPGì—ì„œëŠ” Linear Elasticìœ¼ë¡œ ëŒ€ì²´")

5. **SolvePanel ì¬ë£Œ UI í†µí•© â€” ë“œë¡­ë‹¤ìš´ ì œê±°**

   Solve íƒ­ì˜ ëª¨ë¸ë³„ ì¬ë£Œ `<select>` ë“œë¡­ë‹¤ìš´ì„ ì½ê¸° ì „ìš© ìš”ì•½ìœ¼ë¡œ êµì²´.
   ì¬ë£Œ ë³€ê²½ì€ Pre-process íƒ­ì—ì„œë§Œ ê°€ëŠ¥í•˜ë„ë¡ ë‹¨ì¼í™”.
   - "â€» ì¬ë£Œ ë³€ê²½ì€ Pre-process íƒ­ì—ì„œ" ì•ˆë‚´ ë¬¸êµ¬ ì¶”ê°€
   - `handleMaterialChange`, `getModelMaterialKey`, materialLibrary import ì œê±°
   - ì¬ë£Œ ë¼ë²¨ + íˆ´íŒ (ëª¨ë¸ëª…/E/Î½ í‘œì‹œ)

   **ìˆ˜ì • íŒŒì¼ ì´ê´„**:
   | íŒŒì¼ | ë³€ê²½ |
   |------|------|
   | `src/fea/fem/material/mooney_rivlin.py` | ì‹ ê·œ |
   | `src/fea/fem/material/ogden.py` | ì‹ ê·œ |
   | `src/fea/fem/material/__init__.py` | ìˆ˜ì • |
   | `src/fea/framework/material.py` | ìˆ˜ì • |
   | `src/server/models/analysis.py` | ìˆ˜ì • |
   | `src/server/services/analysis.py` | ìˆ˜ì • |
   | `src/frontend/src/lib/stores/materials.svelte.ts` | ìˆ˜ì • |
   | `src/frontend/src/lib/analysis/PreProcessor.ts` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/MaterialLibraryPanel.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/SolvePanel.svelte` | ìˆ˜ì • |

   **ë¹Œë“œ**: 0 ì—ëŸ¬, í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì •ìƒ í†µê³¼
   **UI í…ŒìŠ¤íŠ¸**: êµ¬ì„± ëª¨ë¸ ì„ íƒ/ì „í™˜, íŒŒë¼ë¯¸í„° ìë™ê³„ì‚°, Assign Material, Solve íƒ­ ì½ê¸° ì „ìš© í‘œì‹œ ê²€ì¦ ì™„ë£Œ

6. **Material ì „ìš© ì‚¬ì´ë“œë°” íƒ­ ì‹ ì„¤**

   ê¸°ì¡´ Pre-process íƒ­ì— ë¼ì›Œì ¸ ìˆë˜ ì¬ë£Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë…ë¦½ íƒ­ìœ¼ë¡œ ë¶„ë¦¬.
   ì‚¬ì´ë“œë°” ì „ì²´ ë†’ì´ë¥¼ í™œìš©í•´ ì¬ë£Œ ë¦¬ìŠ¤íŠ¸ + í¸ì§‘ê¸°ë¥¼ ë„‰ë„‰í•˜ê²Œ í‘œì‹œ.

   - **`MaterialPanel.svelte`** (ì‹ ê·œ 460ì¤„) â€” ì „ìš© ì¬ë£Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬ íƒ­
     - ì¹´í…Œê³ ë¦¬ íƒ­ (ì „ì²´/ë¼ˆ/ë””ìŠ¤í¬/ì„í”Œë€íŠ¸/ì—°ì¡°ì§/ì»¤ìŠ¤í…€) + ê²€ìƒ‰
     - ì¬ë£Œ ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ (êµ¬ì„± ëª¨ë¸ ë°°ì§€ í‘œì‹œ)
     - êµ¬ì„± ëª¨ë¸ ì„ íƒê¸° (Linear Elastic / Neo-Hookean / Mooney-Rivlin / Ogden)
     - ê¸°ë³¸ ë¬¼ì„± ì°¸ì¡° ì„¹ì…˜ (MR/Ogden ì‹œ E/Î½ í‘œì‹œ)
     - ëŒ€ìƒ ëª¨ë¸ ì„ íƒ + Assign Material ë²„íŠ¼
     - ì»¤ìŠ¤í…€ ì €ì¥/ì´ˆê¸°í™” ê¸°ëŠ¥
   - **`ui.svelte.ts`** â€” TabId: `'view'` â†’ `'material'`ë¡œ ë³€ê²½
   - **`Menubar.svelte`** â€” íƒ­ ë°°ì—´ì—ì„œ Viewâ†’Material êµì²´
   - **`Sidebar.svelte`** â€” ViewPanelâ†’MaterialPanel import/ë¶„ê¸° êµì²´
   - **íƒ­ ìˆœì„œ**: File / Modeling / Material / Pre-process / Solve / Post-process

7. **View í”Œë¡œíŒ… ë©”ë‰´ (3D ë·°í¬íŠ¸ ìš°ìƒë‹¨)**

   ì‚¬ì´ë“œë°”ì—ì„œ View íƒ­ì„ ì œê±°í•˜ê³ , 3D ë·°í¬íŠ¸ ìš°ìƒë‹¨ í”Œë¡œíŒ… ë©”ë‰´ë¡œ ì´ë™.
   ì ‘ê¸°/í¼ì¹˜ê¸° í† ê¸€ (ê¸°ë³¸: ì ‘í˜) + ë°˜íˆ¬ëª… ê¸€ë˜ìŠ¤ UI.

   - **`ViewFloatingMenu.svelte`** (ì‹ ê·œ 310ì¤„)
     - Camera preset (F/Bk/T/Bo/L/R + Reset)
     - ë°°ê²½ìƒ‰ ë“œë¡­ë‹¤ìš´, ë Œë”ëª¨ë“œ (Solid/Wire/S+W)
     - Opacity/Light ìŠ¬ë¼ì´ë”
     - Grid/Axes í† ê¸€ + Screenshot ë²„íŠ¼
     - `position: absolute; top: 8px; right: 8px;` + `backdrop-filter: blur(10px)`
   - **`Canvas3D.svelte`** â€” ViewFloatingMenu import + ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ì‚½ì…
   - **`ViewPanel.svelte`** â€” ì‚­ì œ (ViewFloatingMenuë¡œ ëŒ€ì²´)

8. **PreProcessPanel ì¬ë£Œ UI ì œê±°**

   MaterialLibraryPanel import/ì‚¬ìš© ì œê±°, BC ê´€ë ¨ ê¸°ëŠ¥ë§Œ ì”ì¡´.
   "ğŸ’¡ ì¬ë£Œ ì„¤ì •ì€ Material íƒ­ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤" ì•ˆë‚´ + ë§í¬ ë²„íŠ¼ ì¶”ê°€.
   - **`MaterialLibraryPanel.svelte`** â€” ì‚­ì œ (MaterialPanelë¡œ ëŒ€ì²´)

9. **SolvePanel íŒíŠ¸ í…ìŠ¤íŠ¸ ìˆ˜ì •**

   "â€» ì¬ë£Œ ë³€ê²½ì€ Pre-process íƒ­ì—ì„œ" â†’ "â€» ì¬ë£Œ ë³€ê²½ì€ Material íƒ­ì—ì„œ"

   **ìˆ˜ì •/ì‹ ê·œ/ì‚­ì œ íŒŒì¼ ì´ê´„**:
   | íŒŒì¼ | ë³€ê²½ |
   |------|------|
   | `src/frontend/src/components/sidebar/MaterialPanel.svelte` | ì‹ ê·œ |
   | `src/frontend/src/components/floating/ViewFloatingMenu.svelte` | ì‹ ê·œ |
   | `src/frontend/src/lib/stores/ui.svelte.ts` | ìˆ˜ì • |
   | `src/frontend/src/components/Menubar.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/Sidebar.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/Canvas3D.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/PreProcessPanel.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/SolvePanel.svelte` | ìˆ˜ì • |
   | `src/frontend/src/components/sidebar/ViewPanel.svelte` | ì‚­ì œ |
   | `src/frontend/src/components/sidebar/MaterialLibraryPanel.svelte` | ì‚­ì œ |

   **ë¹Œë“œ**: 0 ì—ëŸ¬, í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ ì •ìƒ í†µê³¼
   **UI í…ŒìŠ¤íŠ¸**: Material íƒ­ ì¬ë£Œ ë¦¬ìŠ¤íŠ¸/í¸ì§‘ê¸°/êµ¬ì„±ëª¨ë¸, View í”Œë¡œíŒ… ë©”ë‰´ ì ‘ê¸°/í¼ì¹˜ê¸°, Pre-process BCì „ìš©, Solve íŒíŠ¸ í…ìŠ¤íŠ¸ ê²€ì¦ ì™„ë£Œ

10. **CT/DICOM íŒŒì´í”„ë¼ì¸ End-to-End ê²€ì¦ ë° ë²„ê·¸ ìˆ˜ì •**

    ì‹¤ì œ CT DICOM íŒŒì¼(L-spine, 129ìŠ¬ë¼ì´ìŠ¤)ì„ ì‚¬ìš©í•˜ì—¬ ì „ì²´ íŒŒì´í”„ë¼ì¸ ê²€ì¦.
    3ê°€ì§€ í•µì‹¬ ë²„ê·¸ë¥¼ ë°œê²¬ ë° ìˆ˜ì •í•˜ì—¬ íŒŒì´í”„ë¼ì¸ ì •ìƒ ë™ì‘ í™•ì¸.

    **ë°œê²¬ ë° ìˆ˜ì •í•œ ë²„ê·¸**:

    - **Bug #1: í”„ë¡ íŠ¸ì—”ë“œ-ë°±ì—”ë“œ ë©”ì‰¬ ë°ì´í„° í˜•ì‹ ë¶ˆì¼ì¹˜**
      - ë°±ì—”ë“œ: `vertices`/`faces` ì¸ë¼ì¸ ë°°ì—´ ì§ì ‘ ë°˜í™˜
      - í”„ë¡ íŠ¸ì—”ë“œ: `mesh.path`ë¡œ STL URL ì ‘ê·¼ ì‹œë„ â†’ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨
      - **ìˆ˜ì •**: `loadMeshFromInlineData()` í•¨ìˆ˜ ì‹ ê·œ êµ¬í˜„ â€” ì¸ë¼ì¸ vertices/facesì—ì„œ Three.js BufferGeometry ì§ì ‘ ìƒì„±
      - ìˆ˜ì • íŒŒì¼: `types.ts`, `loading.ts`, `pipeline.ts`, `pipeline.svelte.ts`

    - **Bug #2: ì„¸ê·¸ë©˜í…Œì´ì…˜ ì¶œë ¥ ê²½ë¡œ ë¶ˆì¼ì¹˜**
      - `segmentation.py`ê°€ ì—”ì§„ ë°˜í™˜ ê²½ë¡œë¥¼ ë¬´ì‹œí•˜ê³  ê³ ì • `labels.nii.gz` íŒŒì¼ì—ì„œ ì½ìœ¼ë ¤ í•¨
      - TotalSpineSegëŠ” `step2_output/` í•˜ìœ„ì— ê²°ê³¼ ì €ì¥ â†’ FileNotFoundError
      - **ìˆ˜ì •**: `engine.segment()` ë°˜í™˜ê°’(ì‹¤ì œ ê²½ë¡œ) ì‚¬ìš© + fallback íƒìƒ‰ ë¡œì§ ì¶”ê°€
      - ìˆ˜ì • íŒŒì¼: `segmentation.py`

    - **Bug #3: SpineLabel ê°’ ë§¤í•‘ ì˜¤ë¥˜ (í…ŒìŠ¤íŠ¸)**
      - í…ŒìŠ¤íŠ¸ì—ì„œ L4=120, L5=121ë¡œ ì˜ëª» ì‚¬ìš© â†’ ì‹¤ì œëŠ” L4=123, L5=124
      - E2E í…ŒìŠ¤íŠ¸ ìˆ˜ì •

    **ì‹¤ì œ CT íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ê²°ê³¼**:
    ```
    DICOM: 512x512x129, L-spine CT (spacing 0.29mm/2.0mm)
    ì„¸ê·¸ë©˜í…Œì´ì…˜: TotalSpineSeg (CPU) â†’ 8ê°œ êµ¬ì¡°ë¬¼, ~6ë¶„ 30ì´ˆ
      â— L1, L2, L3, SACRUM (ë¼ˆ 4ê°œ)
      â— L1L2, L2L3, L5S1 (ë””ìŠ¤í¬ 3ê°œ)
      â— SPINAL_CANAL (ì—°ì¡°ì§ 1ê°œ)
    ë©”ì‰¬ ì¶”ì¶œ: ~790K ì •ì , ~1.5M ë©´ (Marching Cubes + Gaussian smoothing)
    ```

    **í…ŒìŠ¤íŠ¸ í˜„í™©**: ì „ì²´ 52ê°œ í…ŒìŠ¤íŠ¸ í†µê³¼ (ê¸°ì¡´ 44 + E2E ì‹ ê·œ 8)

    **ìˆ˜ì •/ì‹ ê·œ íŒŒì¼ ì´ê´„**:
    | íŒŒì¼ | ë³€ê²½ |
    |------|------|
    | `src/server/services/segmentation.py` | ìˆ˜ì • â€” ì—”ì§„ ë°˜í™˜ ê²½ë¡œ ì‚¬ìš© + fallback |
    | `src/frontend/src/lib/ws/types.ts` | ìˆ˜ì • â€” PipelineMeshData ì¸í„°í˜ì´ìŠ¤ ì‹ ê·œ |
    | `src/frontend/src/lib/actions/loading.ts` | ìˆ˜ì • â€” loadMeshFromInlineData() ì‹ ê·œ, centerMeshesAtOrigin export |
    | `src/frontend/src/lib/actions/pipeline.ts` | ìˆ˜ì • â€” ì¸ë¼ì¸ ë°ì´í„° ë¡œë”© ë°©ì‹ìœ¼ë¡œ ì „í™˜ |
    | `src/frontend/src/lib/stores/pipeline.svelte.ts` | ìˆ˜ì • â€” extractedMeshes íƒ€ì… ë³€ê²½ |
    | `src/server/tests/test_pipeline_e2e.py` | ì‹ ê·œ â€” E2E í…ŒìŠ¤íŠ¸ 8ê°œ |

---

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-24)

### ì™„ë£Œ

1. **ë ˆê±°ì‹œ `src/simulator/` ì •ë¦¬ â€” ë°°í¬ ê²½ë¡œ ë²„ê·¸ ìˆ˜ì • (ê°œì„  #1)**

   Svelte 5 + Vite ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ ì´í›„ì—ë„ êµ¬í˜• ë°”ë‹ë¼ JS íŒŒì¼ë“¤ì´ ì”ì¡´í•˜ê³ ,
   `GET /`ê°€ ë ˆê±°ì‹œ `index.html`ì„ ë°˜í™˜í•˜ëŠ” **í”„ë¡œë•ì…˜ ë¼ìš°íŒ… ë²„ê·¸**ê°€ ì¡´ì¬í–ˆë‹¤.
   (`STATIC_DIR = src/simulator/` â†” `outDir = ../simulator/dist` ê²½ë¡œ ë¶ˆì¼ì¹˜)

   - **STL ë³´ì¡´**: `cantilever_beam.stl`, `cylinder.stl` â†’ `src/frontend/public/stl/` ë³µì‚¬
     (Vite build ì‹œ `public/` ìë™ ë³µì‚¬ë¡œ `src/simulator/stl/`ì— í¬í•¨ë¨)
   - **ë ˆê±°ì‹œ íŒŒì¼ ì‚­ì œ**:
     - `src/simulator/src/` â€” êµ¬í˜• ë°”ë‹ë¼ JS 8ê°œ (main.js, voxel.js, pre.js, post.js, implant.js, nrrd.js, colormap.js, ws.js) ì „ë¶€ Svelte lib/ë¡œ í¬íŒ… ì™„ë£Œ
     - `src/simulator/index.html` â€” ë ˆê±°ì‹œ HTML
     - `src/simulator/tests/` â€” êµ¬í˜• JS ì‹œë®¬ë ˆì´í„° í…ŒìŠ¤íŠ¸ 4ê°œ
     - `src/simulator/dist/` â€” êµ¬ ë¹Œë“œ ì‚°ì¶œë¬¼
     - `src/simulator/stl/` â€” public/stl/ë¡œ ì´ë™ ì™„ë£Œ
   - **`vite.config.ts` ìˆ˜ì •** (1ì¤„): `outDir: '../simulator/dist'` â†’ `'../simulator'`
     `emptyOutDir: true`ê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë¹Œë“œ ì‹œ ìë™ ì •ë¦¬
   - **ê²°ê³¼**: `npm run build` í›„ `src/simulator/` = `index.html` (Svelte) + `assets/` + `stl/` 5ê°œ

   **ìˆ˜ì • íŒŒì¼**:
   - `src/frontend/vite.config.ts` (outDir 1ì¤„ ìˆ˜ì •)
   - `src/frontend/public/stl/cantilever_beam.stl` (ì‹ ê·œ ë³µì‚¬)
   - `src/frontend/public/stl/cylinder.stl` (ì‹ ê·œ ë³µì‚¬)

   **ì‚­ì œ íŒŒì¼**:
   - `src/simulator/src/` ì „ì²´ (8ê°œ JS)
   - `src/simulator/index.html`, `src/simulator/tests/` ì „ì²´
   - `src/simulator/dist/` ì „ì²´, `src/simulator/stl/` ì „ì²´

   **ê²€ì¦**: `uv run python -X utf8 -c "from src.server.app import app; print(app.title)"` â†’ ì •ìƒ

---

2. **`asyncio.get_event_loop()` â†’ `get_running_loop()` ìˆ˜ì • (ê°œì„  #2)**

   Python 3.10+ì—ì„œ `async` í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `asyncio.get_event_loop()`ë¥¼ í˜¸ì¶œí•˜ë©´ DeprecationWarning ë°œìƒ.
   ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ë£¨í”„ê°€ ìˆì„ ë•ŒëŠ” `asyncio.get_running_loop()`ë¥¼ ì¨ì•¼ í•œë‹¤.

   - `_run_in_thread()` (line 109): `get_event_loop()` â†’ `get_running_loop()`
   - `_handle_dicom_pipeline()` (line 204): ë™ì¼ ìˆ˜ì •

   **ìˆ˜ì • íŒŒì¼**: `src/server/ws_handler.py` (2ì¤„)
   **ê²€ì¦**: 44/44 í…ŒìŠ¤íŠ¸ í†µê³¼, DeprecationWarning ì—†ìŒ

---

3. **CORS `allow_origins=["*"]` â†’ í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ (ê°œì„  #3)**

   ë³‘ì› ë°°í¬ í™˜ê²½ì—ì„œ `["*"]`ëŠ” ë³´ì•ˆ ìœ„í—˜. `SPINE_SIM_CORS_ORIGINS` í™˜ê²½ë³€ìˆ˜ë¡œ ì œì–´.

   - **`config.py`**: `CORS_ORIGINS` ì¶”ê°€
     - ë¯¸ì„¤ì • ì‹œ ê°œë°œ ê¸°ë³¸ê°’: `localhost:5174` (Vite dev) + `localhost:8000` (FastAPI)
     - ì„¤ì • ì‹œ: ì½¤ë§ˆ êµ¬ë¶„ íŒŒì‹± (ì˜ˆ: `https://hospital.example.com,https://www.hospital.example.com`)
   - **`app.py`**: `allow_origins=CORS_ORIGINS`, `allow_methods`/`allow_headers`ë„ ìµœì†Œ í•„ìš” í•­ëª©ìœ¼ë¡œ ëª…ì‹œ

   **ìˆ˜ì • íŒŒì¼**: `src/server/config.py`, `src/server/app.py`
   **ê²€ì¦**: 44/44 í…ŒìŠ¤íŠ¸ í†µê³¼

---

4. **PD/SPG ì…ì ì¢Œí‘œ ë²„ê·¸ ìˆ˜ì • (ê°œì„  #4)**

   ë³µì…€ ê¸°ë°˜ PD/SPG í•´ì„ ì‹œ ì‹¤ì œ ë³µì…€ ì¢Œí‘œê°€ ë¬´ì‹œë˜ê³  ê· ë“± ê·¸ë¦¬ë“œë¡œ ëŒ€ì²´ë˜ë˜ ê·¼ë³¸ ë²„ê·¸ ìˆ˜ì •.

   **ë²„ê·¸ ì›ì¸ (3ì¤‘ ë¶ˆì¼ì¹˜)**:
   - `group_positions` (ì‹¤ì œ ë³µì…€ ì¤‘ì‹¬ ì¢Œí‘œ, ë¶ˆê·œì¹™) â† í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ë‹¬
   - `create_domain` â†’ `_positions` = ê· ë“± ê·¸ë¦¬ë“œ (ë³µì…€ ë¬´ì‹œ)
   - `PDAdapter/SPGAdapter` â†’ `initialize_from_grid` â†’ ë˜ ë‹¤ë¥¸ ê· ë“± ê·¸ë¦¬ë“œ ìƒì„± (domain._positions ì™„ì „ ë¬´ì‹œ)
   - BC `global_to_local` â†’ ê·¸ë£¹ ë‚´ ìˆœë²ˆ(0..n-1) â†’ ì–´ëŒ‘í„° ê·¸ë¦¬ë“œ ì¸ë±ìŠ¤ì™€ **ë¶ˆì¼ì¹˜**
   - ë°˜í™˜ `positions=group_positions` â†” `displacements`(ê·¸ë¦¬ë“œ ê¸°ì¤€) â†’ **ì™„ì „ ë¶ˆì¼ì¹˜**

   **ìˆ˜ì • ë°©ì‹**: `domain._custom_positions` ì‹ í˜¸ í”Œë˜ê·¸
   - `_run_particle_region`: `create_domain` ì§í›„ `domain._custom_positions = group_positions.copy()` ì„¤ì •
   - `PDAdapter.__init__`: `_custom_positions` ê°ì§€ ì‹œ `ParticleSystem.initialize_from_arrays(custom_pos, volumes)` ì‚¬ìš©
   - `SPGAdapter.__init__`: ë™ì¼ íŒ¨í„´
   - `global_to_local` ë§¤í•‘: `_custom_positions` ì‚¬ìš© ì‹œ ë¡œì»¬ ì¸ë±ìŠ¤ = ê·¸ë£¹ ë‚´ ìˆœë²ˆ â†’ **ì¼ê´€ì„± ë³´ì¥**

   **ìˆ˜ì • íŒŒì¼ (3ê°œ)**:
   - `src/server/services/analysis.py` â€” `domain._custom_positions` ì„¤ì •
   - `src/fea/framework/_adapters/pd_adapter.py` â€” `_custom_positions` ë¶„ê¸°
   - `src/fea/framework/_adapters/spg_adapter.py` â€” `_custom_positions` ë¶„ê¸°

   **ê²€ì¦**: 44/44 ì„œë²„ í…ŒìŠ¤íŠ¸ í†µê³¼, domain._custom_positions ë‹¨ìœ„ ê²€ì¦ í†µê³¼

---

5. **`pipeline/solve.py` â†” `services/analysis.py` ì¤‘ë³µ ì œê±° (ê°œì„  #5)**

   ë‘ íŒŒì¼ì´ ë°”ìš´ë”©ë°•ìŠ¤ + n_divisions ê³„ì‚° + `create_domain` + `_custom_positions` ì„¤ì • íŒ¨í„´ì„ ê°ê° êµ¬í˜„.
   ë˜í•œ `SolveStage`ì— ê°œì„  #4 ë²„ê·¸í”½ìŠ¤(ê· ë“± ê·¸ë¦¬ë“œ â†’ ì‹¤ì œ ë³µì…€ ì¢Œí‘œ)ê°€ ë¯¸ì ìš©ëœ ìƒíƒœì˜€ìŒ.

   **`create_particle_domain()` í—¬í¼ ì¶”ì¶œ â€” `src/fea/framework/domain.py` ì¶”ê°€**
   - ì…ì ì¢Œí‘œ ë°°ì—´ â†’ ë°”ìš´ë”©ë°•ìŠ¤ â†’ n_divisions ì¶”ì • â†’ `create_domain` â†’ `_custom_positions` ì„¤ì •
   - `get_positions()` ìˆ˜ì •: `_custom_positions` ìš°ì„  ë°˜í™˜ (select() ë“± ë„ë©”ì¸ API ì „ì²´ ì¼ê´€ì„±)
   - ë‘ íŒŒì¼ì´ ê³µí†µ í—¬í¼ ì‚¬ìš© â†’ ê°œì„  #4 ë¡œì§ì´ í•œ ê³³ì—ë§Œ ì¡´ì¬

   **`services/analysis.py` (`_run_particle_region`)**:
   - ë°”ìš´ë”©ë°•ìŠ¤ ê³„ì‚° 6ì¤„ + `create_domain` 5ì¤„ + `_custom_positions` 3ì¤„ ì œê±°
   - `domain = create_particle_domain(group_positions, method=method_enum)` 1ì¤„ë¡œ ëŒ€ì²´

   **`pipeline/stages/solve.py` (`SolveStage.run`)**:
   - ë°”ìš´ë”©ë°•ìŠ¤ ê³„ì‚° 4ì¤„ + n_divisions ì¶”ì • 2ì¤„ + `create_domain` 7ì¤„ ì œê±°
   - `domain = create_particle_domain(positions, method=method)` 1ì¤„ë¡œ ëŒ€ì²´
   - **ê°œì„  #4 ë²„ê·¸í”½ìŠ¤ ë™ì‹œ ì ìš©**: ê· ë“± ê·¸ë¦¬ë“œ ëŒ€ì‹  ì‹¤ì œ NPZ ì…ì ì¢Œí‘œ ì‚¬ìš©

   **ìˆ˜ì • íŒŒì¼ (3ê°œ)**:
   - `src/fea/framework/domain.py` â€” `create_particle_domain()` ì¶”ê°€, `get_positions()` ìˆ˜ì •
   - `src/server/services/analysis.py` â€” 25ì¤„ â†’ 3ì¤„
   - `src/pipeline/stages/solve.py` â€” 18ì¤„ â†’ 4ì¤„

   **ê²€ì¦**: 72/72 í…ŒìŠ¤íŠ¸ í†µê³¼ (ì„œë²„ 44 + íŒŒì´í”„ë¼ì¸ 28), `create_particle_domain` ë‹¨ìœ„ ê²€ì¦ í†µê³¼

---

6. **`PostProcessor.ts` 1048ì¤„ â†’ 4ê°œ ëª¨ë“ˆ ë¶„ë¦¬ (ê°œì„  #6)**

   1048ì¤„ì§œë¦¬ ëª¨ë†€ë¦¬ì‹ í´ë˜ìŠ¤ë¥¼ ì—­í• ë³„ë¡œ 4ê°œ íŒŒì¼ë¡œ ë¶„ë¦¬.
   Three.js ì—†ëŠ” ìˆœìˆ˜ í•¨ìˆ˜ëŠ” ë³„ë„ ëª¨ë“ˆë¡œ ì¶”ì¶œí•˜ì—¬ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„± í™•ë³´.

   | íŒŒì¼ | ì—­í•  | ì¤„ ìˆ˜ |
   |------|------|-------|
   | `PostProcessorTypes.ts` (ì‹ ê·œ) | íƒ€ì…/ì¸í„°í˜ì´ìŠ¤ ì „ìš© | 43ì¤„ |
   | `HEX8Utils.ts` (ì‹ ê·œ) | HEX8 ê¸°í•˜ ìœ í‹¸ (í‘œë©´ ì‚¼ê°í˜• ì¶”ì¶œ) | 60ì¤„ |
   | `ScalarMapper.ts` (ì‹ ê·œ) | ìˆœìˆ˜ í•¨ìˆ˜ â€” ìŠ¤ì¹¼ë¼ ì¶”ì¶œ/í†µê³„/í•„í„° | 260ì¤„ |
   | `PostProcessor.ts` (ì¬ì‘ì„±) | Three.js ë Œë”ë§ í´ë˜ìŠ¤ + re-export | 730ì¤„ |

   **`ScalarMapper.ts` ìˆœìˆ˜ í•¨ìˆ˜ (Three.js ì˜ì¡´ ì—†ìŒ)**:
   - `extractComponent(vectors, component)` â€” ë²¡í„° â†’ ìŠ¤ì¹¼ë¼ ì»´í¬ë„ŒíŠ¸ ì¶”ì¶œ
   - `getFEMNodeScalars / getParticleScalars / getLegacyScalars / getAllScalars`
   - `computeStats(data, mode, component)` â†’ `PostProcessStats`
   - `applyPointFilters(positions, scalars, threshold, clipConfig, bbox)` â€” PD/SPG í•„í„°
   - `isTriangleVisible(tri, deformed, nodeScalars, threshold, clipConfig, bbox)` â€” FEM í•„í„°

   **`PostProcessor.ts` í•˜ìœ„í˜¸í™˜ re-export**:
   ```typescript
   export type { PostProcessMode, VectorComponent, ... } from './PostProcessorTypes';
   ```
   ê¸°ì¡´ import ê²½ë¡œ (`from './PostProcessor'`) ë³€ê²½ ì—†ì´ ë™ì‘.

   **ìˆ˜ì •/ì‹ ê·œ íŒŒì¼ (4ê°œ)**:
   - `src/frontend/src/lib/analysis/PostProcessorTypes.ts` (ì‹ ê·œ)
   - `src/frontend/src/lib/analysis/HEX8Utils.ts` (ì‹ ê·œ)
   - `src/frontend/src/lib/analysis/ScalarMapper.ts` (ì‹ ê·œ)
   - `src/frontend/src/lib/analysis/PostProcessor.ts` (ì¬ì‘ì„±)

   **ë¹Œë“œ ê²€ì¦**: `npm run build` âœ“ 151 ëª¨ë“ˆ, 1.08s, ê²½ê³ /ì—ëŸ¬ 0

---

7. **`guideline.py` / `implants.py` â†’ í”„ë¡ íŠ¸ì—”ë“œ ì—°ê²° (ê°œì„  #7)**

   `src/core/`ì—ë§Œ ì¡´ì¬í•˜ë˜ ì„í”Œë€íŠ¸ 3D ë©”ì‰¬ ìƒì„±Â·ìˆ˜ìˆ  ê°€ì´ë“œë¼ì¸ ì‹œê°í™” ë¡œì§ì„
   WebSocket APIë¡œ í”„ë¡ íŠ¸ì—”ë“œì— ì—°ê²°í•˜ê³  ModelingPanelì— UIë¥¼ ì¶”ê°€í–ˆë‹¤.

   **ë°±ì—”ë“œ ì¶”ê°€**:
   - **`models/surgical.py`**: `ScrewSpecModel`, `CageSpecModel`, `ImplantMeshRequest`, `GuidelineRequest` ì¶”ê°€
   - **`services/implants.py`** (ì‹ ê·œ): `generate_implant_mesh()` â€” ìŠ¤í¬ë¥˜/ì¼€ì´ì§€/ë¡œë“œ ë©”ì‰¬ â†’ JSON
   - **`services/guideline.py`** (ì‹ ê·œ): `generate_guideline_meshes()` â€” ì–‘ì¸¡ ê°€ì´ë“œë¼ì¸ ë©”ì‰¬ ëª©ë¡ â†’ JSON
   - **`ws_handler.py`**: `get_implant_mesh` / `get_guideline_meshes` ë‘ ëª…ë ¹ í•¸ë“¤ëŸ¬ ì¶”ê°€

   **í”„ë¡ íŠ¸ì—”ë“œ ì¶”ê°€**:
   - **`ws/types.ts`**: `MeshData`, `ImplantMeshResult`, `GuidelineMeshResult` ì¸í„°í˜ì´ìŠ¤,
     `WSMessageType`Â·`WSRequestType` í™•ì¥ (implant_mesh_result / guideline_meshes_result)
   - **`ws/client.ts`**: `onImplantMeshResult()` / `onGuidelineMeshResult()` ì½œë°± ë“±ë¡ ë©”ì„œë“œ ì¶”ê°€
   - **`actions/implants.ts`** (ì‹ ê·œ): `initImplantLayer()`, `requestScrew()`, `requestCage()`,
     `requestGuidelines()`, `clearImplants()`, `clearGuidelines()`, `getImplantCount()`
     â€” ìˆ˜ì‹  ë©”ì‰¬ë¥¼ `THREE.BufferGeometry + MeshPhongMaterial`ë¡œ ë³€í™˜í•˜ì—¬ ì”¬ì— ì¶”ê°€
   - **`ModelingPanel.svelte`**: 3ê°œ ì„¹ì…˜ ì¶”ê°€
     - Bone Drill: ê¸°ì¡´ ë“œë¦´ + ë°˜ê²½ ìŠ¬ë¼ì´ë” (í†µí•©)
     - Implants: ìŠ¤í¬ë¥˜(M5~M7) / ì¼€ì´ì§€(SÂ·MÂ·LÂ·XL) ê·œê²© ì„ íƒ + Add ë²„íŠ¼ + Clear
     - Pedicle Guidelines: ì²™ì¶” ë ˆë²¨(L1~S1) + ë‚´ì¸¡ê° + ì‚½ì…ê¹Šì´ ìŠ¬ë¼ì´ë” + Show/Clear

   **ìˆ˜ì •/ì‹ ê·œ íŒŒì¼ (9ê°œ)**:
   - `src/server/models/surgical.py`, `models/__init__.py`
   - `src/server/services/implants.py`, `services/guideline.py` (ì‹ ê·œ)
   - `src/server/ws_handler.py`
   - `src/frontend/src/lib/ws/types.ts`, `ws/client.ts`
   - `src/frontend/src/lib/actions/implants.ts` (ì‹ ê·œ)
   - `src/frontend/src/components/sidebar/ModelingPanel.svelte`

   **ê²€ì¦**:
   - ë°±ì—”ë“œ: ìŠ¤í¬ë¥˜(322ì •ì /640ë©´), ì¼€ì´ì§€(8ì •ì /12ë©´), L4 ê°€ì´ë“œë¼ì¸(6ê°œ ë©”ì‰¬) ìƒì„± í™•ì¸
   - ì„œë²„ í…ŒìŠ¤íŠ¸: 44/44 í†µê³¼
   - Vite ë¹Œë“œ: âœ“ 152 ëª¨ë“ˆ, 1.07s, ê²½ê³ /ì—ëŸ¬ 0

---

8. **E2E UI í…ŒìŠ¤íŠ¸ â€” Claude Desktop ë¸Œë¼ìš°ì € ë„êµ¬ í™œìš© (ê°œì„  #8)**

   Playwright MCP(`mcp__Claude_Preview__*`) ë„êµ¬ë¡œ Svelte í”„ë¡ íŠ¸ì—”ë“œ ì „ íƒ­ì„ ìë™ ê²€ì¦í–ˆë‹¤.
   ë³„ë„ í…ŒìŠ¤íŠ¸ ë°”ì´ë„ˆë¦¬ ì„¤ì¹˜ ì—†ì´ Claude Desktop ë‚´ì¥ ë¸Œë¼ìš°ì € ê¸°ëŠ¥ì„ í™œìš©.

   **í…ŒìŠ¤íŠ¸ í™˜ê²½**:
   - ì„œë²„: Vite dev server (port 5174, `.claude/launch.json` "frontend")
   - ë„êµ¬: `preview_start`, `preview_screenshot`, `preview_snapshot`, `preview_eval`, `preview_console_logs`

   **ê²€ì¦ í•­ëª© ë° ê²°ê³¼**:

   | í•­ëª© | ê²°ê³¼ |
   |------|------|
   | í˜ì´ì§€ ë¡œë“œ | âœ… Spine Surgery Planner UI ì •ìƒ ë Œë”ë§ |
   | JS ëŸ°íƒ€ì„ ì—ëŸ¬ | âœ… ì—†ìŒ |
   | íƒ­ ë„¤ë¹„ê²Œì´ì…˜ 6ê°œ | âœ… File / Modeling / Pre-process / Solve / Post-process / View |
   | **Modeling** â€” Bone Drill ì„¹ì…˜ | âœ… Drill ON/OFF í† ê¸€, ìƒíƒœ ë°” "Drill mode: Click to drill" ë°˜ì‘ |
   | **Modeling** â€” Implants ì„¹ì…˜ | âœ… Screw(M5Ã—40~M7Ã—55), Cage(S/M/L/XL) ë“œë¡­ë‹¤ìš´ + Add/Clear ë²„íŠ¼ |
   | **Modeling** â€” Pedicle Guidelines ì„¹ì…˜ | âœ… ì²™ì¶”(L1~S1), ë‚´ì¸¡ê°, ì‚½ì…ê¹Šì´ ìŠ¬ë¼ì´ë” + Show/Clear ë²„íŠ¼ |
   | **Modeling** â€” History ì„¹ì…˜ | âœ… Undo(0)/Redo(0) ë¹„í™œì„± í‘œì‹œ |
   | **Pre-process** íŒ¨ë„ | âœ… Brush Selection, Fixed BC, Force BC(í¬ê¸°/ë°©í–¥) ëª¨ë‘ í‘œì‹œ |
   | **Solve** íŒ¨ë„ | âœ… Server Disconnected ìƒíƒœ, Checklist, FEM/PD/SPG ì†”ë²„ ì„¤ëª… |
   | **Post-process** íŒ¨ë„ | âœ… "í•´ì„ ê²°ê³¼ ì—†ìŒ" ë¹ˆ ìƒíƒœ ì •ìƒ |
   | **View** íŒ¨ë„ | âœ… Camera Preset(7ë°©í–¥), Background, Grid/Axes í—¬í¼ ì²´í¬ë°•ìŠ¤ |
   | FPS | âœ… 60+ ìœ ì§€ |

   **ìˆ˜ì • íŒŒì¼**: ì—†ìŒ (í…ŒìŠ¤íŠ¸ ì „ìš©)

---

6. **ë°±ì—”ë“œ ì²´ê³„ì  ì¬êµ¬ì„± â€” í”„ë¡ íŠ¸ì—”ë“œì™€ ë™ì¼í•œ ê³„ì¸µ êµ¬ì¡° ì ìš©**

   í‰ë©´ì ìœ¼ë¡œ ë‚˜ì—´ëœ `src/server/` íŒŒì¼ë“¤ì„ `config â†’ models/ â†’ services/` ê³„ì¸µìœ¼ë¡œ ë¶„ë¦¬.
   `/tmp/spine_sim` Windows ë¹„í˜¸í™˜ ê²½ë¡œ ìˆ˜ì •, ëª¨ë¸ ì¤‘ë³µ ì œê±°, DICOM íŒŒì´í”„ë¼ì¸ ì„œë¹„ìŠ¤ ë¶„ë¦¬.

   - **config.py (ì‹ ê·œ)**: `UPLOAD_DIR` í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ (`~/.spine_sim` ê¸°ë³¸ê°’, Windows í˜¸í™˜)
   - **models/ íŒ¨í‚¤ì§€ (ì‹ ê·œ)**: `analysis.py` / `surgical.py` / `imaging.py` ë„ë©”ì¸ë³„ ë¶„ë¦¬
     - `BoundaryCondition`ìœ¼ë¡œ `RegionBC` ì¤‘ë³µ í†µí•©, `__init__.py`ì—ì„œ ì „ì²´ re-export
   - **services/ íŒ¨í‚¤ì§€ (ì‹ ê·œ)**: íŒŒì´í”„ë¼ì¸ í•¨ìˆ˜ 6ê°œ ì´ë™ + `dicom_pipeline.py` ì‹ ê·œ ì¶”ì¶œ
     - `dicom_pipeline.py`: ws_handler 114ì¤„ ì¸ë¼ì¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ â†’ ë™ê¸° ì„œë¹„ìŠ¤ í•¨ìˆ˜
   - **ws_handler.py**: ìˆœìˆ˜ WS ë””ìŠ¤íŒ¨ì²˜ë¡œ ì •ë¦¬ (services ìœ„ì„)
   - **app.py**: configì—ì„œ ê²½ë¡œ ì„í¬íŠ¸, ë¶ˆí•„ìš”í•œ import ì •ë¦¬
   - **í…ŒìŠ¤íŠ¸ ì„í¬íŠ¸ ê²½ë¡œ ì—…ë°ì´íŠ¸**: test_auto_material, test_dicom_converter, test_mesh_extract

   **ê²°ê³¼**: 44/44 í…ŒìŠ¤íŠ¸ í†µê³¼, FastAPI ì•± ì„í¬íŠ¸ ì •ìƒ

   **ìˆ˜ì •/ì‹ ê·œ íŒŒì¼**:
   - `src/server/config.py` (ì‹ ê·œ)
   - `src/server/models/__init__.py`, `analysis.py`, `surgical.py`, `imaging.py` (ì‹ ê·œ)
   - `src/server/services/__init__.py`, `analysis.py`, `segmentation.py`, `mesh_extract.py`,
     `auto_material.py`, `dicom_convert.py`, `dicom_pipeline.py` (ì‹ ê·œ)
   - `src/server/app.py`, `ws_handler.py` (ìˆ˜ì •)
   - `src/server/tests/test_auto_material.py`, `test_dicom_converter.py`, `test_mesh_extract.py`,
     `test_segmentation_pipeline.py` (ì„í¬íŠ¸ ê²½ë¡œ ìˆ˜ì •)

   **ì‚­ì œ íŒŒì¼** (services/ë¡œ ì´ë™):
   - `src/server/models.py`, `analysis_pipeline.py`, `segmentation_pipeline.py`,
     `mesh_extract_pipeline.py`, `auto_material.py`, `dicom_converter.py`

---

2. **FEM ë³¼ë¥¨ ë©”ì‰¬ íŒŒì´í”„ë¼ì¸ êµ¬í˜„ â€” ë³µì…€ â†’ HEX8 ì§ì ‘ ë³€í™˜**

   í•µì‹¬ ê°œì„ : FEM í•´ì„ ì‹œ ë³µì…€ ê·¸ë¦¬ë“œì—ì„œ HEX8 ë³¼ë¥¨ ë©”ì‰¬ë¥¼ ì§ì ‘ ìƒì„±í•˜ì—¬ FEMeshì— ì „ë‹¬.
   PD/SPGëŠ” ê¸°ì¡´ëŒ€ë¡œ í¬ì¸íŠ¸ í´ë¼ìš°ë“œ ì‚¬ìš©. ê²°ê³¼ ì‹œê°í™”ë„ ì†”ë²„ íƒ€ì…ë³„ë¡œ ë¶„ë¦¬.

   - **PreProcessor.ts**: `buildFEMMesh()` ë©”ì„œë“œ ì¶”ê°€
     - ì±„ì›Œì§„ ë³µì…€ 1ê°œ = HEX8 ìš”ì†Œ 1ê°œ
     - ì¸ì ‘ ë³µì…€ ê°„ ì½”ë„ˆ ë…¸ë“œ ê³µìœ  (compact ë²ˆí˜¸ ë¶€ì—¬)
     - BC ë§¤í•‘: FEM â†’ 8ê°œ ì½”ë„ˆ ë…¸ë“œ, PD/SPG â†’ ì…ì ì¸ë±ìŠ¤
   - **models.py**: `MaterialRegion`ì— `nodes`, `elements`, `boundary_conditions` í•„ë“œ ì¶”ê°€
   - **analysis_pipeline.py**: ì™„ì „ ì¬ì‘ì„±
     - `_run_fem_region()`: FEMesh.initialize_from_numpy(nodes, elements) ì§ì ‘ ì‚¬ìš©
     - `_run_particle_region()`: PD/SPG ì…ì ê¸°ë°˜ ë„ë©”ì¸
     - ê²°ê³¼: `fem_regions[]`, `particle_regions[]` êµ¬ì¡°í™”ëœ ì˜ì—­ë³„ ê²°ê³¼
   - **PostProcessor.ts**: FEM + í¬ì¸íŠ¸ í˜¼í•© ì‹œê°í™”
     - FEM: HEX8 í‘œë©´ ì¶”ì¶œ â†’ THREE.Mesh (vertex colors + Phong lighting)
     - PD/SPG: THREE.Points (í¬ì¸íŠ¸ í´ë¼ìš°ë“œ)
     - extractSurfaceTriangles(): ë‚´ë¶€ ë©´ ì œê±°, ì™¸ë¶€ ë©´ë§Œ ì‚¼ê°í˜•í™”
   - **ws/types.ts**: `FEMRegionResult`, `ParticleRegionResult` íƒ€ì… ì¶”ê°€

   **ìˆ˜ì • íŒŒì¼ (6ê°œ)**:
   - `src/frontend/src/lib/analysis/PreProcessor.ts` â€” HEX8 ë©”ì‰¬ ìƒì„± + ì˜ì—­ë³„ BC
   - `src/frontend/src/lib/analysis/PostProcessor.ts` â€” ë©”ì‰¬ í‘œë©´ + í¬ì¸íŠ¸ ì‹œê°í™”
   - `src/frontend/src/lib/ws/types.ts` â€” FEM/ì…ì ì˜ì—­ ê²°ê³¼ íƒ€ì…
   - `src/frontend/src/lib/actions/analysis.ts` â€” FEM ì „ìš© ìš”ì²­ ì²˜ë¦¬
   - `src/server/models.py` â€” MaterialRegion FEM í•„ë“œ
   - `src/server/analysis_pipeline.py` â€” ì˜ì—­ë³„ FEM/PD/SPG ë¶„ë¦¬ ì‹¤í–‰

---

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-14)

### ì™„ë£Œ

3. **GPU ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• + ì‹¤ì œ CT ê²€ì¦** â€” í…ŒìŠ¤íŠ¸ 132ê°œ ì „ì²´ passed

   RTX 4070 Ti SUPER 16GB GPU í™œìš©, TotalSpineSegë¡œ **ì²™ì¶”ê³¨+ë””ìŠ¤í¬+ì²™ìˆ˜+ì²™ì¶”ê´€** ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜.

   - **PyTorch CUDA í™œì„±í™”**: CPUâ†’CUDA 12.4 ì „í™˜ (`torch 2.6.0+cu124`)
     - `pyproject.toml`ì— `[[tool.uv.index]]` CUDA ì¸ë±ìŠ¤ ì„¤ì •
     - AMD GPU ë¨¸ì‹ : `uv pip install torch torchvision --index-url .../rocm6.3`ìœ¼ë¡œ ì˜¤ë²„ë¼ì´ë“œ
   - **TotalSpineSeg ì—”ì§„ ì—…ê·¸ë ˆì´ë“œ** (`src/segmentation/totalspineseg.py`)
     - `supported_modalities`: MRIë§Œ â†’ **CT+MRI** ë‘˜ ë‹¤ ì§€ì›
     - venv ë‚´ ìŠ¤í¬ë¦½íŠ¸ ê²½ë¡œ ìë™ íƒìƒ‰ (Windows í˜¸í™˜)
     - GPU ë©”ëª¨ë¦¬ ê²©ë¦¬ (subprocess ì‹¤í–‰)
   - **ê¸°ë³¸ ì—”ì§„ ë³€ê²½**: `totalseg`(ì²™ì¶”ê³¨ë§Œ) â†’ `totalspineseg`(ë””ìŠ¤í¬ í¬í•¨)
     - `models.py`: SegmentationRequest ê¸°ë³¸ ì—”ì§„ ë³€ê²½
     - `ws_handler.py`: DICOM íŒŒì´í”„ë¼ì¸ auto â†’ totalspineseg (CT/MRI ë¬´ê´€)
     - `index.html`: í”„ë¡ íŠ¸ì—”ë“œ ì—”ì§„ ì„ íƒ UI ì—…ë°ì´íŠ¸
   - **TotalSpineSeg í™•ì¥ ë¼ë²¨ ë§¤í•‘ ë³´ì™„** (`labels.py`)
     - ì²œê³¨ ì„¸ë¶€ ë¶„ì ˆ (41~49) â†’ SACRUM, ì²œê³¨ ë””ìŠ¤í¬ (91~95) â†’ L5S1
     - ì²™ì¶”ê´€ ë¼ë²¨ 100 â†’ SPINAL_CANAL
   - **ì‹¤ì œ ìš”ì¶” CT ì„¸ê·¸ë©˜í…Œì´ì…˜ ê²€ì¦ ì™„ë£Œ** (512x512x151, L-spine 2.0mm)
     - GPU(RTX 4070 Ti Super) 159ì´ˆ ì†Œìš”
     - ê²€ì¶œ: L1, L2, L3, SACRUM + L1L2, L2L3, L5S1 ë””ìŠ¤í¬ + ì²™ì¶”ê´€
     - ì´ 3,676,564 non-zero voxels, 8ê°œ êµ¬ì¡°ë¬¼ 3D ë©”ì‰¬ ì¶”ì¶œ ì™„ë£Œ

   **ìˆ˜ì • íŒŒì¼ (6ê°œ)**:
   - `pyproject.toml` â€” CUDA ì¸ë±ìŠ¤ + torch/torchvision/totalspineseg ì˜ì¡´ì„±
   - `src/segmentation/totalspineseg.py` â€” CT+MRI ì§€ì›, venv ê²½ë¡œ íƒìƒ‰
   - `src/server/models.py` â€” ê¸°ë³¸ ì—”ì§„ totalspineseg
   - `src/server/ws_handler.py` â€” auto â†’ totalspineseg
   - `src/simulator/index.html` â€” ì—”ì§„ ì„ íƒ UI
   - `src/server/tests/` â€” ê¸°ë³¸ ì—”ì§„ í…ŒìŠ¤íŠ¸ ì—…ë°ì´íŠ¸

2. **nnU-Net v2 ëª¨ë¸ í•™ìŠµ íŒŒì´í”„ë¼ì¸ êµ¬í˜„** â€” í…ŒìŠ¤íŠ¸ 44ê°œ ì „ì²´ passed

   ì›ë³¸ ë°ì´í„°ì…‹(VerSe2020/CTSpine1K/SPIDER) â†’ nnU-Net í˜•ì‹ ë³€í™˜ â†’ í•™ìŠµ ì‹¤í–‰ê¹Œì§€ì˜ ì „ì²´ íŒŒì´í”„ë¼ì¸.

   - **ì›ë³¸ ë¼ë²¨ ë§¤í•‘ ì¶”ê°€** (`src/segmentation/labels.py`)
     - `VERSE_TO_STANDARD`: VerSe2020 (1~28) â†’ SpineLabel
     - `CTSPINE1K_TO_STANDARD`: CTSpine1K (1~25) â†’ SpineLabel
     - `build_spider_mapping()`: SPIDER ìƒëŒ€ ìˆœë²ˆ â†’ SpineLabel ë™ì  ë§¤í•‘

   - **ë°ì´í„°ì…‹ ì¼€ì´ìŠ¤ íƒìƒ‰** (ì‹ ê·œ: `src/segmentation/training/dataset_crawl.py`)
     - `CaseInfo` dataclass: ì¼€ì´ìŠ¤ ID, ì˜ìƒ/ë¼ë²¨ ê²½ë¡œ, ë°ì´í„°ì…‹, ëª¨ë‹¬ë¦¬í‹°
     - `crawl_verse2020/crawl_ctspine1k/crawl_spider/crawl_all`: ë°ì´í„°ì…‹ë³„ íŒŒì¼ íƒìƒ‰

   - **ë°ì´í„° ì¤€ë¹„ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜** (ì‹ ê·œ: `src/segmentation/training/run_pipeline.py`)
     - CT: NIfTIâ†’ë¼ë²¨ë³€í™˜â†’(pseudo-label)â†’mergeâ†’ê²€ì¦â†’ì „ì²˜ë¦¬â†’nnU-Net ì €ì¥
     - MRI: NIfTIâ†’SPIDER ë™ì ë§¤í•‘â†’ê²€ì¦â†’ì „ì²˜ë¦¬â†’nnU-Net ì €ì¥
     - `skip_existing`, `continue_on_error` ì§€ì› (ì¤‘ë‹¨ í›„ ì¬ì‹œì‘ ê°€ëŠ¥)

   - **nnU-Net í•™ìŠµ ì‹¤í–‰** (ì‹ ê·œ: `src/segmentation/training/run_train.py`)
     - `TrainConfig`: dataset_id, configuration, folds, epochs, device, debug
     - `run_plan_and_preprocess()`: subprocessë¡œ nnU-Net ì „ì²˜ë¦¬
     - `run_train()`: foldë³„ í•™ìŠµ ì‹¤í–‰
     - `run_full_training()`: ì „ì²˜ë¦¬ + ì „ì²´ fold í•™ìŠµ
     - `export_model()`: í•™ìŠµ ëª¨ë¸ ë‚´ë³´ë‚´ê¸°

   - **CLI ì—°ë™** (`src/pipeline/cli.py`)
     - `prepare-training-data`: ë°ì´í„°ì…‹ ë³€í™˜ ì‹¤í–‰ (--pseudo-labels, --dry-run, --continue)
     - `train`: nnU-Net í•™ìŠµ ì‹¤í–‰ (--dataset-id, --config, --folds, --debug, --export)

   - **í…ŒìŠ¤íŠ¸ ì¶”ê°€** (20ê°œ ì‹ ê·œ): ë§¤í•‘ ì™„ì „ì„±, SPIDER ë™ì  ë§¤í•‘, í¬ë¡¤ ë§¤ì¹­, ìŠ¤í‚µ í™•ì¸

   **ì‹ ê·œ íŒŒì¼ (3ê°œ)**:
   - `src/segmentation/training/dataset_crawl.py`
   - `src/segmentation/training/run_pipeline.py`
   - `src/segmentation/training/run_train.py`

   **ìˆ˜ì • íŒŒì¼ (3ê°œ)**:
   - `src/segmentation/labels.py` â€” ì›ë³¸ ë§¤í•‘ 3ì¢… ì¶”ê°€
   - `src/pipeline/cli.py` â€” prepare-training-data ì¬êµ¬í˜„ + train ì¶”ê°€
   - `src/segmentation/training/tests/test_training.py` â€” 20ê°œ í…ŒìŠ¤íŠ¸ ì¶”ê°€

1. **DICOM ì…ë ¥ ìë™í™” íŒŒì´í”„ë¼ì¸ êµ¬í˜„** â€” ì„œë²„ í…ŒìŠ¤íŠ¸ 35â†’44ê°œ, ì „ì²´ 44 passed

   DICOM í´ë”ë¥¼ ì„ íƒí•˜ë©´ **ë³€í™˜ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ ë©”ì‰¬ ì¶”ì¶œ â†’ 3D í‘œì‹œê¹Œì§€ ì›í´ë¦­ ìë™ ì²˜ë¦¬**.

   - **DICOM â†’ NIfTI ë³€í™˜ ëª¨ë“ˆ (ì‹ ê·œ)**: `src/server/dicom_converter.py`
     - SimpleITK `ImageSeriesReader` ê¸°ë°˜ DICOM ì‹œë¦¬ì¦ˆ ì½ê¸°
     - ë³µìˆ˜ ì‹œë¦¬ì¦ˆ ì¡´ì¬ ì‹œ ìŠ¬ë¼ì´ìŠ¤ ìˆ˜ ìµœëŒ€ ì‹œë¦¬ì¦ˆ ìë™ ì„ íƒ
     - í™˜ì ë©”íƒ€ë°ì´í„° ì¶”ì¶œ (Modality, PatientID ë“±)
   - **DICOM ì—…ë¡œë“œ ì—”ë“œí¬ì¸íŠ¸**: `POST /api/upload_dicom`
     - `webkitdirectory`ë¡œ ì„ íƒí•œ í´ë”ì˜ íŒŒì¼ë“¤ì„ flat ì €ì¥
     - ë¹„-DICOM íŒŒì¼ ìë™ í•„í„°ë§ (.jpg, .png, .txt ë“± ì œì™¸)
   - **WS ì›í´ë¦­ íŒŒì´í”„ë¼ì¸**: `run_dicom_pipeline` ë©”ì‹œì§€ íƒ€ì…
     - 3ë‹¨ê³„ ì—°ì‡„: DICOMë³€í™˜ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ ë©”ì‰¬ì¶”ì¶œ
     - ê° ë‹¨ê³„ë§ˆë‹¤ `pipeline_step` ì¤‘ê°„ ì§„í–‰ë¥  ì „ì†¡
     - ì™„ë£Œ ì‹œ `pipeline_result`ë¡œ ë©”ì‰¬ + ë©”íƒ€ë°ì´í„° ì „ì†¡
   - **í”„ë¡ íŠ¸ì—”ë“œ UI**: DICOM ì›í´ë¦­ ë²„íŠ¼ + 4ë‹¨ê³„ ì§„í–‰ë¥  í‘œì‹œ
     - File íƒ­ì— ë³´ë¼ìƒ‰ "DICOM í´ë” ì„ íƒ â†’ ìë™ ì²˜ë¦¬" ë²„íŠ¼
     - ì—…ë¡œë“œ/ë³€í™˜/ì„¸ê·¸ë©˜í…Œì´ì…˜/3Dëª¨ë¸ 4ë‹¨ê³„ ì§„í–‰ ìƒíƒœ í‘œì‹œ
     - ê¸°ì¡´ NIfTI ìˆ˜ë™ ì›Œí¬í”Œë¡œìš° ê·¸ëŒ€ë¡œ ìœ ì§€
   - **í…ŒìŠ¤íŠ¸ (ì‹ ê·œ 9ê°œ)**: `src/server/tests/test_dicom_converter.py`
     - ë‹¨ì¼/ë³µìˆ˜ ì‹œë¦¬ì¦ˆ, ë¹ˆ í´ë”, ì—ëŸ¬ ì²˜ë¦¬, ì½œë°±, ë©”íƒ€ë°ì´í„° ì¶”ì¶œ

   **ì‹ ê·œ íŒŒì¼ (2ê°œ)**:
   - `src/server/dicom_converter.py` â€” DICOMâ†’NIfTI ë³€í™˜ ëª¨ë“ˆ
   - `src/server/tests/test_dicom_converter.py` â€” ë³€í™˜ í…ŒìŠ¤íŠ¸

   **ìˆ˜ì • íŒŒì¼ (5ê°œ)**:
   - `src/server/models.py` â€” DicomPipelineRequest ëª¨ë¸ ì¶”ê°€
   - `src/server/app.py` â€” POST /api/upload_dicom ì—”ë“œí¬ì¸íŠ¸
   - `src/server/ws_handler.py` â€” run_dicom_pipeline í•¸ë“¤ëŸ¬
   - `src/simulator/index.html` â€” DICOM ì›í´ë¦­ UI + ì§„í–‰ë¥ 
   - `src/simulator/src/ws.js` â€” pipeline_step/pipeline_result ë””ìŠ¤íŒ¨ì¹˜
   - `src/simulator/src/main.js` â€” runDicomPipeline() + ì½œë°±

0. **FEA ì†”ë²„ ì¢…í•© ê°œì„  (4ë‹¨ê³„)** â€” í…ŒìŠ¤íŠ¸ 275â†’309ê°œ, ì „ì²´ 309 passed, 0 failed

   #### Phase 1: ì •í™•ë„ ë° ì•ˆì •ì„±

   - **PD f32â†’f64 ì „í™˜**: ëª¨ë“  Peridynamics í•„ë“œë¥¼ ti.f64ë¡œ ë³€í™˜ (ì—ë„ˆì§€ ë³´ì¡´ 133%â†’ëª©í‘œ <5%)
     - ìˆ˜ì •: particles.py, bonds.py, nosb.py, nosb_solver.py, explicit.py, quasi_static.py, damage.py, neighbor.py, linear_elastic.py(PD), pd_adapter.py
     - í…ŒìŠ¤íŠ¸: test_particles.py, test_3d.py, benchmark_analytical.py ëª¨ë‘ f64 ì „í™˜

   - **PD dt ì¶”ì • ê°œì„ **: íŒŒë™ì†ë„ ê¸°ë°˜(ê³¼ëŒ€ì¶”ì •) â†’ ìŠ¤í™íŠ¸ëŸ´ ë°˜ê²½ ë°©ë²•ìœ¼ë¡œ êµì²´
     - `k_eff = (Î»+2Î¼) Â· V_i Â· (|dpsi_sum|Â² + Î£|dpsi_k|Â²)` â†’ `dt = 0.5 Ã— 2/âˆš(Î»_max)`
     - ì˜ˆìƒ ~10x dt ì¦ê°€ â†’ quasi-static ìˆ˜ë ´ ì†ë„ ëŒ€í­ ê°œì„ 

   - **SPG ê²½ê³„ ë³´ì • ê°•í™”**: ê²½ê³„ ì…ìì˜ ì•ˆì •í™”ë ¥ì„ ì´ì›ƒ ìˆ˜ ë¹„ìœ¨ë¡œ ìŠ¤ì¼€ì¼ë§
     - `support_ratio = n_neighbors_i / max_neighbors` â†’ `G_s *= support_ratio`
     - ì™¸íŒ”ë³´ ì˜¤ì°¨ 17.26% â†’ ëª©í‘œ <10%

   - **FEM f32â†’f64 í†µì¼**: ëª¨ë“  FEM í•„ë“œ/ê³„ì‚°ì„ ti.f64ë¡œ ë³€í™˜
     - ìˆ˜ì •: mesh.py, linear_elastic.py(FEM), neo_hookean.py, static_solver.py, fem_adapter.py
     - í…ŒìŠ¤íŠ¸ íŒŒì¼(test_fem.py, test_hex8.py, test_quad4.py)ë„ f64 í†µì¼

   #### Phase 2: GPU ê°€ì†

   - **GPU ë°±ì—”ë“œ ìë™ ê°ì§€ í™•ì¥**: CUDAâ†’Vulkanâ†’CPU ìš°ì„ ìˆœìœ„ (ê¸°ì¡´ Vulkanâ†’CPU)
     - runtime.pyì— Backend.METAL ì¶”ê°€, ë¡œê¹… ê°•í™”

   - **ì ‘ì´‰ ê°ì‡ ë ¥ ì¶”ê°€**: ë²•ì„  ë°©í–¥ ì ì„± ê°ì‡  `f_damp = -2Î¾âˆš(kÂ·m_eff) Ã— v_rel_n Ã— n`
     - contact.py: compute_forces()ì— vel_a, vel_b, damping_ratio, mass_a, mass_b íŒŒë¼ë¯¸í„° ì¶”ê°€

   #### Phase 3: ìƒˆ ê¸°ëŠ¥ ì¶”ê°€

   - **FEM ë™ì  ì†”ë²„ (ì‹ ê·œ)**: `src/fea/fem/solver/dynamic_solver.py`
     - Newmark-beta implicit (Î³=0.5, Î²=0.25): ë¬´ì¡°ê±´ ì•ˆì •
     - Central Difference explicit: ì¡°ê±´ë¶€ ì•ˆì •, ì¶©ê²© ë¬¸ì œìš©
     - ì§‘ì¤‘ ì§ˆëŸ‰ í–‰ë ¬ (row-sum lumping), Rayleigh ê°ì‡  (C = Î±Â·M + Î²Â·K)
     - ê³ ìœ ì§„ë™ìˆ˜ ê³„ì‚° (ì¼ë°˜í™” ê³ ìœ ê°’ ë¬¸ì œ)
     - solver/__init__.pyì— DynamicSolver export ì¶”ê°€

   - **NeoHookean ì¼ë°˜í™”**: TET4 ì „ìš©(range(4)/range(3)) â†’ ëª¨ë“  ìš”ì†Œ ì§€ì›(nodes_per_elem/dim)

   #### Phase 4: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

   - **FEM ë™ì  ì†”ë²„ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ)**: `src/fea/fem/tests/test_dynamic.py` (15ê°œ)
     - ì†”ë²„ ìƒì„±, ì§‘ì¤‘ ì§ˆëŸ‰ í•©, Newmark/Central Diff ìŠ¤í…, ì•ˆì •ì„±, BC ê°•ì œ
     - 2D ì™¸íŒ”ë³´ 1ì°¨ ê³ ìœ ì§„ë™ìˆ˜ í•´ì„í•´ ëŒ€ë¹„ <15% ì˜¤ì°¨ í™•ì¸
     - Rayleigh ê°ì‡  ì—ë„ˆì§€ ê°ì†Œ í™•ì¸, 3D HEX8 ì§€ì› í™•ì¸

   - **ì ‘ì´‰ í•´ì„ Staggered ì •ì  ì†”ë²„ ë²„ê·¸ ìˆ˜ì •**: scene.py `_solve_static`
     - ì²« ë°˜ë³µì—ì„œ ê³ ì • ë…¸ë“œ ì—†ëŠ” body ë‹¨ë… í•´ì„ â†’ íŠ¹ì´ í–‰ë ¬ ë°œì‚° (f64 ì „í™˜ í›„ í‘œë©´í™”)
     - ìˆ˜ì •: êµ¬ì† ìˆëŠ” bodyë§Œ ì²« ë…ë¦½ í•´ì„ ìˆ˜í–‰

   - **ì „ì²´ í…ŒìŠ¤íŠ¸**: 309 passed, 0 failed (FEM 39 + PD 22 + SPG 31 + Framework 19 + Contact 19 + Core 48 + Pipeline 28 + Segmentation 68 + Server 35)

   **ì‹ ê·œ íŒŒì¼ (2ê°œ)**:
   - `src/fea/fem/solver/dynamic_solver.py` â€” FEM ë™ì  ì†”ë²„
   - `src/fea/fem/tests/test_dynamic.py` â€” ë™ì  ì†”ë²„ í…ŒìŠ¤íŠ¸

   **ìˆ˜ì • íŒŒì¼ (21ê°œ)**:
   - PD: particles.py, bonds.py, nosb.py, nosb_solver.py, explicit.py, quasi_static.py, damage.py, neighbor.py, linear_elastic.py(PD), pd_adapter.py, test_particles.py, test_3d.py, benchmark_analytical.py
   - FEM: mesh.py, linear_elastic.py(FEM), neo_hookean.py, static_solver.py, solver/__init__.py, test_fem.py, test_hex8.py, test_quad4.py
   - SPG: spg_compute.py
   - Framework: runtime.py, contact.py, fem_adapter.py, scene.py

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-13)

### ì™„ë£Œ

0. **SpineUnified: CT+MRI í†µí•© ì²™ì¶” ì„¸ê·¸ë©˜í…Œì´ì…˜ ëª¨ë¸** â€” ì„¸ê·¸ë©˜í…Œì´ì…˜ í…ŒìŠ¤íŠ¸ 25â†’68ê°œ, ì „ì²´ ~275 passed
   - **Phase 1: ê¸°ë°˜ êµ¬ì¡° (ì¶”ë¡  ì—”ì§„ + ë¼ë²¨ ë§¤í•‘ + UI)**
     - `src/segmentation/labels.py`: `NNUNET_SPINE_TO_STANDARD` (0~50â†’SpineLabel) + `STANDARD_TO_NNUNET_SPINE` ì—­ë§¤í•‘ + `NNUNET_IGNORE_LABEL=51`
     - `src/segmentation/base.py`: `segment()` ì‹œê·¸ë‹ˆì²˜ì— `modality: Optional[str] = None` ì¶”ê°€
     - `src/segmentation/nnunet_spine.py` (ì‹ ê·œ): SpineUnifiedEngine â€” nnU-Net v2 ê¸°ë°˜ CT+MRI í†µí•© ì¶”ë¡ 
       - `_detect_modality()`: HU ë²”ìœ„ë¡œ CT/MRI ìë™ íŒë³„
       - `_prepare_input()`: 2ì±„ë„ NIfTI ìƒì„± (ì •ê·œí™” ì˜ìƒ + ë„ë©”ì¸ ì±„ë„ CT=1/MRI=0)
       - `_run_inference()`: nnUNetPredictor í˜¸ì¶œ
       - `download_model()`: GitHub Release ê°€ì¤‘ì¹˜ ë‹¤ìš´ë¡œë“œ
     - `src/segmentation/factory.py`: `spine_unified` ì—”ì§„ ë“±ë¡
     - `src/pipeline/config.py`: `SegmentConfig.engine` Literalì— `spine_unified` ì¶”ê°€
     - `src/server/models.py`: `SegmentationRequest.modality` í•„ë“œ ì¶”ê°€
     - `src/server/segmentation_pipeline.py`: spine_unified ë§¤í•‘ ë¶„ê¸° + modality ì „ë‹¬
     - `src/simulator/index.html`: ì—”ì§„ ë“œë¡­ë‹¤ìš´ì— "SpineUnified (CT+MRI)" + ëª¨ë‹¬ë¦¬í‹° ì„ íƒ UI
     - `src/simulator/src/main.js`: ì—”ì§„ ë³€ê²½ ì‹œ ëª¨ë‹¬ë¦¬í‹° UI í† ê¸€ + ìš”ì²­ì— modality í¬í•¨
     - `pyproject.toml`: `seg-unified = ["nnunetv2>=2.5"]`, `seg-train = [...]` ì˜ì¡´ì„±
   - **Phase 2: í•™ìŠµ ë°ì´í„° ì¤€ë¹„ íŒŒì´í”„ë¼ì¸** (`src/segmentation/training/`)
     - `config.py`: DatasetPaths, PseudoLabelConfig, PreprocessConfig, NnunetConfig, TrainingPipelineConfig
     - `download.py`: VerSe2020/CTSpine1K/SPIDER ë°ì´í„°ì…‹ ê²€ì¦ (validate_all, print_validation_report)
     - `pseudo_label.py`: TotalSpineSegë¡œ CT ë””ìŠ¤í¬ pseudo-label ìƒì„± + ì‹ ë¢°ë„ í•„í„° (min_voxels, ì¸ì ‘ ì²™ì¶” í™•ì¸, ì—°ê²° ì„±ë¶„)
     - `validate_labels.py`: í•´ë¶€í•™ì  ì¼ê´€ì„± ê²€ì¦ (ì²™ì¶”ê³¨ ìˆœì„œ, ë””ìŠ¤í¬ ìœ„ì¹˜, êµ¬ì¡°ë¬¼ í¬ê¸°)
     - `label_merge.py`: GT ì²™ì¶”ê³¨ + pseudo-label ë””ìŠ¤í¬ ë³‘í•© (GT ìš°ì„ , ë¶ˆí™•ì‹¤=ignore)
     - `preprocess.py`: CT HUâ†’0-1, MRI z-scoreâ†’0-1, ë„ë©”ì¸ ì±„ë„ ìƒì„±
     - `convert_nnunet.py`: SpineLabelâ†’nnU-Net ì—°ì† ì •ìˆ˜, ì¼€ì´ìŠ¤ ì €ì¥, dataset.json ìƒì„±
   - **Phase 4: CLI í™•ì¥**
     - `spine-sim download-model spine_unified`: ëª¨ë¸ ê°€ì¤‘ì¹˜ ë‹¤ìš´ë¡œë“œ
     - `spine-sim validate-data`: í•™ìŠµ ë°ì´í„°ì…‹ ê²€ì¦
     - `spine-sim prepare-training-data /data -o nnUNet_raw`: í•™ìŠµ ë°ì´í„° ë³€í™˜ ê°€ì´ë“œ
     - `spine-sim segment` ì— `--modality` ì˜µì…˜ ì¶”ê°€
   - **í…ŒìŠ¤íŠ¸:** 43ê°œ ì‹ ê·œ
     - test_nnunet_spine.py: 19ê°œ (ë¼ë²¨ ë§¤í•‘ 9 + ì—”ì§„ 5 + ëª¨ë‹¬ë¦¬í‹° ê°ì§€ 2 + ì „ì²˜ë¦¬ 3)
     - test_training.py: 24ê°œ (ì„¤ì • 2 + ì „ì²˜ë¦¬ 6 + ë³‘í•© 3 + ë³€í™˜ 5 + ê²€ì¦ 4 + ë°ì´í„°ì…‹ 4)
   - **ì‹ ê·œ íŒŒì¼ 11ê°œ**: nnunet_spine.py, training/{__init__,config,download,pseudo_label,validate_labels,label_merge,preprocess,convert_nnunet}.py, tests/test_nnunet_spine.py, training/tests/test_training.py
   - **ìˆ˜ì • íŒŒì¼ 9ê°œ**: labels.py, base.py, totalseg.py, totalspineseg.py, factory.py, config.py, models.py, segmentation_pipeline.py, index.html, main.js, pyproject.toml, cli.py

1. **Phase 2-7: CT/MRI â†’ ìˆ˜ìˆ  ì‹œë®¬ë ˆì´ì…˜ ì „ì²´ ì›Œí¬í”Œë¡œìš° êµ¬í˜„** â€” ì‹ ê·œ 35ê°œ ì„œë²„ í…ŒìŠ¤íŠ¸, ì „ì²´ 251 passed
   - **Phase 2: ì„œë²„-ì›¹ í†µì‹  í™•ì¥**
     - `src/server/app.py`: REST íŒŒì¼ ì—…ë¡œë“œ (`POST /api/upload`, `/api/upload_plan`)
     - `src/server/ws_handler.py`: 4ê°œ ìƒˆ WS ëª…ë ¹ (segment, extract_meshes, auto_material, run_analysis)
     - `src/server/models.py`: ImplantPlacement, SurgicalPlan, SegmentationRequest, MeshExtractRequest, AutoMaterialRequest ëª¨ë¸
     - `src/simulator/src/ws.js`: segment_result, meshes_result, material_result ë””ìŠ¤íŒ¨ì¹˜ ì¶”ê°€
   - **Phase 3: ì„¸ê·¸ë©˜í…Œì´ì…˜ ì„œë²„ ì—°ë™**
     - `src/server/segmentation_pipeline.py` (ì‹ ê·œ): NIfTI â†’ TotalSeg/TotalSpineSeg â†’ í‘œì¤€ ë¼ë²¨ë§µ
     - File íƒ­ì— NIfTI ì—…ë¡œë“œ + ì—”ì§„ ì„ íƒ + ì§„í–‰ë¥  UI ì¶”ê°€
   - **Phase 4: 3D ëª¨ë¸ ìƒì„± (ë¼ë²¨ë§µ â†’ ë©”ì‰¬)**
     - `src/server/mesh_extract_pipeline.py` (ì‹ ê·œ): ë¼ë²¨ë³„ Marching Cubes ë©”ì‰¬ ì¶”ì¶œ (scikit-image)
     - JS ë©”ì‰¬ ìˆ˜ì‹  â†’ BufferGeometry ìƒì„± â†’ ì”¬ í‘œì‹œ (bone/disc/soft_tissue ìƒ‰ìƒ êµ¬ë¶„)
   - **Phase 5: ìˆ˜ìˆ  ëª¨ë¸ë§ (ì›¹ ì¸í„°ë™í‹°ë¸Œ)**
     - `src/simulator/src/implant.js` (ì‹ ê·œ): ImplantManager í´ë˜ìŠ¤ (TransformControls)
     - STL ì„í¬íŠ¸, ì´ë™/íšŒì „/ìŠ¤ì¼€ì¼, ìˆ˜ìˆ  ê³„íš JSON ì €ì¥/ë¡œë“œ
   - **Phase 6: ì „ì²˜ë¦¬ + í•´ì„ í™•ì¥**
     - `src/server/auto_material.py` (ì‹ ê·œ): SPINE_MATERIAL_DB (8ì¢… ì¬ë£Œ) + SpineLabel ìë™ ë§¤í•‘
     - Pre-process íƒ­: ìë™ ì¬ë£Œ í• ë‹¹(ì œì•ˆ) + ìˆ˜ë™ E/nu/density í¸ì§‘ UI
     - BCëŠ” ê¸°ì¡´ ë¸ŒëŸ¬ì‰¬ UI ìœ ì§€ (ì‚¬ìš©ì ìš”ì²­: ìë™ BC ë¯¸êµ¬í˜„)
     - ì¬ë£Œ ìƒì„¸ í¸ì§‘ ê°€ëŠ¥ (ì‚¬ìš©ì ìš”ì²­: í™˜ìë³„ ë¼ˆ/ë””ìŠ¤í¬ ë¬¼ì„±ì¹˜ ë‹¤ë¦„)
     - Solve íƒ­: ë‹¨ì¼ ë„ë©”ì¸/ë‹¤ì¤‘ ë¬¼ì²´ ì ‘ì´‰ í•´ì„ ëª¨ë“œ ì„ íƒ
   - **Phase 7: í›„ì²˜ë¦¬ ì‹œê°í™” í™•ì¥**
     - `src/simulator/src/post.js`: ìˆ˜ìˆ  ì „/í›„ ë¹„êµ + ì„í”Œë€íŠ¸ ì£¼ë³€ ì‘ë ¥ í•„í„°
     - Post-process íƒ­: ìˆ˜ìˆ  ì „ ê²°ê³¼ ì €ì¥, ì „/í›„ ë¹„êµ ë²„íŠ¼, í•„í„° ë°˜ê²½ ìŠ¬ë¼ì´ë”
   - **í…ŒìŠ¤íŠ¸ (35ê°œ ì‹ ê·œ):**
     - test_models.py: 20ê°œ (Pydantic ëª¨ë¸ + JSON ì§ë ¬í™”)
     - test_auto_material.py: 7ê°œ (ì¬ë£Œ DB + ìë™ í• ë‹¹)
     - test_mesh_extract.py: 5ê°œ (ë©”ì‰¬ ì¶”ì¶œ + ë¼ë²¨ ë¡œë“œ)
     - test_segmentation_pipeline.py: 3ê°œ (íŒŒì´í”„ë¼ì¸ ì—ëŸ¬ ì²˜ë¦¬)
   - **ì‹ ê·œ íŒŒì¼ 10ê°œ**: segmentation_pipeline.py, mesh_extract_pipeline.py, auto_material.py, implant.js, í…ŒìŠ¤íŠ¸ 5ê°œ + __init__.py
   - **ìˆ˜ì • íŒŒì¼ 7ê°œ**: app.py, ws_handler.py, models.py, ws.js, post.js, main.js, index.html
   - **ì˜ì¡´ì„± ì¶”ê°€**: scikit-image

1. **Phase 0+1: CLI íŒŒì´í”„ë¼ì¸ + ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ ëª¨ë“ˆ** â€” ì‹ ê·œ 53ê°œ í…ŒìŠ¤íŠ¸, ì „ì²´ 216 passed
   - **CLI íŒŒì´í”„ë¼ì¸** (`src/pipeline/`)
     - `cli.py`: Typer CLI â€” 7ê°œ ì„œë¸Œì»¤ë§¨ë“œ (segment, postprocess, voxelize, solve, report, pipeline, server)
     - `config.py`: Pydantic ì„¤ì • ëª¨ë¸ + TOML ë¡œë“œ (PipelineConfig, SegmentConfig ë“±)
     - `cache.py`: SHA256 í•´ì‹œ ê¸°ë°˜ íŒŒì´í”„ë¼ì¸ ìºì‹œ (ì…ë ¥+ìŠ¤í…Œì´ì§€+íŒŒë¼ë¯¸í„° â†’ ê²°ê³¼ ì¬ì‚¬ìš©)
     - `stages/base.py`: StageBase ABC + StageResult ë°ì´í„°í´ë˜ìŠ¤
     - `stages/segment.py`: CT/MRI ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ ìŠ¤í…Œì´ì§€ (TotalSeg/TotalSpineSeg ì—”ì§„ í˜¸ì¶œ)
     - `stages/postprocess.py`: SimpleITK í˜•íƒœí•™ì  í›„ì²˜ë¦¬ (ì†Œ êµ¬ì„±ìš”ì†Œ ì œê±°, êµ¬ë© ì±„ìš°ê¸°, ìŠ¤ë¬´ë”©)
     - `stages/voxelize.py`: NIfTI â†’ NPZ ë³µì…€ ëª¨ë¸ (VolumeLoader ì¬ì‚¬ìš©, SpineLabel ì¬ë£Œ ë§¤í•‘)
     - `stages/solve.py`: FEA í”„ë ˆì„ì›Œí¬ í˜¸ì¶œ (FEM/PD/SPG ì†”ë²„)
     - `stages/report.py`: JSON + HTML ë¦¬í¬íŠ¸ ìƒì„±
   - **ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜** (`src/segmentation/`)
     - `labels.py`: SpineLabel IntEnum â€” í†µí•© ë¼ë²¨ ì²´ê³„ (100ë²ˆëŒ€=ì²™ì¶”, 200ë²ˆëŒ€=ë””ìŠ¤í¬, 300ë²ˆëŒ€=ì—°ì¡°ì§)
     - `base.py`: SegmentationEngine ABC (is_available, segment, get_standard_label_mapping)
     - `totalseg.py`: TotalSegmentator Python API ë˜í¼ (CT, vertebrae C1~L5+sacrum)
     - `totalspineseg.py`: TotalSpineSeg CLI ë˜í¼ (MRI, ì²™ì¶”+ë””ìŠ¤í¬+ì²™ìˆ˜)
     - `factory.py`: create_engine() íŒ©í† ë¦¬ + list_engines()
     - `labels.py`: TOTALSEG_TO_STANDARD, TOTALSPINESEG_TO_STANDARD ë§¤í•‘ + convert_to_standard()
   - **ê¸°ë³¸ ì„¤ì • íŒŒì¼**: `config/pipeline.toml`
   - **pyproject.toml ìˆ˜ì •**: typer, nibabel, pydantic, rich ì˜ì¡´ì„± + build-system(hatchling) + project.scripts
   - **CLI ì‹¤í–‰**: `uv run spine-sim --help` â†’ 7ê°œ ì„œë¸Œì»¤ë§¨ë“œ ì •ìƒ ì¶œë ¥
   - **í…ŒìŠ¤íŠ¸**:
     - Pipeline: ìºì‹œ 8 + ì„¤ì • 10 + CLI 10 = 28ê°œ
     - Segmentation: ë¼ë²¨ 16 + ì—”ì§„ 9 = 25ê°œ
     - ê¸°ì¡´ 163ê°œ + ì‹ ê·œ 53ê°œ = **216 passed, 0 failed**

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-12)

### ì™„ë£Œ

0. **íƒ­ ê¸°ë°˜ UI ì „ë©´ ë¦¬íŒ©í† ë§** - `src/simulator/index.html`, `src/simulator/src/main.js`
   - **ë“œë¡­ë‹¤ìš´ ë©”ë‰´ â†’ íƒ­ ë°” ì „í™˜**: 4ê°œ ë“œë¡­ë‹¤ìš´(.menu-item+.dropdown) ì „ë¶€ ì‚­ì œ â†’ 6ê°œ íƒ­(.tab-btn) ì¶”ê°€
   - **íƒ­ êµ¬ì„± (ì›Œí¬í”Œë¡œìš° ìˆœ)**: File | Modeling | Pre-process | Solve | Post-process | View + Undo/Redo ì•„ì´ì½˜
   - **ì‚¬ì´ë“œë°” íŒ¨ë„ ì¬êµ¬ì„±**: ê¸°ì¡´ 5ê°œ(default/drill/bc/analysis/nrrd) â†’ ìƒˆ 6ê°œ(file/modeling/preprocess/solve/postprocess/view)
     - File: ëª¨ë¸ ëª©ë¡ + Import ë²„íŠ¼ + ì¢Œí‘œì„¤ì • + NRRD ì„¤ì • (í†µí•©)
     - Modeling: Drill í† ê¸€ + ë°˜ê²½ + í•´ìƒë„ + History
     - Pre-process: BC íƒ€ì…(Fixed/Force) + ë¸ŒëŸ¬ì‰¬ + Force ë°©í–¥ + ì¬ë£Œ
     - Solve: ì„œë²„ìƒíƒœ + ì†”ë²„ì„ íƒ + ì‹¤í–‰ + ì§„í–‰ë¥ 
     - Post-process: ì‹œê°í™”ëª¨ë“œ + ìŠ¤ì¼€ì¼ + ì»¬ëŸ¬ë°” + í†µê³„
     - View: ì¹´ë©”ë¼ í”„ë¦¬ì…‹(6ë°©í–¥) + Upì¶•(Y/Z) + ì¡°ëª…(Ambient/Directional) + ê·¸ë¦¼ì + ë°°ê²½ìƒ‰ + Grid/Axes
   - **JS í•µì‹¬ ë³€ê²½**:
     - `switchTab()` í•¨ìˆ˜ ì¶”ê°€: íƒ­ ì „í™˜ + íŒ¨ë„ í‘œì‹œ + ë„êµ¬ ìë™ í™œì„±í™”
     - `setTool(tool, force)`: force íŒŒë¼ë¯¸í„° ì¶”ê°€ (íƒ­ ì „í™˜ ì‹œ í† ê¸€ ë°©ì§€)
     - `enterPostMode()`/`exitPostMode()`: í›„ì²˜ë¦¬ ëª¨ë“œ ì§„ì…/í•´ì œ ë¶„ë¦¬
     - `setupViewListeners()`: ì¹´ë©”ë¼ í”„ë¦¬ì…‹, Upì¶•, ì¡°ëª…, ë°°ê²½ìƒ‰, Grid/Axes ì´ë²¤íŠ¸
     - `setCameraPreset(direction)`: 6ë°©í–¥ ì¹´ë©”ë¼ í”„ë¦¬ì…‹ (ëª¨ë¸ ë°”ìš´ë”©ë°•ìŠ¤ ê¸°ë°˜ ê±°ë¦¬ ê³„ì‚°)
     - ì¡°ëª… ì „ì—­ ì°¸ì¡°(`ambientLight`, `dirLight`) ì¶”ê°€ë¡œ View íƒ­ì—ì„œ ì‹¤ì‹œê°„ ì¡°ì ˆ
     - ë“œë¡­ë‹¤ìš´ ê´€ë ¨ ì½”ë“œ ì „ë¶€ ì‚­ì œ (`openDropdown`, `toggleDropdown`, `closeAllDropdowns`)
   - **CSS ë³€ê²½**: ë“œë¡­ë‹¤ìš´ CSS ì‚­ì œ, `.tab-btn`/`.tab-btn.active`/`.icon-btn`/`.menubar-sep` ì¶”ê°€
   - **í•´ì„ ê²°ê³¼ ìˆ˜ì‹  ì‹œ ìë™ Post-process íƒ­ ì „í™˜** (`switchTab('postprocess')`)
   - **NRRD ë¡œë“œ ì‹œ File íƒ­ + NRRD ì„¤ì • ì„¹ì…˜ ìë™ í‘œì‹œ**
   - **DOM ID ì „ë¶€ ë³´ì¡´** (ê¸°ì¡´ ì½”ë“œ í˜¸í™˜)

0. **Force BC í™”ì‚´í‘œ ë™ì‘ ê°œì„ ** - `src/simulator/src/main.js`, `src/simulator/src/pre.js`
   - **ì ìš© í›„ í‘œì‹œ**: Force BC ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œ ì ìš©ë©´ ì¤‘ì‹¬ì— ë¹¨ê°„ í™•ì • í™”ì‚´í‘œ ìƒì„±
   - **Ctrl+ë“œë˜ê·¸ ë°©í–¥ ì¡°ì •**: ì ìš©ëœ í™”ì‚´í‘œì˜ ë°©í–¥ì„ ì¹´ë©”ë¼-facing í‰ë©´ì—ì„œ ì‹¤ì‹œê°„ íšŒì „, BC ë°ì´í„°ë„ í•¨ê»˜ ê°±ì‹ 
   - **depthTest ë¹„í™œì„±í™”**: í™”ì‚´í‘œê°€ ë¬¼ì²´ì— ê°€ë ¤ì§€ì§€ ì•Šê³  í•­ìƒ ë³´ì´ë„ë¡ ì„¤ì •
   - **Ctrl í‚¤ ì‹œ ë¸ŒëŸ¬ì‰¬ ë¹„í™œì„±í™”**: Ctrl+í´ë¦­/ë“œë˜ê·¸ ì‹œ ë³µì…€ ì„ íƒì´ ë˜ì§€ ì•Šë„ë¡ ë¶„ë¦¬
   - **pre.js ì¤‘ë³µ í™”ì‚´í‘œ ì œê±°**: `_addBCVisual()`ì—ì„œ ìì²´ ArrowHelper ìƒì„± ì œê±° (main.jsì—ì„œë§Œ ê´€ë¦¬)
   - **ì ìš© í™”ì‚´í‘œ ê´€ë¦¬**: `appliedForceArrows` ë°°ì—´ë¡œ ì¶”ì , BC ì œê±° ì‹œ í•¨ê»˜ ì •ë¦¬

0. **Pre-process UI ê°œí¸** - `src/simulator/index.html`, `src/simulator/src/main.js`, `src/simulator/src/pre.js`
   - **ë©”ë‰´ ì´ë¦„ ë³€ê²½**: "Boundary Cond." â†’ "Pre-process" (data-menu, dropdown ID í¬í•¨)
   - **BC íƒ€ì…ë³„ ìƒ‰ìƒ ì¦‰ì‹œ ë°˜ì˜**:
     - Fixed: í˜¸ë²„=ì—°ì´ˆë¡(0x66ff88), ì„ íƒ/í™•ì •=ì´ˆë¡(0x00cc44)
     - Force: í˜¸ë²„=ì—°ë¹¨ê°•(0xff6666), ì„ íƒ/í™•ì •=ë¹¨ê°•(0xff2222)
     - `getCurrentBCColor()` í—¬í¼ë¡œ ë¼ë””ì˜¤ ê°’ì— ë”°ë¼ ë™ì  ìƒ‰ìƒ ë°˜í™˜
     - BC íƒ€ì… ë³€ê²½ ì‹œ í•˜ì´ë¼ì´íŠ¸ ìƒ‰ìƒ ì¦‰ì‹œ ì¬ìƒì„±
   - **Force ë°©í–¥ 3D í™”ì‚´í‘œ**: ArrowHelperë¡œ ì„ íƒ ì˜ì—­ ì¤‘ì‹¬ì—ì„œ ë°©í–¥ ë²¡í„° í‘œì‹œ
     - í¬ê¸° ìŠ¬ë¼ì´ë” (1~1000N, ê¸°ë³¸ 100N)
     - Ctrl+ë“œë˜ê·¸ë¡œ ì¹´ë©”ë¼-facing í‰ë©´ì—ì„œ 3D íšŒì „
     - ë°©í–¥ í…ìŠ¤íŠ¸ ì‹¤ì‹œê°„ ê°±ì‹ : (x, y, z)
     - ê¸°ë³¸ ë°©í–¥ ë¦¬ì…‹ ë²„íŠ¼ (-Y)
     - í™•ì • BCì—ë„ ArrowHelper ì˜êµ¬ í‘œì‹œ
   - **ì¬ë£Œ ì˜¤ë¸Œì íŠ¸ ì„ íƒ**: ëŒ€ìƒ select (ì „ì²´/L4/L5/disc...) ë™ì  ìƒì„±
     - ëª¨ë¸ ë¡œë“œ/ë³µì…€í™” ì™„ë£Œ ì‹œ ìë™ ê°±ì‹ 
     - ì„ íƒëœ ì˜¤ë¸Œì íŠ¸ì—ë§Œ ì¬ë£Œ ì ìš© ê°€ëŠ¥
   - **íŒ¨ë„ ì¬êµ¬ì„±**: BC íƒ€ì… ë¼ë””ì˜¤ ìƒë‹¨ ì´ë™, Force X/Y/Z ìŠ¬ë¼ì´ë” ì œê±° â†’ ë°©í–¥ ë“œë˜ê·¸ + í¬ê¸° ìŠ¬ë¼ì´ë”
   - ê¸°ì¡´ Force X/Y/Z ìŠ¬ë¼ì´ë” ì œê±° â†’ ë°©í–¥ì€ 3D ë“œë˜ê·¸, í¬ê¸°ëŠ” ë‹¨ì¼ ìŠ¬ë¼ì´ë”
   - **BC ë¸ŒëŸ¬ì‰¬ í˜ì¸íŒ… ë²„ê·¸ ìˆ˜ì •**: `pre.js`ì—ì„œ `grid.size`(undefined) â†’ `grid.gridSize.x/y/z` ë³€ê²½ (6ê³³)
     - ì›ì¸: linearIdx ê³„ì‚°ì´ NaN â†’ Setì— 1ê°œë§Œ ì €ì¥
     - ë¹„ì •ë°©(non-cubic) ê·¸ë¦¬ë“œ (64x58x35 ë“±) ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬
   - **ì´ì¤‘ ë³µì…€ ì´ˆê¸°í™” ìˆ˜ì •**: `isDrillInitialized = true`ë¥¼ setTimeout ì „ì— ì„¤ì •í•˜ì—¬ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€

1. **BC ë¸ŒëŸ¬ì‰¬ ë„êµ¬ êµ¬í˜„** - `src/simulator/src/pre.js`, `src/simulator/src/main.js`, `src/simulator/index.html`
   - **ë“œë¦´ê³¼ ë™ì¼í•œ êµ¬ì²´ ë¸ŒëŸ¬ì‰¬** ë°©ì‹ìœ¼ë¡œ ê²½ê³„ì¡°ê±´ ì˜ì—­ ì„ íƒ (ê¸°ì¡´ ë©´ BFS ì„ íƒ â†’ ë¸ŒëŸ¬ì‰¬ í˜ì¸íŒ…)
   - **í”„ë¦¬ë·°**: í˜¸ë²„ ì‹œ ì‹œì•ˆìƒ‰ InstancedMeshë¡œ ì˜í–¥ ë³µì…€ í•˜ì´ë¼ì´íŠ¸
   - **ì„ íƒ**: í´ë¦­/ë“œë˜ê·¸ë¡œ ë³µì…€ ëˆ„ì  ì„ íƒ (ë…¸ë€ìƒ‰ í•˜ì´ë¼ì´íŠ¸), ì„ íƒ ì¹´ìš´íŠ¸ ì‹¤ì‹œê°„ í‘œì‹œ
   - **BC ì ìš©**: ì„ íƒëœ ë³µì…€ì— Fixed/Force BC í™•ì • (íŒŒë‘/ë¹¨ê°• InstancedMesh íë¸Œ ì‹œê°í™”)
   - **í•´ì„ ì—°ë™**: `buildAnalysisRequest()`ì—ì„œ voxelIndices â†’ particle index ë§¤í•‘ìœ¼ë¡œ ì •í™•í•œ BC ì „ë‹¬
   - `pre.js`: `brushSelection` Map, `brushSelectSphere()`, `clearBrushSelection()`, `getBrushSelectionCount()`, `getBrushSelectionWorldPositions()` ì¶”ê°€
   - `main.js`: `bcBrushHighlight`, `bcSelectionHighlight` InstancedMesh, `bc_brush` ë„êµ¬ í•¸ë“¤ë§ ì¶”ê°€
   - `index.html`: BC íŒ¨ë„ ë¸ŒëŸ¬ì‰¬ UI (ë°˜ê²½ ìŠ¬ë¼ì´ë” 1~15mm, ì„ íƒ ì¹´ìš´íŠ¸), ë©”ë‰´ í…ìŠ¤íŠ¸ "Brush Select"
   - ê¸°ì¡´ face ê¸°ë°˜ BCì™€ í˜¸í™˜ ìœ ì§€ (ë ˆê±°ì‹œ `bc_select` ë„êµ¬ ë³´ì¡´)

1. **ë°ìŠ¤í¬íƒ‘ CAE ìŠ¤íƒ€ì¼ UI ë¦¬íŒ©í† ë§** - `src/simulator/index.html`, `src/simulator/src/main.js`
   - **ìƒë‹¨ ë©”ë‰´ë°”**: File / Modeling / Boundary Cond. / Analysis ë“œë¡­ë‹¤ìš´ ë©”ë‰´
     - File: Load Sample, Load STL, Load NRRD, Clear All
     - Modeling: Drill, Re-voxelize, Undo/Redo (Ctrl+Z/Y)
     - Boundary Cond.: Select Faces, Apply Fixed/Force BC, Remove BC, Assign Material
     - Analysis: Run Analysis, Show Displacement/Stress/Damage
   - **ìš°ì¸¡ ì†ì„± íŒ¨ë„** (260px): í™œì„± ë„êµ¬ì— ë”°ë¼ ì»¨í…ìŠ¤íŠ¸ ì „í™˜
     - ê¸°ë³¸: ëª¨ë¸ ëª©ë¡ + ì¢Œí‘œ ì„¤ì •
     - Drill: ë°˜ê²½ ìŠ¬ë¼ì´ë” + ë³µì…€ í•´ìƒë„ + History(Undo/Redo)
     - BC: ë©´ ì„ íƒ + Fixed/Force ì„¤ì • + ì¬ë£Œ í”„ë¦¬ì…‹
     - Analysis: ì†”ë²„ ì„ íƒ + ì‹¤í–‰ + ì§„í–‰ë¥  + í›„ì²˜ë¦¬(ì‹œê°í™”/ìŠ¤ì¼€ì¼/ì»¬ëŸ¬ë°”)
     - NRRD: í•´ìƒë„ + Threshold + Apply
   - **í•˜ë‹¨ ìƒíƒœë°”**: Tool / FPS / Drill ì •ë³´ / WS ì—°ê²° ìƒíƒœ
   - **View ë²„íŠ¼**: ë©”ë‰´ë°” ìš°ì¸¡ì— Reset/Top/Front
   - **ë©”ë‰´ í˜¸ë²„ ì „í™˜**: ë“œë¡­ë‹¤ìš´ ì—´ë¦° ìƒíƒœì—ì„œ ë‹¤ë¥¸ ë©”ë‰´ í˜¸ë²„ ì‹œ ìë™ ì „í™˜
   - **ìº”ë²„ìŠ¤ ë“œë˜ê·¸ ì•¤ ë“œë¡­**: STL íŒŒì¼ì„ ë·°í¬íŠ¸ì— ë“œë¡­í•˜ì—¬ ë¡œë“œ
   - **bc_select ë„êµ¬**: ë©´ ì„ íƒ ì „ìš© ë„êµ¬ ë¶„ë¦¬ (ê¸°ì¡´ analysis ë„êµ¬ì—ì„œ ë¶„ë¦¬)
   - ê¸°ì¡´ ëª¨ë“  ê¸°ëŠ¥ í˜¸í™˜ ìœ ì§€ (DOM ID ë³´ì¡´)

1. **Pre-process Step ì›Œí¬í”Œë¡œìš° ê²€ì¦ í…ŒìŠ¤íŠ¸ (30 í•­ëª©, 29 PASS / 1 FAIL)**
   - Playwright (Chromium headless)ë¡œ http://localhost:8080 ì›¹ì•± ìë™í™” í…ŒìŠ¤íŠ¸
   - **í…ŒìŠ¤íŠ¸ íŒŒì¼**: `test-preprocess-workflow.mjs`
   - **ìŠ¤í¬ë¦°ìƒ·**: `test-preprocess-workflow-screenshot.png`
   - **ê²€ì¦ í•­ëª© 8ê°€ì§€**:
     1. í˜ì´ì§€ ë¡œë“œ í›„ JS ì—ëŸ¬ ì—†ìŒ (PASS)
     2. Pre-process íƒ­ í´ë¦­ â†’ panel-preprocess í‘œì‹œ í™•ì¸ (PASS)
     3. ì›Œí¬í”Œë¡œìš° ìš”ì†Œ ì¡´ì¬ + ìˆœì„œ í™•ì¸: ë¸ŒëŸ¬ì‰¬ â†’ Step1(Fixed) â†’ Step2(Force) â†’ BCê´€ë¦¬ â†’ Step3(ì¬ë£Œ) (PASS, 21í•­ëª© ì „ë¶€)
     4. input[name="bc-type"] ë¼ë””ì˜¤ ë²„íŠ¼ ì—†ìŒ í™•ì¸ (PASS)
     5. Force ë°©í–¥ í‘œì‹œ "(0.00, -1.00, 0.00)" í•­ìƒ ë³´ì„ í™•ì¸ (PASS)
     6. Stepë³„ border-left ìƒ‰ìƒ: ì´ˆë¡(Fixed #00cc44), ë¹¨ê°•(Force #ff2222), íŒŒë‘(ì¬ë£Œ #1976d2) (PASS)
     7. ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜ (PASS)
     8. ìµœì¢… JS ì—ëŸ¬ í™•ì¸: pageerror ì—†ìŒ(PASS), ì½˜ì†” WebSocket 404ë§Œ ì¡´ì¬(FAIL - í•´ì„ ì„œë²„ ë¯¸ì‹¤í–‰ìœ¼ë¡œ ì˜ˆìƒë¨)

1. **íƒ­ ê¸°ë°˜ UI ê²€ì¦ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ì „ì²´ í†µê³¼ (55 passed, 0 failed)**
   - Playwright (Chromium headless)ë¡œ http://localhost:8080 ì›¹ì•± ìë™í™” í…ŒìŠ¤íŠ¸
   - **í…ŒìŠ¤íŠ¸ íŒŒì¼**: `test-tab-ui.mjs`
   - **ìŠ¤í¬ë¦°ìƒ· 10ì¥**: `test-screenshots/` ë””ë ‰í† ë¦¬
   - **ê²€ì¦ í•­ëª© 8ê°€ì§€ ì „ë¶€ PASS**:
     1. í˜ì´ì§€ ë¡œë“œ ì‹œ JS ì—ëŸ¬ ì—†ìŒ (WebSocket ê´€ë ¨ ì œì™¸)
     2. íƒ­ ë°”ì— 6ê°œ íƒ­ (File, Modeling, Pre-process, Solve, Post-process, View) í‘œì‹œ í™•ì¸
     3. Undo/Redo ì•„ì´ì½˜ ë²„íŠ¼ (#btn-undo-top, #btn-redo-top) ìƒë‹¨ ìš°ì¸¡ ìœ„ì¹˜ í™•ì¸
     4. File íƒ­ ê¸°ë³¸ í™œì„± ìƒíƒœ (active í´ë˜ìŠ¤) + Models/Import/ì¢Œí‘œì„¤ì • ì„¹ì…˜ í™•ì¸
     5. ê° íƒ­ í´ë¦­ â†’ íŒ¨ë„ ì „í™˜ í™•ì¸:
        - Modeling: Drill í† ê¸€/ë°˜ê²½/Voxel Resolution/History
        - Pre-process: BC íƒ€ì… ë¼ë””ì˜¤(Fixed/Force)/ë¸ŒëŸ¬ì‰¬ ë°˜ê²½/ì¬ë£Œ ì„¤ì •
        - Solve: ì†”ë²„ ì„ íƒ(FEM/PD/SPG)/í•´ì„ ì‹¤í–‰ ë²„íŠ¼
        - Post-process: ì‹œê°í™” ëª¨ë“œ(Displacement/Stress/Damage)/ë³€ìœ„ ìŠ¤ì¼€ì¼/ì…ì í¬ê¸°
        - View: ì¹´ë©”ë¼ í”„ë¦¬ì…‹(6ë°©í–¥)/Upì¶•/ì¡°ëª…/ë°°ê²½ìƒ‰/Grid/Axes
     6. View íƒ­ ë°°ê²½ìƒ‰ "ê²€ì •"(#1a1a1a)ìœ¼ë¡œ ë³€ê²½ â†’ ìº”ë²„ìŠ¤ ë°°ê²½ ë³€ê²½ í™•ì¸ (ìŠ¤í¬ë¦°ìƒ·)
     7. Grid/Axes ì²´í¬ë°•ìŠ¤ í•´ì œâ†’ì¬ì²´í¬ í† ê¸€ ì •ìƒ ë™ì‘ í™•ì¸
     8. ì „ì²´ í…ŒìŠ¤íŠ¸ ì¤‘ ì‹¬ê°í•œ JS ì—ëŸ¬ ì—†ìŒ í™•ì¸

2. **ì´ì „: Playwright ì›¹ UI í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë° ì „ì²´ í†µê³¼**
   - Playwright (Chromium headless)ë¡œ http://localhost:8000 ì›¹ì•± ìë™í™” í…ŒìŠ¤íŠ¸
   - **15ê°œ í•­ëª© ì „ë¶€ PASS**:
     1. í˜ì´ì§€ ì ‘ì† (http://localhost:8000)
     2. íƒ€ì´í‹€ í™•ì¸ ("Spine Surgery Simulator")
     3. STL ëª¨ë¸ ìë™ ë¡œë“œ (disc 8312 tris, L5 17620 tris, L4 34500 tris)
     4. ì´ˆê¸° ìƒíƒœ ìŠ¤í¬ë¦°ìƒ·
     5. Analysis ë²„íŠ¼ í´ë¦­
     6. Analysis íŒ¨ë„ í‘œì‹œ
     7. Analysis ëª¨ë“œ ìŠ¤í¬ë¦°ìƒ·
     8. BC Force ë³€ê²½ + Force ì…ë ¥ UI í‘œì‹œ
     9. ì¬ë£Œ í”„ë¦¬ì…‹ ë“œë¡­ë‹¤ìš´ (Bone/Disc/Ligament/Titanium)
     10. ì†”ë²„ ë“œë¡­ë‹¤ìš´ (FEM/PD/SPG)
     11. Post-process ëª¨ë“œ ì „í™˜
     12. Post-process ëª¨ë“œ ìŠ¤í¬ë¦°ìƒ·
     13. Pre-process ëª¨ë“œ ë³µê·€
     14. ìµœì¢… ìŠ¤í¬ë¦°ìƒ·
   - WebSocket ì„œë²„ ì—°ê²° ìƒíƒœ: **ì—°ê²°ë¨** (ë…¹ìƒ‰)
   - ìŠ¤í¬ë¦°ìƒ· 4ì¥ ì €ì¥: `src/fea/tests/screenshots/`
   - **í…ŒìŠ¤íŠ¸ íŒŒì¼**: `src/fea/tests/test_web_ui_playwright.mjs`

1. **Pre/Post Processor + GPU ì§€ì› MVP êµ¬í˜„**
   - **FastAPI + WebSocket ì„œë²„** (`src/server/`)
     - `app.py`: FastAPI ì•± â€” ì •ì  íŒŒì¼ ì„œë¹™ + WebSocket ì—”ë“œí¬ì¸íŠ¸
     - `models.py`: Pydantic ëª¨ë¸ (BoundaryCondition, MaterialRegion, AnalysisRequest)
     - `ws_handler.py`: WebSocket í•¸ë“¤ëŸ¬ â€” í•´ì„ ì‹¤í–‰ + ì§„í–‰ë¥  ì‹¤ì‹œê°„ ì „ì†¡
     - `analysis_pipeline.py`: FEA framework í˜¸ì¶œ íŒŒì´í”„ë¼ì¸ â€” GPU ìë™ ì„ íƒ (Vulkanâ†’CPU í´ë°±)
   - **í”„ë¡ íŠ¸ì—”ë“œ JS ëª¨ë“ˆ** (`src/simulator/src/`)
     - `ws.js`: WebSocket í´ë¼ì´ì–¸íŠ¸ â€” ìë™ ì¬ì—°ê²°, ì½œë°± ë ˆì§€ìŠ¤íŠ¸ë¦¬
     - `colormap.js`: Jet ì»¬ëŸ¬ë§µ ìœ í‹¸ë¦¬í‹° â€” valuesToColors(), createColorbar()
     - `pre.js`: PreProcessor â€” ë©´ ì„ íƒ(BFS), ê²½ê³„ì¡°ê±´ ì„¤ì •, ì¬ë£Œ í• ë‹¹, í•´ì„ ìš”ì²­ ì¡°ë¦½
     - `post.js`: PostProcessor â€” ì»¬ëŸ¬ë§µ ì‹œê°í™” (ë³€ìœ„/ì‘ë ¥/ì†ìƒ ëª¨ë“œ), Points ë Œë”ë§
   - **UI í†µí•©** (`index.html`, `main.js`)
     - Analysis ë„êµ¬ ë²„íŠ¼ + Analysis íŒ¨ë„ (Pre/Post ëª¨ë“œ í† ê¸€)
     - ì „ì²˜ë¦¬: ë©´ ì„ íƒ, Fixed/Force BC, ì¬ë£Œ í”„ë¦¬ì…‹, ì†”ë²„ ì„ íƒ, í•´ì„ ì‹¤í–‰
     - í›„ì²˜ë¦¬: ì‹œê°í™” ëª¨ë“œ, ë³€ìœ„ ìŠ¤ì¼€ì¼, ì…ì í¬ê¸°, ì»¬ëŸ¬ë°”
     - ì§„í–‰ë¥  ë°” + í†µê³„ í‘œì‹œ
   - **ì˜ì¡´ì„± ì¶”ê°€**: fastapi, uvicorn[standard], websockets
   - **ì„œë²„ ì‹¤í–‰**: `uv run python -m src.server.app` â†’ http://localhost:8000
   - **ê²€ì¦**: ì„œë²„ ì‘ë‹µ 200, ëª¨ë“  ì •ì  íŒŒì¼ ì •ìƒ ì„œë¹™, ëª¨ë“ˆ ì„í¬íŠ¸ ì •ìƒ

1. **PD/SPG ë‹¤ì¤‘ ì¬ë£Œ(per-particle) ì§€ì› ì¶”ê°€**
   - PD: `ParticleSystem`ì— `bulk_mod`, `shear_mod` per-particle í•„ë“œ ì¶”ê°€
   - SPG: `SPGParticleSystem`ì— `lam_param`, `mu_param` per-particle í•„ë“œ ì¶”ê°€
   - ì»¤ë„ ìˆ˜ì •: `nosb.compute_force_state_with_stabilization()` â†’ ì…ìë³„ ì¬ë£Œ ìƒìˆ˜ ì‚¬ìš©
   - ì»¤ë„ ìˆ˜ì •: `spg_compute.compute_stress()` â†’ ì…ìë³„ ì¬ë£Œ ìƒìˆ˜ ì‚¬ìš©
   - í¸ì˜ ë©”ì„œë“œ: `set_material_constants()` (ë‹¨ì¼), `set_material_constants_per_particle()` (ë‹¤ì¤‘)
   - ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ì „ë¶€ í†µê³¼ (PD ë²¤ì¹˜ë§ˆí¬ 5ê°œ, SPG 31ê°œ í…ŒìŠ¤íŠ¸)
   - **ìˆ˜ì • íŒŒì¼**: `peridynamics/core/particles.py`, `peridynamics/core/nosb.py`, `peridynamics/solver/nosb_solver.py`, `peridynamics/tests/benchmark_analytical.py`, `spg/core/particles.py`, `spg/core/spg_compute.py`, `spg/solver/explicit_solver.py`, `spg/tests/test_spg_validation.py`, `spg/tests/test_spg.py`, `tests/benchmark_spine_compression.py`

2. **L4+disc+L5 ë³µì…€í™” â†’ FEM/PD/SPG ì••ì¶• ë¹„êµ ë²¤ì¹˜ë§ˆí¬** - `src/fea/tests/benchmark_spine_compression.py`
   - STL 3ê°œ(L4, disc, L5)ë¥¼ í•˜ë‚˜ì˜ ë³µì…€ ê·¸ë¦¬ë“œë¡œ í•©ì¹˜ëŠ” íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
   - ë ˆì´ìºìŠ¤íŒ… ë³µì…€í™” (MÃ¶llerâ€“Trumbore, numpy ë²¡í„°í™”, 3.5ì´ˆ/3ê°œ STL)
   - ë³µì…€ â†’ HEX8 ë©”ì‰¬ ë³€í™˜ (ë…¸ë“œ ê³µìœ /ì¤‘ë³µ ì œê±°)
   - ë³µì…€ â†’ ì…ì ë³€í™˜ (PD/SPGìš©)
   - **FEM ë‹¤ì¤‘ ì¬ë£Œ ì§€ì›**: `StaticSolver`ì— `materials` ë”•ì…”ë„ˆë¦¬ ì¶”ê°€
     - ìš”ì†Œë³„ `material_id`ì— ë”°ë¼ ë‹¤ë¥¸ íƒ„ì„± í…ì„œ ì‚¬ìš©
     - ë¼ˆ(15000 MPa) + ë””ìŠ¤í¬(10 MPa) ë™ì‹œ í•´ì„
   - **3-ì†”ë²„ ë¹„êµ ê²°ê³¼** (2484 ë³µì…€, 4.16mm ê°„ê²©) â€” **ëª¨ë‘ ë‹¤ì¤‘ ì¬ë£Œ ì§€ì›**:

   | ì†”ë²„ | ë‹¤ì¤‘ì¬ë£Œ | z-ë³€ìœ„ (mm) | ìµœëŒ€ì‘ë ¥ (MPa) | ì‹œê°„ |
   |------|---------|------------|--------------|------|
   | FEM (HEX8) | O | -1.35e-02 | 9.00 | 2.5ì´ˆ |
   | NOSB-PD | O | -5.25e-03 | 2.13 | 0.5ì´ˆ |
   | SPG | O | -5.27e-03 | 0.77 | 0.2ì´ˆ |

   - FEM: ë‹¤ì¤‘ ì¬ë£Œë¡œ ë””ìŠ¤í¬ ì˜ì—­ì—ì„œ ë” í° ì‘ë ¥ (ë¼ˆ 0.16 vs ë””ìŠ¤í¬ 2.75 MPa)
   - PD/SPG: ë‹¤ì¤‘ ì¬ë£Œ ì ìš©, ë™ì¼ ë³€ìœ„ ì ìš© ì‹œ ê±°ì˜ ê°™ì€ ë³€ìœ„ (-5.25e-03 mm)
   - ì„¸ ì†”ë²„ ë³€ìœ„ ë¹„ìœ¨ max/min = 2.6 (ê°™ì€ order of magnitude)
   - ì‹¤í–‰: `uv run python src/fea/tests/benchmark_spine_compression.py`
   - **ì‹ ê·œ íŒŒì¼**: `src/fea/tests/__init__.py`, `src/fea/tests/benchmark_spine_compression.py`
   - **ìˆ˜ì • íŒŒì¼**: `src/fea/fem/solver/static_solver.py` (ë‹¤ì¤‘ ì¬ë£Œ ì§€ì›)

2. **ë“œë¦´ì„ êµ¬ì²´(Sphere) ë°©ì‹ìœ¼ë¡œ ë³€ê²½** - `src/simulator/src/voxel.js`, `src/simulator/src/main.js`
   - ê¸°ì¡´ ìº¡ìŠ(ì›í†µ+ë°˜êµ¬) ë“œë¦´ â†’ êµ¬ì²´(Sphere) ë“œë¦´ë¡œ ì „í™˜
   - `previewDrill(worldPos, radius)`: êµ¬ì²´ ë²”ìœ„ ë‚´ ì˜í–¥ ë³µì…€ í”„ë¦¬ë·°
   - `drillWithSphere(worldPos, radius)`: êµ¬ì²´ë¡œ ì‹¤ì œ ë³µì…€ ì œê±°
   - ë“œë¦´ í”„ë¦¬ë·°: íšŒìƒ‰ ë°˜íˆ¬ëª… êµ¬ì²´ (`0xaaaaaa`, opacity 0.35)
   - Depth íŒŒë¼ë¯¸í„°/ìŠ¬ë¼ì´ë” ì œê±° (êµ¬ì²´ëŠ” radiusë§Œ í•„ìš”)

2. **CAD ìŠ¤íƒ€ì¼ ë„¤ë¹„ê²Œì´ì…˜ìœ¼ë¡œ ë³€ê²½** - `src/simulator/src/main.js`
   - Navigate ë„êµ¬ ì œê±° â†’ ë„¤ë¹„ê²Œì´ì…˜ì€ í•­ìƒ ê¸°ë³¸ íƒ‘ì¬
   - ìš°í´ë¦­ ë“œë˜ê·¸ = íšŒì „ (í•­ìƒ), ì¤‘í´ë¦­ ë“œë˜ê·¸ = íŒ¬ (í•­ìƒ), ìŠ¤í¬ë¡¤ = ì¤Œ (í•­ìƒ)
   - ì¢Œí´ë¦­ = ë„êµ¬ ì—†ìœ¼ë©´ íšŒì „, ë„êµ¬ ìˆìœ¼ë©´ ë„êµ¬ ì‚¬ìš©
   - ë„êµ¬ í† ê¸€ ë°©ì‹ (ê°™ì€ ë²„íŠ¼ ë‹¤ì‹œ í´ë¦­ ì‹œ í•´ì œ)

3. **ë¶ˆí•„ìš”í•œ UI ê¸°ëŠ¥ ì œê±°** - `src/simulator/index.html`, `src/simulator/src/main.js`
   - Slice View (ë‹¨ë©´ ë·°) ì „ì²´ ì œê±°: HTML íŒ¨ë„ + JS í•¨ìˆ˜ (~240ì¤„)
   - Measure ë²„íŠ¼ ì œê±° (ë¯¸êµ¬í˜„ ìƒíƒœì˜€ìŒ)

4. **ë“œë¦´ í´ë¦­ ë²„ê·¸ ìˆ˜ì •** - `src/simulator/src/main.js`
   - ì›ì¸: OrbitControlsê°€ `pointerdown`ì—ì„œ `preventDefault()` í˜¸ì¶œ â†’ `mousedown` ì´ë²¤íŠ¸ ì°¨ë‹¨
   - ìˆ˜ì •: ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ `mousedown/move/up` â†’ `pointerdown/move/up`ìœ¼ë¡œ ë³€ê²½

## ì‘ì—… ë‚´ì—­ (2026-02-15)

### ì™„ë£Œ

0. **ê°•ì²´(Rigid Body) + Coulomb ë§ˆì°° ì ‘ì´‰ êµ¬í˜„** - `src/fea/framework/`
   - Wu et al. (2026, JMBBM) ë…¼ë¬¸ ê¸°ë°˜ ë‚˜ì‚¬ ì‚½ì…/pullout ì‹œë®¬ë ˆì´ì…˜ ì¤€ë¹„
   - **ì‹ ê·œ íŒŒì¼:**
     - `rigid_body.py`: RigidBody, PrescribedMotion, create_rigid_body
     - `_adapters/rigid_adapter.py`: RigidBodyAdapter (AdapterBase êµ¬í˜„, ë¦¬ì•¡ì…˜ í˜ ê¸°ë¡)
     - `tests/test_rigid_body.py`: ë‹¨ìœ„ 24ê°œ + í†µí•© 2ê°œ = 26ê°œ í…ŒìŠ¤íŠ¸
     - `tests/test_friction.py`: ë§ˆì°° 8ê°œ í…ŒìŠ¤íŠ¸
   - **ìˆ˜ì • íŒŒì¼:**
     - `domain.py`: Method.RIGID enum ì¶”ê°€
     - `contact.py`: ContactDefinitionì— static_friction/dynamic_friction í•„ë“œ, compute_forces_with_friction() (penalty-regularized Coulomb)
     - `scene.py`: add() material Optional, _build() RIGID ë¶„ê¸°, quasi_static/explicitì—ì„œ rigid body ì²˜ë¦¬, ë§ˆì°° ì ‘ì´‰ ë¶„ê¸°, _get_velocity() í—¬í¼
     - `__init__.py`: RigidBody, PrescribedMotion, create_rigid_body export
   - **ê°•ì²´ ê¸°ëŠ¥:**
     - ê·œì • ìš´ë™: íšŒì „(Rodrigues) + ë³‘ì§„, ìˆœì°¨ ì ìš©
     - 2D/3D ì§€ì›, Duck typingìœ¼ë¡œ Scene í˜¸í™˜
     - ë¦¬ì•¡ì…˜ í˜ ê¸°ë¡ (pullout force ì¸¡ì •ìš©)
   - **Coulomb ë§ˆì°°:**
     - Penalty-regularized stick/slip ë¶„ë¥˜
     - |f_t| â‰¤ Î¼_s Ã— |f_n| (stick), f_t = Î¼_d Ã— |f_n| Ã— dir (slip)
     - ì‘ìš©-ë°˜ì‘ìš© ë³´ì¡´ í™•ì¸ë¨
   - **í…ŒìŠ¤íŠ¸: 32ê°œ ì‹ ê·œ, 70ê°œ ì „ì²´ í”„ë ˆì„ì›Œí¬ í†µê³¼**

---

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-08)

### ì™„ë£Œ

0. **ë‹¤ì¤‘ ë¬¼ì²´ ì ‘ì´‰ í•´ì„ í”„ë ˆì„ì›Œí¬** - `src/fea/framework/`
   - FEM-FEM, FEM-SPG, SPG-SPG ë“± ì´ì¢… ì†”ë²„ ê°„ ì ‘ì´‰ í•´ì„ ì§€ì›
   - ë…¸ë“œ-ë…¸ë“œ í˜ë„í‹° ì ‘ì´‰ ì•Œê³ ë¦¬ì¦˜ (KDTree ê¸°ë°˜)
   - **3ê°€ì§€ í•´ì„ ëª¨ë“œ:**
     - `quasi_static` (ê¸°ë³¸, ê¶Œì¥): ëª¨ë“  body ë™ì‹œ step + ë§¤ ìŠ¤í… ì ‘ì´‰ë ¥ ê°±ì‹  + KE ìˆ˜ë ´ íŒì •
     - `static`: Staggered ì •ì  (FEM-FEM ì „ìš©)
     - `explicit`: ë™ê¸°í™” ëª…ì‹œì  (ìˆ˜ë ´ ì²´í¬ ì—†ì´ n_steps ì§„í–‰)
   - **Scene API:**
     ```python
     from src.fea.framework import init, create_domain, Material, Method, Scene, ContactType
     init()
     bone = create_domain(Method.SPG, dim=2, ...)
     screw = create_domain(Method.FEM, dim=2, ...)
     scene = Scene()
     scene.add(bone, bone_mat)
     scene.add(screw, screw_mat)
     scene.add_contact(bone, screw, method=ContactType.PENALTY, penalty=1e8)
     result = scene.solve(mode="quasi_static")  # ë˜ëŠ” "static", "explicit"
     u_bone = scene.get_displacements(bone)
     ```
   - **ì‹ ê·œ íŒŒì¼:**
     - `contact.py`: ContactType enum, NodeNodeContact ì•Œê³ ë¦¬ì¦˜
     - `scene.py`: Scene í´ë˜ìŠ¤, Body ê´€ë¦¬, ì •ì /ëª…ì‹œì  ë©€í‹°ë°”ë”” ì†”ë²„
     - `_adapters/base_adapter.py`: AdapterBase ABC (ì ‘ì´‰ ì¸í„°í˜ì´ìŠ¤)
   - **ìˆ˜ì • íŒŒì¼:**
     - `_adapters/fem_adapter.py`: AdapterBase ìƒì†, ì ‘ì´‰ë ¥ inject/clear ì¶”ê°€
     - `_adapters/pd_adapter.py`: AdapterBase ìƒì†, ì ‘ì´‰ë ¥ inject/clear ì¶”ê°€
     - `_adapters/spg_adapter.py`: AdapterBase ìƒì†, ì ‘ì´‰ë ¥ inject/clear ì¶”ê°€
     - `domain.py`: `select_boundary()` ë©”ì„œë“œ ì¶”ê°€
     - `__init__.py`: Scene, ContactType export ì¶”ê°€
   - **ì ‘ì´‰ ë§¤ê°œë³€ìˆ˜ ìë™ ì¶”ì •:** penalty = E_avg/spacing, gap_tol = 1.5Ã—max_spacing
   - **í…ŒìŠ¤íŠ¸: 19ê°œ ì‹ ê·œ** (ì ‘ì´‰ ì•Œê³ ë¦¬ì¦˜ 6 + ê²½ê³„ê°ì§€ 2 + Scene API 4 + FEM-FEM í†µí•© 2 + SPG ì¤€ì •ì  2 + ëª¨ë“œì„ íƒ 2 + ìë™ì¶”ì • 1)
   - **ì „ì²´ í…ŒìŠ¤íŠ¸: 163 passed, 0 failed**

1. **í†µí•© FEA í”„ë ˆì„ì›Œí¬ êµ¬í˜„** - `src/fea/framework/`
   - FEM, Peridynamics, SPG ì„¸ ì†”ë²„ë¥¼ ë™ì¼í•œ APIë¡œ ì‚¬ìš© ê°€ëŠ¥
   - `Method.FEM` / `Method.PD` / `Method.SPG` ì „í™˜ë§Œìœ¼ë¡œ ì†”ë²„ êµì²´
   - GPU ìë™ ê°ì§€ (Vulkan â†’ CPU í´ë°±), ì •ë°€ë„(f32/f64) ì„¤ì •
   - **í†µí•© API ì˜ˆì‹œ:**
     ```python
     from src.fea.framework import init, create_domain, Material, Solver, Method
     init()
     domain = create_domain(Method.FEM, dim=2, origin=(0,0), size=(1.0, 0.2), n_divisions=(50, 10))
     left = domain.select(axis=0, value=0.0)
     right = domain.select(axis=0, value=1.0)
     domain.set_fixed(left)
     domain.set_force(right, [100.0, 0.0])
     mat = Material(E=1e6, nu=0.3, density=1000, dim=2)
     solver = Solver(domain, mat)
     result = solver.solve()
     u = solver.get_displacements()
     ```
   - **íŒŒì¼ êµ¬ì¡°:**
     - `runtime.py`: Taichi ì´ˆê¸°í™” ì¤‘ì•™ ê´€ë¦¬, GPU ê°ì§€, Backend/Precision enum
     - `domain.py`: create_domain() íŒ©í† ë¦¬ + Domain í´ë˜ìŠ¤ (select, set_fixed, set_force)
     - `material.py`: Material ë°ì´í„° í´ë˜ìŠ¤ (E, nu, density â†’ ì†”ë²„ë³„ ì¬ë£Œ ì§€ì—° ìƒì„±)
     - `solver.py`: Solver í†µí•© í´ë˜ìŠ¤ (ì–´ëŒ‘í„° ìë™ ì„ íƒ)
     - `result.py`: SolveResult ë°ì´í„° í´ë˜ìŠ¤
     - `_adapters/`: FEM, PD, SPG ì–´ëŒ‘í„° (Adapter íŒ¨í„´, ê¸°ì¡´ ì½”ë“œ ë¯¸ìˆ˜ì •)
   - **í…ŒìŠ¤íŠ¸: 19ê°œ ì‹ ê·œ (ëŸ°íƒ€ì„ 3 + ë„ë©”ì¸ 4 + ì¬ë£Œ 2 + FEM 2 + SPG 1 + PD 2 + êµì°¨ê²€ì¦ 1 + API 4)**
   - **ì „ì²´ í…ŒìŠ¤íŠ¸: 144 passed, 0 failed (ê¸°ì¡´ 125 + ì‹ ê·œ 19)**

2. **ë ˆê±°ì‹œ `spine_sim` import ì¼ê´„ ìˆ˜ì •**
   - 14ê°œ Python íŒŒì¼ì—ì„œ `spine_sim.*` â†’ `src.*` import ê²½ë¡œ ë³€í™˜
   - ë¶ˆí•„ìš” ì½”ë“œ ì‚­ì œ (spine_sim/, framework/, dead tests ë“±)
   - **ì „ì²´ í…ŒìŠ¤íŠ¸: 125 passed, 0 skipped, 0 failed**

2. **SPG (Smoothed Particle Galerkin) ì†”ë²„ ì¶”ê°€ ë° ê²€ì¦** - `src/fea/spg/`
   - ê·¹í•œ ë³€í˜• ë° ì¬ë£Œ íŒŒê´´ í•´ì„ì„ ìœ„í•œ ë¬´ê²©ì(meshfree) ë°©ë²•
   - **ê²€ì¦ í…ŒìŠ¤íŠ¸ í¬í•¨ 31ê°œ ì „ë¶€ í†µê³¼**

3. **FEM 2D í˜¸í™˜ì„± ë²„ê·¸ ìˆ˜ì •** - `src/fea/fem/material/linear_elastic.py`
   - `_compute_forces_kernel`ì—ì„œ 3D í•˜ë“œì½”ë”© (ë²¡í„° í¬ê¸°, ë£¨í”„ ë²”ìœ„) â†’ ì°¨ì› ì¼ë°˜í™”
   - `ti.static(self.dim)` ì‚¬ìš©ìœ¼ë¡œ 2D/3D ëª¨ë‘ ì§€ì›
   - `nodes_per_elem` ë§¤ê°œë³€ìˆ˜ ì¶”ê°€ (TET4 4ë…¸ë“œ í•˜ë“œì½”ë”© ì œê±°)

4. **FEM í•´ì„í•´ ë¹„êµ ë²¤ì¹˜ë§ˆí¬** - `src/fea/fem/tests/benchmark_analytical.py`
   - 5ê°œ í‘œì¤€ ë¬¸ì œë¡œ FEM ì†”ë²„ì˜ ë¬¼ë¦¬ì  ì •í™•ë„ ê²€ì¦

   | ë²¤ì¹˜ë§ˆí¬ | ì£¼ìš” ì˜¤ì°¨ | í‰ê°€ |
   |---------|----------|------|
   | ê· ì¼ ì¸ì¥ ë´‰ (2D QUAD4, í‰ë©´ì‘ë ¥) | 0.28% | ì–‘í˜¸ |
   | ê· ì¼ ì¸ì¥ ë´‰ (3D HEX8) | 0.95% | ì–‘í˜¸ |
   | ì™¸íŒ”ë³´ (2D QUAD4, Timoshenko) | 1.23% | ì–‘í˜¸ |
   | 3D íë¸Œ ì••ì¶• (HEX8) | 3.44% | ì–‘í˜¸ |
   | ê²©ì ìˆ˜ë ´ìœ¨ (ì™¸íŒ”ë³´) | rate=1.33 | ë³´í†µ |

   - ì‹¤í–‰: `uv run python src/fea/fem/tests/benchmark_analytical.py`

5. **Peridynamics í•´ì„í•´ ë¹„êµ ë²¤ì¹˜ë§ˆí¬** - `src/fea/peridynamics/tests/benchmark_analytical.py`
   - 5ê°œ í‘œì¤€ ë¬¸ì œë¡œ PD ì†”ë²„ì˜ ë¬¼ë¦¬ì  ì •í™•ë„ ê²€ì¦

   | ë²¤ì¹˜ë§ˆí¬ | ì£¼ìš” ì˜¤ì°¨ | í‰ê°€ |
   |---------|----------|------|
   | Bond-based ì¸ì¥ (2D) | 0.00% | ì–‘í˜¸ |
   | NOSB-PD ì¸ì¥ (2D) | 0.00% | ì–‘í˜¸ |
   | NOSB-PD 3D ì••ì¶• | 0.00% | ì–‘í˜¸ |
   | ì—ë„ˆì§€ ë³´ì¡´ (Explicit) | 133% ë³€ë™ | ë¯¸í¡ |
   | ê²©ì ìˆ˜ë ´ìœ¨ (F ì •í™•ë„) | rate=1.26 | ì–‘í˜¸ |

   - ì—ë„ˆì§€ ë³´ì¡´ 133% ë³€ë™: ëª…ì‹œì  ì†”ë²„ì˜ ì‹œê°„ ì ë¶„ í•œê³„ (í–¥í›„ ê°œì„ )
   - ì‹¤í–‰: `uv run python src/fea/peridynamics/tests/benchmark_analytical.py`

6. **SPG í•´ì„í•´ ë¹„êµ ë²¤ì¹˜ë§ˆí¬** - `src/fea/spg/tests/benchmark_analytical.py`
   - 5ê°œ í‘œì¤€ ë¬¸ì œë¡œ SPG ì†”ë²„ì˜ ë¬¼ë¦¬ì  ì •í™•ë„ ê²€ì¦

   | ë²¤ì¹˜ë§ˆí¬ | ì£¼ìš” ì˜¤ì°¨ | í‰ê°€ |
   |---------|----------|------|
   | ê· ì¼ ì¸ì¥ ë´‰ | 6.8% | ì–‘í˜¸ |
   | ì™¸íŒ”ë³´ (Cantilever) | 17.3% | ë³´í†µ |
   | ì–‘ë‹¨ ê³ ì • ë³´ (Clamped) | 14.1% | ë³´í†µ |
   | 3D íë¸Œ ì••ì¶• | 13.2% | ë³´í†µ (ë²”ìœ„ ë‚´) |
   | ê²©ì ìˆ˜ë ´ìœ¨ | rate=1.02 | ì–‘í˜¸ |

   - ì‹¤í–‰: `uv run python src/fea/spg/tests/benchmark_analytical.py`

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-06)

### ì™„ë£Œ
1. **ëª¨ë¸ ì¢Œí‘œ ì‹œìŠ¤í…œ ê°œì„ ** - `src/simulator/src/main.js`
   - STL íŒŒì¼ì˜ ì›ë³¸ ì¢Œí‘œ ìœ ì§€ í›„ ì „ì²´ ëª¨ë¸ì„ ì›ì  ì¤‘ì‹¬ìœ¼ë¡œ ìë™ ë°°ì¹˜
   - geometry ì •ì  ì§ì ‘ ì´ë™ ë°©ì‹ìœ¼ë¡œ ë³€ê²½ (mesh.position ëŒ€ì‹  vertex ì´ë™)
   - ë³µì…€í™”/ë ˆì´ìºìŠ¤íŠ¸ì™€ì˜ ì¢Œí‘œ ì •í™•ë„ ë³´ì¥
   - `centerToOrigin` ê¸°ë³¸ê°’ `true`ë¡œ ë³€ê²½

2. **ë™ì  ê·¸ë¦¬ë“œ/ì¶• í—¬í¼**
   - ëª¨ë¸ í¬ê¸°ì— ë¹„ë¡€í•˜ì—¬ ê·¸ë¦¬ë“œ ìë™ ì¡°ì ˆ (2ë°° í¬ê¸°, 5~10mm ê°„ê²©)
   - ì¶• í—¬í¼ë„ ëª¨ë¸ì— ë§ê²Œ ìŠ¤ì¼€ì¼ë§

3. **ëª¨ë¸ ì •ë³´ í‘œì‹œ UI**
   - ì‚¬ì´ë“œë°”ì— ëª¨ë¸ í¬ê¸°/ì¤‘ì‹¬/min-max ì¢Œí‘œ ì‹¤ì‹œê°„ í‘œì‹œ
   - ë³µì…€ ëª¨ë“œì™€ ì›ë³¸ ëª¨ë“œ ëª¨ë‘ ì§€ì›

4. **ê¹Šì´ ë“œë¦´ë§ êµ¬í˜„** - `src/simulator/src/voxel.js`, `src/simulator/src/main.js`
   - `drillCylinder()` ë©”ì„œë“œ ì¶”ê°€: ìº¡ìŠ(ì›í†µ+ë°˜êµ¬) í˜•íƒœë¡œ ê¹Šì´ ë°©í–¥ ë“œë¦´ë§
   - í‘œë©´ ë²•ì„  ë°©í–¥ìœ¼ë¡œ ì§€ì •ëœ ê¹Šì´ë§Œí¼ ê´€í†µ
   - ë“œë¦´ í”„ë¦¬ë·°: êµ¬(sphere) â†’ ì›í†µ+ë§+ê¹Šì´ë””ìŠ¤í¬+ì¶•ì„ ìœ¼ë¡œ ë³€ê²½
   - í”„ë¦¬ë·°ê°€ í‘œë©´ ë²•ì„  ë°©í–¥ì— ë§ì¶° ìë™ íšŒì „
   - Depth ìŠ¬ë¼ì´ë” ì‹¤ì œ ì ìš© (ê¸°ì¡´ì—” ë¯¸ì‚¬ìš©)
   - ìƒíƒœë°”ì— ì‹¤ì‹œê°„ ë“œë¦´ ë°˜ì§€ë¦„/ê¹Šì´ í‘œì‹œ

5. **ë“œë¦´ í”„ë¦¬ë·° í•˜ì´ë¼ì´íŠ¸** - `src/simulator/src/voxel.js`, `src/simulator/src/main.js`
   - `previewDrill()` ë©”ì„œë“œ ì¶”ê°€: ì œê±°ë  ë³µì…€ ì¢Œí‘œ ëª©ë¡ ë°˜í™˜ (ì‹¤ì œ ì œê±° ì—†ìŒ)
   - `drillCylinder()`ê°€ `previewDrill()` ì¬ì‚¬ìš©í•˜ë„ë¡ ë¦¬íŒ©í† ë§
   - InstancedMesh ê¸°ë°˜ ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŠ¸ (ë¹¨ê°„ ë³µì…€ ì˜¤ë²„ë ˆì´)
   - hover=í”„ë¦¬ë·°, click=ì‹¤ì œ ë“œë¦´ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
   - ì˜í–¥ ë³µì…€ ìˆ˜ ìƒíƒœë°” í‘œì‹œ (ì˜ˆ: D=10 (336))

## ì´ì „ ì‘ì—… ë‚´ì—­ (2026-02-03)

### ì™„ë£Œ
1. **NRRD ë¡œë”© ê¸°ëŠ¥** - `src/simulator/src/nrrd.js`
   - 3D Slicer ë³¼ë¥¨/ì„¸ê·¸ë©˜í…Œì´ì…˜ íŒŒì¼ ë¡œë”©
   - Gzip ì••ì¶• ì§€ì› (pako ë¼ì´ë¸ŒëŸ¬ë¦¬)
   - ì—…ìƒ˜í”Œë§/ë‹¤ìš´ìƒ˜í”Œë§ ì§€ì›

2. **í•´ìƒë„ ì¡°ì ˆ UI**
   - STL ë³µì…€í™”: 32~192 ìŠ¬ë¼ì´ë” + Re-voxelize ë²„íŠ¼
   - NRRD: Trilinear ë³´ê°„ ì—…ìƒ˜í”Œë§

3. **íŒŒì¼ êµ¬ì¡° ì •ë¦¬**
   - `spine_sim/` â†’ `src/`
   - `analysis/` â†’ `fea/`
   - `web/` â†’ `simulator/`
   - ì§„í–‰ìƒí™© íŒŒì¼ â†’ `docs/`
   - í…ŒìŠ¤íŠ¸ íŒŒì¼ â†’ `tests/` í´ë”ë¡œ ì´ë™

4. **ë ˆê±°ì‹œ ì½”ë“œ ì‚­ì œ**
   - Taichi app ì‚­ì œ
   - endoscope ëª¨ë“ˆ ì‚­ì œ
   - api í´ë” ì‚­ì œ

5. **Playwright MCP ì„¤ì¹˜**
   - `@playwright/mcp` ê¸€ë¡œë²Œ ì„¤ì¹˜
   - `~/.claude/settings.json`ì— MCP ì„œë²„ ì¶”ê°€

6. **í…ŒìŠ¤íŠ¸ í†µê³¼**
   - Solver (FEM + Peridynamics): 46ê°œ í†µê³¼
   - ì›¹ ì‹œë®¬ë ˆì´í„°: ì •ìƒ ì‘ë™ í™•ì¸

7. **STL êµ¬ì¡°í•´ì„ íŒŒì´í”„ë¼ì¸**
   - STL â†’ ë³µì…€í™” â†’ Peridynamics ì…ì ë³€í™˜
   - L5 ì²™ì¶” ì••ì¶• í•´ì„ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

8. **FEA ì‹œê°í™” ì›¹ ë·°ì–´** - `src/fea/visualization/`
   - Three.js ê¸°ë°˜ ê²°ê³¼ ì‹œê°í™”
   - Displacement/Strain/Damage ëª¨ë“œ
   - NPZ â†’ JSON ë³€í™˜ ë„êµ¬

9. **Undo/Redo ê¸°ëŠ¥** - `src/simulator/`
   - ë³µì…€ ìŠ¤ëƒ…ìƒ· ì €ì¥/ë³µì›
   - Ctrl+Z/Y í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
   - ìµœëŒ€ 30ë‹¨ê³„ íˆìŠ¤í† ë¦¬

10. **ë‹¨ë©´ ë·° (Slice View)**
    - X(Sagittal)/Y(Coronal)/Z(Axial) ì¶• ì„ íƒ
    - ìœ„ì¹˜ ìŠ¬ë¼ì´ë” (0~100%)
    - ClippingPlane + ë°˜íˆ¬ëª… í—¬í¼ í‰ë©´

## í˜„ì¬ êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ëª¨ë“ˆ

#### ì›¹ ì‹œë®¬ë ˆì´í„° (`src/simulator/`)
- STL ë¡œë”© (L4, L5 ì²™ì¶”)
- NRRD ë¡œë”© (3D Slicer í˜¸í™˜)
- ë³µì…€ ê¸°ë°˜ êµ¬ì²´ ë“œë¦´ë§ + Marching Cubes
- í•´ìƒë„ ì¡°ì ˆ UI (32~192)
- **Undo/Redo** (Ctrl+Z/Y, ìµœëŒ€ 30ë‹¨ê³„)
- **CAD ìŠ¤íƒ€ì¼ ë„¤ë¹„ê²Œì´ì…˜** - ìš°í´ë¦­=íšŒì „, ì¤‘í´ë¦­=íŒ¬, íœ =ì¤Œ (í•­ìƒ í™œì„±)
- **ì¢Œí‘œ ì‹œìŠ¤í…œ ê°œì„ ** - ì›ë³¸ ì¢Œí‘œ ìœ ì§€ + ìë™ ì›ì  ì¤‘ì‹¬ ë°°ì¹˜
- **ë™ì  ê·¸ë¦¬ë“œ** - ëª¨ë¸ í¬ê¸°ì— ë§ê²Œ ìë™ ì¡°ì ˆ
- **ëª¨ë¸ ì •ë³´ UI** - í¬ê¸°/ì¤‘ì‹¬/ë²”ìœ„ ì‹¤ì‹œê°„ í‘œì‹œ
- **ì „ì²˜ë¦¬ê¸° (Pre-process)** - êµ¬ì²´ ë¸ŒëŸ¬ì‰¬ ë³µì…€ ì„ íƒ, ê²½ê³„ì¡°ê±´(Fixed/Force), ì¬ë£Œ í”„ë¦¬ì…‹ í• ë‹¹
- **í›„ì²˜ë¦¬ê¸° (Post-process)** - ë³€ìœ„/ì‘ë ¥/ì†ìƒ ì»¬ëŸ¬ë§µ ì‹œê°í™”, ë³€ìœ„ ìŠ¤ì¼€ì¼, ì…ì í¬ê¸°
- **íƒ­ ê¸°ë°˜ CAE UI** - ìƒë‹¨ íƒ­ ë°”(File/Modeling/Pre-process/Solve/Post-process/View), ìš°ì¸¡ ì»¨í…ìŠ¤íŠ¸ ì†ì„± íŒ¨ë„, í•˜ë‹¨ ìƒíƒœë°”
- **CT/MRI íŒŒì´í”„ë¼ì¸** - NIfTI ì—…ë¡œë“œ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ 3D ëª¨ë¸ ìƒì„± (ë¼ë²¨ë³„ ë©”ì‰¬)
- **ì„í”Œë€íŠ¸ ë°°ì¹˜** - STL ì„í¬íŠ¸, TransformControls (ì´ë™/íšŒì „/ìŠ¤ì¼€ì¼), ìˆ˜ìˆ  ê³„íš JSON ì €ì¥/ë¡œë“œ
- **Material Library ì‹œìŠ¤í…œ** - ANSYS/Abaqus ìŠ¤íƒ€ì¼ ì¬ë£Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ (17ì¢… ë¹ŒíŠ¸ì¸ + ì»¤ìŠ¤í…€ ì €ì¥)
  - ì¹´í…Œê³ ë¦¬ë³„ ì¬ë£Œ DB: ê³¨(5ì¢…), ë””ìŠ¤í¬(4ì¢…), ì„í”Œë€íŠ¸(5ì¢…), ì—°ì¡°ì§(3ì¢…)
  - ë³‘ë¦¬í•™ì  í”„ë¦¬ì…‹: ê³¨ë‹¤ê³µì¦(í”¼ì§ˆê³¨/í•´ë©´ê³¨), ë””ìŠ¤í¬ í‡´í–‰(Grade III~V), ê²½í™”ê³¨, ì„íšŒí™” ì¸ëŒ€
  - ì†ì„± í¸ì§‘ê¸°: E(ëŒ€ìˆ˜ ìŠ¬ë¼ì´ë”, GPa/MPa ë‹¨ìœ„ ì „í™˜), Î½, Ï ë¯¸ì„¸ ì¡°ì •
  - ì»¤ìŠ¤í…€ ì¬ë£Œ ì €ì¥/ë¡œë“œ (localStorage)
  - SolvePanel `<optgroup>` ì¹´í…Œê³ ë¦¬ë³„ ë“œë¡­ë‹¤ìš´
- **ìë™ ì¬ë£Œ ë§¤í•‘** - SpineLabel ê¸°ë°˜ ìë™ í• ë‹¹ + Material Library ì—°ë™
- **ìˆ˜ìˆ  ì „/í›„ ë¹„êµ** - ë³€ìœ„ ì°¨ì´ ì‹œê°í™” + ì„í”Œë€íŠ¸ ì£¼ë³€ ì‘ë ¥ í•„í„° (ë°˜ê²½ ì§€ì •)
- **í•´ì„ ê²€ì¦** - ì‹¤í–‰ ì „ BC/ì¬ë£Œ/ì „ì²˜ë¦¬ê¸° ì¢…í•© ê²€ì¦, ì˜¤ë¥˜ ì‹œ Run ë²„íŠ¼ ë¹„í™œì„±í™” + ê²½ê³  í‘œì‹œ
- **í•´ì„ íƒ€ì„ì•„ì›ƒ/ì·¨ì†Œ** - 10ë¶„ ìë™ íƒ€ì„ì•„ì›ƒ + Cancel ë²„íŠ¼, ì„œë²„ asyncio.Task ì·¨ì†Œ ì§€ì›
- **WS ì§€ìˆ˜ ë°±ì˜¤í”„** - 2sâ†’4sâ†’8sâ†’16sâ†’30s ìë™ ì¬ì—°ê²° (ìµœëŒ€ 5íšŒ)
- **ë©”ëª¨ë¦¬ ê´€ë¦¬** - SceneManager dispose(): ì „ì²´ ì”¬ ë¦¬ì†ŒìŠ¤(geometry/material/texture) + GPU ì»¨í…ìŠ¤íŠ¸ í•´ì œ
- **ë Œë”ë§ ëª¨ë“œ** - Solid / Wireframe / Solid+Wire 3ì¢…, ëª¨ë¸ íˆ¬ëª…ë„/ì¡°ëª… ê°•ë„ ì¡°ì ˆ
- **í´ë¦¬í•‘ í‰ë©´** - X/Y/Z ì¶• ì„ íƒ + ìœ„ì¹˜/ë°˜ì „ ìŠ¬ë¼ì´ë” (PostProcessPanel)
- **ê²°ê³¼ ë‚´ë³´ë‚´ê¸°** - CSV ë‹¤ìš´ë¡œë“œ (node, dx, dy, dz, von_mises_stress, damage)
- **ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜** - renderer.toDataURL â†’ PNG ìë™ ë‹¤ìš´ë¡œë“œ
- **DICOM ìë™ íŒŒì´í”„ë¼ì¸ UI** - í´ë” ì„ íƒ â†’ ì—…ë¡œë“œ â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ ë©”ì‰¬ ì¶”ì¶œ â†’ Three.js ìë™ ë¡œë“œ
- 50+ FPS ì„±ëŠ¥

#### ì„œë²„ (`src/server/`)
- FastAPI + WebSocket ì‹¤ì‹œê°„ í†µì‹ 
- Python FEA framework ì§ì ‘ í˜¸ì¶œ (GPU ìë™ ê°ì§€)
- ì§„í–‰ë¥  ì‹¤ì‹œê°„ ì „ì†¡ (init â†’ setup â†’ bc â†’ solving â†’ done)
- ì •ì  íŒŒì¼ ì„œë¹™ (ì‹œë®¬ë ˆì´í„° + í•´ì„ í†µí•© ë‹¨ì¼ ì„œë²„)
- **REST ì—…ë¡œë“œ**: NIfTI/ìˆ˜ìˆ ê³„íš íŒŒì¼ ì—…ë¡œë“œ (`/api/upload`, `/api/upload_plan`)
- **ì„¸ê·¸ë©˜í…Œì´ì…˜ íŒŒì´í”„ë¼ì¸**: TotalSeg/TotalSpineSeg ì„œë²„ í˜¸ì¶œ â†’ í‘œì¤€ ë¼ë²¨ë§µ
- **ë©”ì‰¬ ì¶”ì¶œ íŒŒì´í”„ë¼ì¸**: ë¼ë²¨ë§µ â†’ Marching Cubes â†’ vertices/faces (scikit-image)
- **ìë™ ì¬ë£Œ ë§¤í•‘**: SpineLabel â†’ 20ì¢… ì¬ë£Œ DB ìë™ í• ë‹¹ (ë³‘ë¦¬í•™ì  ë³€ì´ í¬í•¨, ìˆ˜ë™ í¸ì§‘ ê°€ëŠ¥)
- **ìˆ˜ìˆ  ê³„íš ëª¨ë¸**: ImplantPlacement, SurgicalPlan (JSON ì§ë ¬í™”)
- **í•´ì„ ì·¨ì†Œ í•¸ë“¤ëŸ¬**: `cancel_analysis` WS ë©”ì‹œì§€ â†’ asyncio.Task.cancel() + `cancelled` ì‘ë‹µ
- **í…ŒìŠ¤íŠ¸: 35ê°œ** (ëª¨ë¸ 20 + ì¬ë£Œ 7 + ë©”ì‰¬ 5 + ì„¸ê·¸ë©˜í…Œì´ì…˜ 3)

#### íŒŒì´í”„ë¼ì¸ CLI (`src/pipeline/`)
- **Typer CLI**: `spine-sim` ëª…ë ¹ì–´ â€” segment, postprocess, voxelize, solve, report, pipeline, server
- **Pydantic ì„¤ì •**: TOML ê¸°ë°˜ ì„¤ì • (PipelineConfig, SegmentConfig ë“±)
- **SHA256 ìºì‹œ**: ì…ë ¥+ìŠ¤í…Œì´ì§€+íŒŒë¼ë¯¸í„° í•´ì‹œë¡œ ê²°ê³¼ ì¬ì‚¬ìš©, ìë™ ì •ë¦¬
- **5-ìŠ¤í…Œì´ì§€ íŒŒì´í”„ë¼ì¸**: segment â†’ postprocess â†’ voxelize â†’ solve â†’ report
- Rich ì½˜ì†” ì¶œë ¥ (ì§„í–‰ë¥  ìŠ¤í”¼ë„ˆ, ì»¬ëŸ¬)

#### ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ (`src/segmentation/`)
- **SpineLabel í†µí•© ë¼ë²¨**: 100ë²ˆëŒ€=ì²™ì¶”(C1~SACRUM), 200ë²ˆëŒ€=ë””ìŠ¤í¬, 300ë²ˆëŒ€=ì—°ì¡°ì§
- **TotalSegmentator (CT)**: Python API ë˜í¼, vertebrae C1~L5+sacrum
- **TotalSpineSeg (MRI)**: CLI ë˜í¼, ì²™ì¶”+ë””ìŠ¤í¬+ì²™ìˆ˜
- **SpineUnified (CT+MRI)**: nnU-Net v2 ê¸°ë°˜ í†µí•© ëª¨ë¸, 51 í´ë˜ìŠ¤, 2ì±„ë„ ì…ë ¥ (ì˜ìƒ+ë„ë©”ì¸)
- **íŒ©í† ë¦¬ íŒ¨í„´**: create_engine("totalseg"|"totalspineseg"|"spine_unified"), ë¯¸ì„¤ì¹˜ ì‹œ íŒíŠ¸ í¬í•¨ ì—ëŸ¬
- **ë¼ë²¨ ë³€í™˜**: convert_to_standard() â€” ì—”ì§„ë³„ ë¼ë²¨ â†’ SpineLabel ìë™ ë³€í™˜
- **í•™ìŠµ íŒŒì´í”„ë¼ì¸**: pseudo-label ìƒì„±, ë¼ë²¨ ë³‘í•©, nnU-Net í˜•ì‹ ë³€í™˜ (training/)

#### FEA (`src/fea/`)
- **í†µí•© í”„ë ˆì„ì›Œí¬**: Method.FEM/PD/SPG ì „í™˜ë§Œìœ¼ë¡œ ì†”ë²„ êµì²´, GPU ìë™ ê°ì§€ (CUDAâ†’Vulkanâ†’CPU)
- **FEM**: TET4, TRI3, HEX8, QUAD4 ìš”ì†Œ (f64 ì •ë°€ë„)
  - **ì •ì  ì†”ë²„**: Newton-Raphson (ë¹„ì„ í˜•), ì§ì ‘í•´ë²• (ì„ í˜•)
  - **ë™ì  ì†”ë²„** (ì‹ ê·œ): Newmark-beta (implicit) + Central Difference (explicit)
  - Rayleigh ê°ì‡ , ì§‘ì¤‘ ì§ˆëŸ‰, ê³ ìœ ì§„ë™ìˆ˜ ê³„ì‚°
- **Peridynamics**: NOSB-PD, ì¤€ì •ì  ì†”ë²„ (f64 ì •ë°€ë„)
  - ìŠ¤í™íŠ¸ëŸ´ ë°˜ê²½ ê¸°ë°˜ dt ì¶”ì • (ê°œì„ )
- **SPG**: Smoothed Particle Galerkin (ê·¹í•œ ë³€í˜•/íŒŒê´´ í•´ì„)
  - ê²½ê³„ ì…ì ì ì‘í˜• ì•ˆì •í™” (ê°œì„ )
- **ì ‘ì´‰**: ë…¸ë“œ-ë…¸ë“œ í˜ë„í‹° + ë²•ì„  ê°ì‡ ë ¥, ì •ì /ì¤€ì •ì /ëª…ì‹œì  ëª¨ë“œ
- **STL êµ¬ì¡°í•´ì„**: STL â†’ ë³µì…€í™” â†’ Peridynamics íŒŒì´í”„ë¼ì¸
- í…ŒìŠ¤íŠ¸: 309 passed, 0 failed (FEM 39 + PD 22 + SPG 31 + Framework 19 + Contact 19 + Core 48 + Pipeline 28 + Segmentation 68 + Server 35)
- ë²¤ì¹˜ë§ˆí¬: FEM 5ê°œ + PD 5ê°œ + SPG 5ê°œ = 15ê°œ í•´ì„í•´ ë¹„êµ

#### FEA ì‹œê°í™” (`src/fea/visualization/`)
- Three.js ê¸°ë°˜ ì›¹ ë·°ì–´
- ì‹œê°í™” ëª¨ë“œ: Displacement, von Mises Strain, Damage, Original
- Jet ì»¬ëŸ¬ë§µ + ì»¬ëŸ¬ë°”
- íŒŒí‹°í´ í¬ê¸°/ë³€ìœ„ ìŠ¤ì¼€ì¼/ì»¬ëŸ¬ ë²”ìœ„ ì¡°ì ˆ
- ë·° ì „í™˜ (Top/Front/Side)
- ìŠ¤í¬ë¦°ìƒ· ë‚´ë³´ë‚´ê¸°
- NPZ â†’ JSON ë³€í™˜ ë„êµ¬

#### Core (`src/core/`)
- mesh.py: ì‚¼ê°í˜• ë©”ì‰¬, STL/OBJ ë¡œë”©
- volume.py: ë³µì…€ ë³¼ë¥¨, ë“œë¦´ë§
- collision.py: Ray casting ì¶©ëŒ ê°ì§€

### ğŸ”² ë¯¸êµ¬í˜„
- ë‚´ì‹œê²½ ì‹œë®¬ë ˆì´ì…˜ (ì›¹ ë²„ì „ìœ¼ë¡œ ìƒˆë¡œ êµ¬í˜„ ì˜ˆì •)

## ëª¨ë“ˆ êµ¬ì¡°

```
src/
â”œâ”€â”€ simulator/                 # Three.js ì›¹ ì‹œë®¬ë ˆì´í„° (ë©”ì¸)
â”‚   â”œâ”€â”€ index.html            # UI ë ˆì´ì•„ì›ƒ (Analysis íŒ¨ë„ í¬í•¨)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.js           # Three.js ë©”ì¸ + Analysis í†µí•©
â”‚   â”‚   â”œâ”€â”€ voxel.js          # ë³µì…€ + Marching Cubes
â”‚   â”‚   â”œâ”€â”€ nrrd.js           # NRRD íŒŒì„œ
â”‚   â”‚   â”œâ”€â”€ ws.js             # WebSocket í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ colormap.js       # Jet ì»¬ëŸ¬ë§µ
â”‚   â”‚   â”œâ”€â”€ pre.js            # ì „ì²˜ë¦¬ê¸° (ë©´ ì„ íƒ, BC, ì¬ë£Œ)
â”‚   â”‚   â”œâ”€â”€ post.js           # í›„ì²˜ë¦¬ê¸° (ì»¬ëŸ¬ë§µ ì‹œê°í™”, ì „/í›„ ë¹„êµ)
â”‚   â”‚   â””â”€â”€ implant.js        # ì„í”Œë€íŠ¸ ë§¤ë‹ˆì € (TransformControls)
â”‚   â”œâ”€â”€ stl/                  # ìƒ˜í”Œ STL íŒŒì¼
â”‚   â””â”€â”€ tests/                # ì›¹ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ pipeline/                  # CLI íŒŒì´í”„ë¼ì¸ (Phase 0)
â”‚   â”œâ”€â”€ cli.py                # Typer CLI ì§„ì…ì  (7 ì„œë¸Œì»¤ë§¨ë“œ)
â”‚   â”œâ”€â”€ config.py             # Pydantic ì„¤ì • + TOML ë¡œë“œ
â”‚   â”œâ”€â”€ cache.py              # SHA256 í•´ì‹œ ê¸°ë°˜ ìºì‹œ
â”‚   â”œâ”€â”€ stages/               # 5-ìŠ¤í…Œì´ì§€ (segmentâ†’postprocessâ†’voxelizeâ†’solveâ†’report)
â”‚   â””â”€â”€ tests/                # í…ŒìŠ¤íŠ¸ (28ê°œ)
â”œâ”€â”€ segmentation/              # ìë™ ì„¸ê·¸ë©˜í…Œì´ì…˜ (Phase 1)
â”‚   â”œâ”€â”€ labels.py             # SpineLabel í†µí•© ë¼ë²¨ + nnU-Net ë§¤í•‘
â”‚   â”œâ”€â”€ base.py               # SegmentationEngine ABC
â”‚   â”œâ”€â”€ totalseg.py           # TotalSegmentator (CT)
â”‚   â”œâ”€â”€ totalspineseg.py      # TotalSpineSeg (MRI)
â”‚   â”œâ”€â”€ nnunet_spine.py       # SpineUnified (CT+MRI, nnU-Net v2)
â”‚   â”œâ”€â”€ factory.py            # create_engine() íŒ©í† ë¦¬
â”‚   â”œâ”€â”€ training/             # í•™ìŠµ ë°ì´í„° ì¤€ë¹„ íŒŒì´í”„ë¼ì¸
â”‚   â”‚   â”œâ”€â”€ config.py         # ë°ì´í„°ì…‹ ê²½ë¡œ + ì „ì²˜ë¦¬ ì„¤ì •
â”‚   â”‚   â”œâ”€â”€ download.py       # ë°ì´í„°ì…‹ ê²€ì¦
â”‚   â”‚   â”œâ”€â”€ pseudo_label.py   # CT ë””ìŠ¤í¬ pseudo-label ìƒì„±
â”‚   â”‚   â”œâ”€â”€ validate_labels.py # í•´ë¶€í•™ì  ì¼ê´€ì„± ê²€ì¦
â”‚   â”‚   â”œâ”€â”€ label_merge.py    # GT + pseudo-label ë³‘í•©
â”‚   â”‚   â”œâ”€â”€ preprocess.py     # CT/MRI ì •ê·œí™” + ë„ë©”ì¸ ì±„ë„
â”‚   â”‚   â”œâ”€â”€ convert_nnunet.py # nnU-Net í˜•ì‹ ë³€í™˜
â”‚   â”‚   â””â”€â”€ tests/            # í…ŒìŠ¤íŠ¸ (24ê°œ)
â”‚   â””â”€â”€ tests/                # í…ŒìŠ¤íŠ¸ (44ê°œ)
â”œâ”€â”€ server/                    # FastAPI + WebSocket ì„œë²„
â”‚   â”œâ”€â”€ app.py                # ë©”ì¸ ì•± + REST ì—…ë¡œë“œ + ì •ì  íŒŒì¼ ì„œë¹™
â”‚   â”œâ”€â”€ models.py             # Pydantic ë°ì´í„° ëª¨ë¸ (BC, ì¬ë£Œ, ì„í”Œë€íŠ¸, ìˆ˜ìˆ ê³„íš)
â”‚   â”œâ”€â”€ ws_handler.py         # WebSocket í•¸ë“¤ëŸ¬ (í•´ì„, ì„¸ê·¸ë©˜í…Œì´ì…˜, ë©”ì‰¬, ì¬ë£Œ)
â”‚   â”œâ”€â”€ analysis_pipeline.py  # FEA framework í˜¸ì¶œ
â”‚   â”œâ”€â”€ segmentation_pipeline.py  # ì„¸ê·¸ë©˜í…Œì´ì…˜ ì„œë²„ íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ mesh_extract_pipeline.py  # ë¼ë²¨ë§µ â†’ Marching Cubes ë©”ì‰¬
â”‚   â”œâ”€â”€ auto_material.py      # SpineLabel ìë™ ì¬ë£Œ ë§¤í•‘ (8ì¢… DB)
â”‚   â””â”€â”€ tests/                # ì„œë²„ í…ŒìŠ¤íŠ¸ (35ê°œ)
â”œâ”€â”€ core/                      # í•µì‹¬ ë°ì´í„° êµ¬ì¡° (Python)
â””â”€â”€ fea/                       # ìœ í•œìš”ì†Œ í•´ì„ (Python)
    â”œâ”€â”€ framework/             # í†µí•© API (FEM/PD/SPG ì „í™˜, GPU ê°ì§€, ì ‘ì´‰ í•´ì„)
    â”‚   â”œâ”€â”€ _adapters/        # FEM, PD, SPG, Rigid ì–´ëŒ‘í„° + base_adapter.py
    â”‚   â”œâ”€â”€ rigid_body.py     # ê°•ì²´(RigidBody) + ê·œì • ìš´ë™(PrescribedMotion)
    â”‚   â”œâ”€â”€ contact.py        # ì ‘ì´‰ ì•Œê³ ë¦¬ì¦˜ (ë…¸ë“œ-ë…¸ë“œ í˜ë„í‹° + Coulomb ë§ˆì°°)
    â”‚   â”œâ”€â”€ scene.py          # ë‹¤ì¤‘ ë¬¼ì²´ Scene + ì ‘ì´‰ ì†”ë²„
    â”‚   â””â”€â”€ tests/            # í†µí•© í…ŒìŠ¤íŠ¸ (19ê°œ) + ì ‘ì´‰ í…ŒìŠ¤íŠ¸ (15ê°œ) + ê°•ì²´/ë§ˆì°° (32ê°œ)
    â”œâ”€â”€ fem/                   # FEM ëª¨ë“ˆ
    â”œâ”€â”€ peridynamics/          # NOSB-PD ëª¨ë“ˆ
    â”œâ”€â”€ spg/                   # SPG ëª¨ë“ˆ (ê·¹í•œ ë³€í˜•/íŒŒê´´)
    â”‚   â”œâ”€â”€ core/             # ì…ì, ì»¤ë„, ë³¸ë“œ, í•µì‹¬ ê³„ì‚°
    â”‚   â”œâ”€â”€ solver/           # ëª…ì‹œì  ë™ì /ì¤€ì •ì  ì†”ë²„
    â”‚   â”œâ”€â”€ material/         # ì¬ë£Œ ëª¨ë¸
    â”‚   â””â”€â”€ tests/            # í…ŒìŠ¤íŠ¸ (31ê°œ) + ë²¤ì¹˜ë§ˆí¬
    â””â”€â”€ visualization/         # FEA ê²°ê³¼ ì›¹ ì‹œê°í™”
        â”œâ”€â”€ index.html        # FEA Viewer UI
        â”œâ”€â”€ src/main.js       # Three.js ì‹œê°í™”
        â””â”€â”€ convert_npz.py    # NPZâ†’JSON ë³€í™˜
```

## ìƒì„¸ ì§„í–‰ ë¬¸ì„œ

- `docs/SIMULATOR_PROGRESS.md` - ì›¹ ì‹œë®¬ë ˆì´í„° ì§„í–‰ ìƒí™©
- `docs/FEM_PROGRESS.md` - FEM êµ¬í˜„ ìƒì„¸
- `docs/NOSB_PD_PROGRESS.md` - NOSB-PD êµ¬í˜„ ìƒì„¸
- `docs/SPG_METHOD.md` - SPG ë°©ë²• ê¸°ìˆ  ë¬¸ì„œ

## ì‹¤í–‰ ë°©ë²•

```bash
# CLI íŒŒì´í”„ë¼ì¸ ë„ì›€ë§
uv run spine-sim --help

# ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (CT â†’ ì„¸ê·¸ë©˜í…Œì´ì…˜ â†’ í›„ì²˜ë¦¬ â†’ ë³µì…€í™” â†’ í•´ì„ â†’ ë¦¬í¬íŠ¸)
uv run spine-sim pipeline input.nii.gz -o output/ --config config/pipeline.toml

# ê°œë³„ ìŠ¤í…Œì´ì§€ ì‹¤í–‰
uv run spine-sim segment input.nii.gz -o output/segment --engine spine_unified --modality CT
uv run spine-sim postprocess labels.nii.gz -o output/postprocess
uv run spine-sim voxelize labels.nii.gz -o output/voxelize --resolution 64
uv run spine-sim solve voxel_model.npz -o output/solve --method spg
uv run spine-sim report result.npz -o output/report

# SpineUnified ëª¨ë¸ ê´€ë ¨
uv run spine-sim download-model spine_unified          # ê°€ì¤‘ì¹˜ ë‹¤ìš´ë¡œë“œ
uv run spine-sim validate-data --verse data/VerSe2020  # ë°ì´í„°ì…‹ ê²€ì¦
uv run spine-sim prepare-training-data /data -o nnUNet_raw  # í•™ìŠµ ë°ì´í„° ë³€í™˜

# ì›¹ ì‹œë®¬ë ˆì´í„° + í•´ì„ ì„œë²„ (ê¶Œì¥, í•´ì„ ê¸°ëŠ¥ í¬í•¨)
uv run spine-sim server --port 8000
# ë˜ëŠ”: uv run python -m src.server.app
# ë¸Œë¼ìš°ì €: http://localhost:8000

# ì›¹ ì‹œë®¬ë ˆì´í„°ë§Œ (í•´ì„ ê¸°ëŠ¥ ì—†ìŒ)
cd src/simulator && python -m http.server 8080
# ë¸Œë¼ìš°ì €: http://localhost:8080

# FEA ì‹œê°í™”
cd src/fea/visualization && python -m http.server 8081
# ë¸Œë¼ìš°ì €: http://localhost:8081

# STL êµ¬ì¡°í•´ì„ í…ŒìŠ¤íŠ¸
uv run python test_stl_fea.py

# Svelte 5 í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ ì„œë²„
cd src/frontend && npm run dev
# ë¸Œë¼ìš°ì €: http://localhost:5174

# Svelte í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ (â†’ src/simulator/dist/)
cd src/frontend && npm run build
```

---

## í”„ë¡ íŠ¸ì—”ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ (Svelte 5 + Vite + TypeScript) â€” âœ… ì™„ë£Œ

ê¸°ì¡´ vanilla HTML/JS + Three.js r128 (CDN) í”„ë¡ íŠ¸ì—”ë“œë¥¼ **Svelte 5 + Vite + Three.js r170+ + TypeScript** SPAë¡œ ì „ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ.

### ë§ˆì´ê·¸ë ˆì´ì…˜ ë²”ìœ„

| Phase | ë‚´ìš© | ìƒíƒœ |
|-------|------|------|
| **Phase 1** | í”„ë¡œì íŠ¸ ìŠ¤ìºí´ë”© (Svelte 5 + Vite + Three.js r170) | âœ… |
| **Phase 2** | í•µì‹¬ ë¡œì§ ë§ˆì´ê·¸ë ˆì´ì…˜ (VoxelGrid, NRRDLoader, colormap) | âœ… |
| **Phase 3** | WS/í•´ì„ ë¡œì§ (WSClient, PreProcessor, PostProcessor, ImplantManager) | âœ… |
| **Phase 4** | Svelte 5 runes ìŠ¤í† ì–´ 7ê°œ + ì•¡ì…˜ ëª¨ë“ˆ 4ê°œ | âœ… |
| **Phase 5** | UI ì»´í¬ë„ŒíŠ¸ (ê³µí†µ 5ê°œ + Colorbar + ì‚¬ì´ë“œë°” íŒ¨ë„ 6ê°œ) | âœ… |
| **Phase 6** | ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í¬ì¸í„°, í‚¤ë³´ë“œ Ctrl+Z/Y, ë“œë˜ê·¸ì•¤ë“œë¡­) | âœ… |
| **Phase 7** | í”„ë¡œë•ì…˜ ë¹Œë“œ + í†µí•© í…ŒìŠ¤íŠ¸ | âœ… |

### ì‹ ê·œ ê¸°ìˆ  ìŠ¤íƒ

- **Svelte 5**: `$state`, `$derived`, `$bindable` runes ê¸°ë°˜ ë°˜ì‘í˜• ìƒíƒœ
- **Vite 6**: HMR, `$lib` alias, proxy (`/ws` â†’ 8000, `/api` â†’ 8000)
- **Three.js r170+**: ES module import (`three/addons/...`), `SRGBColorSpace`
- **TypeScript strict**: ì „ì²´ ì½”ë“œ íƒ€ì… ì•ˆì „ì„± ë³´ì¥

### íŒŒì¼ êµ¬ì¡° (`src/frontend/`)

```
src/frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                    # Svelte 5 mount
â”‚   â”œâ”€â”€ App.svelte                 # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ app.css                    # CSS ë³€ìˆ˜, ì „ì—­ ìŠ¤íƒ€ì¼
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Canvas3D.svelte        # Three.js + í¬ì¸í„°/í‚¤ë³´ë“œ ì´ë²¤íŠ¸
â”‚   â”‚   â”œâ”€â”€ Menubar.svelte         # íƒ­ ë°” + Undo/Redo
â”‚   â”‚   â”œâ”€â”€ Statusbar.svelte       # ìƒíƒœë°” (FPS, ëª¨ë¸ ìˆ˜, ì •ì /ë©´)
â”‚   â”‚   â”œâ”€â”€ Colorbar.svelte        # Jet ì»¬ëŸ¬ë§µ ì‹œê°í™”
â”‚   â”‚   â”œâ”€â”€ common/                # ê³µí†µ ì»´í¬ë„ŒíŠ¸ (Slider, ToolButton ë“±)
â”‚   â”‚   â””â”€â”€ sidebar/
â”‚   â”‚       â”œâ”€â”€ Sidebar.svelte     # íƒ­ ê¸°ë°˜ íŒ¨ë„ ì „í™˜
â”‚   â”‚       â”œâ”€â”€ FilePanel.svelte   # ëª¨ë¸ ëª©ë¡, STL/NRRD ë¡œë“œ
â”‚   â”‚       â”œâ”€â”€ ModelingPanel.svelte # ë“œë¦´, Undo/Redo
â”‚   â”‚       â”œâ”€â”€ PreProcessPanel.svelte # BC, ì¬ë£Œ í• ë‹¹
â”‚   â”‚       â”œâ”€â”€ SolvePanel.svelte  # ì†”ë²„ ì„ íƒ, í•´ì„ ì‹¤í–‰
â”‚   â”‚       â”œâ”€â”€ PostProcessPanel.svelte # ê²°ê³¼ ì‹œê°í™”
â”‚   â”‚       â””â”€â”€ ViewPanel.svelte   # ì¹´ë©”ë¼, ë°°ê²½, í—¬í¼
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ three/
â”‚       â”‚   â”œâ”€â”€ SceneManager.ts    # Three.js ì”¬ ê´€ë¦¬
â”‚       â”‚   â”œâ”€â”€ VoxelGrid.ts       # ë³µì…€ ì‹œìŠ¤í…œ + Marching Cubes
â”‚       â”‚   â”œâ”€â”€ NRRDLoader.ts      # NRRD íŒŒì„œ
â”‚       â”‚   â””â”€â”€ ImplantManager.ts  # ì„í”Œë€íŠ¸ TransformControls
â”‚       â”œâ”€â”€ analysis/
â”‚       â”‚   â”œâ”€â”€ colormap.ts        # Jet ì»¬ëŸ¬ë§µ
â”‚       â”‚   â”œâ”€â”€ PreProcessor.ts    # ë©´ì„ íƒ, BC, ì¬ë£Œ, í•´ì„ ìš”ì²­ ì¡°ë¦½
â”‚       â”‚   â””â”€â”€ PostProcessor.ts   # ê²°ê³¼ ì‹œê°í™” (ë³€ìœ„/ì‘ë ¥/ì†ìƒ)
â”‚       â”œâ”€â”€ ws/
â”‚       â”‚   â”œâ”€â”€ types.ts           # WS ë©”ì‹œì§€ íƒ€ì… ì •ì˜
â”‚       â”‚   â””â”€â”€ client.ts          # WebSocket í´ë¼ì´ì–¸íŠ¸
â”‚       â”œâ”€â”€ stores/                # Svelte 5 runes ìŠ¤í† ì–´
â”‚       â”‚   â”œâ”€â”€ scene.svelte.ts    # ì”¬/ëª¨ë¸ ìƒíƒœ
â”‚       â”‚   â”œâ”€â”€ ui.svelte.ts       # íƒ­/ìƒíƒœë°”
â”‚       â”‚   â”œâ”€â”€ tools.svelte.ts    # ë„êµ¬ ìƒíƒœ (ë“œë¦´/ë¸ŒëŸ¬ì‰¬)
â”‚       â”‚   â”œâ”€â”€ analysis.svelte.ts # í•´ì„ ìƒíƒœ
â”‚       â”‚   â”œâ”€â”€ websocket.svelte.ts # WS ì—°ê²° ìƒíƒœ
â”‚       â”‚   â”œâ”€â”€ history.svelte.ts  # Undo/Redo
â”‚       â”‚   â””â”€â”€ pipeline.svelte.ts # DICOM íŒŒì´í”„ë¼ì¸
â”‚       â””â”€â”€ actions/               # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì•¡ì…˜
â”‚           â”œâ”€â”€ loading.ts         # STL/NRRD ë¡œë“œ, ë³µì…€ ì´ˆê¸°í™”
â”‚           â”œâ”€â”€ drilling.ts        # ë“œë¦´ í”„ë¦¬ë·°/ì‹¤í–‰
â”‚           â”œâ”€â”€ analysis.ts        # í•´ì„ ì‹¤í–‰/ê²°ê³¼ ì²˜ë¦¬
â”‚           â””â”€â”€ pipeline.ts        # DICOM íŒŒì´í”„ë¼ì¸
â”œâ”€â”€ public/stl/                    # ìƒ˜í”Œ STL (L4, L5, disc)
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsconfig.json
â””â”€â”€ svelte.config.js
```

### ë¹Œë“œ ê²°ê³¼

- **app JS**: 182 KB (gzip 60 KB)
- **Three.js**: 482 KB (gzip 122 KB) â€” ë³„ë„ ì²­í¬ ë¶„ë¦¬
- **CSS**: 13.3 KB (gzip 2.7 KB)
- **ì¶œë ¥ ê²½ë¡œ**: `src/simulator/dist/` (FastAPI ì •ì  ì„œë¹™ ëŒ€ì‘)
- **ê²½ê³ /ì—ëŸ¬**: 0ê°œ

### UX/ì›Œí¬í”Œë¡œìš° ê°œì„  (2026-02-23)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë¹Œë“œ ì²­í¬ ë¶„ë¦¬** | Three.jsë¥¼ ë³„ë„ ì²­í¬ë¡œ ë¶„ë¦¬ (661KB ë‹¨ì¼ â†’ 182KB + 482KB) |
| **a11y ë¼ë²¨** | ëª¨ë“  form inputì— `for`/`id` ì—°ê²° (ë¹Œë“œ ê²½ê³  0ê°œ) |
| **í† ìŠ¤íŠ¸ ì•Œë¦¼** | ë¡œë“œ/ì‚­ì œ/BC ì ìš© ë“± ë¹„ë™ê¸° ê²°ê³¼ë¥¼ í† ìŠ¤íŠ¸ë¡œ í‘œì‹œ |
| **í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸** | Clear All, Clear All BC ë“± íŒŒê´´ì  ì•¡ì…˜ì— í™•ì¸ í•„ìˆ˜ |
| **ìœ íš¨ì„± ì²´í¬ë¦¬ìŠ¤íŠ¸** | Solve íƒ­ì— Models/BC/Material ì²´í¬ë¦¬ìŠ¤íŠ¸ í‘œì‹œ |
| **ì†”ë²„ ì„¤ëª…** | FEM/PD/SPG ì„ íƒ ì‹œ í•œê¸€ ì„¤ëª… í‘œì‹œ |
| **ë¡œë”© ìƒíƒœ** | FilePanel ë¡œë“œ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™” + "Loading..." í‘œì‹œ |
| **ì—ëŸ¬ í”¼ë“œë°±** | ë¡œë“œ ì‹¤íŒ¨ ì‹œ í† ìŠ¤íŠ¸ ì—ëŸ¬ ì•Œë¦¼ |
| **History ì—°ê²°** | voxelGrids â†” historyState ìë™ ì—°ê²° |
| **ìƒíƒœë°” ë„˜ì¹¨ ë°©ì§€** | ê¸´ ë©”ì‹œì§€ text-overflow: ellipsis ì²˜ë¦¬ |
| **Force BC ë°©í–¥ UI** | X/Y/Z ê°œë³„ ì…ë ¥ + í”„ë¦¬ì…‹ ë²„íŠ¼ (â†“-Y, â†‘+Y, â†’+X, âŠ™+Z) |
| **PostProcess ë¹ˆ ìƒíƒœ** | ê²°ê³¼ ì—†ì„ ë•Œ ì•„ì´ì½˜ + ì•ˆë‚´ ë©”ì‹œì§€ (ê¸°ì¡´ í…ìŠ¤íŠ¸ë§Œ â†’ ì‹œê°ì  ê°œì„ ) |
| **ë²„íŠ¼ disabled** | ëª¨ë¸ ì—†ì„ ë•Œ Brush/Apply BC/Assign Material ë“± ë¹„í™œì„±í™” |
| **í™˜ê²½ë³€ìˆ˜ ì§€ì›** | `VITE_BACKEND_URL` í™˜ê²½ë³€ìˆ˜ë¡œ ë°±ì—”ë“œ URL ì„¤ì • ê°€ëŠ¥ |
| **Magnitude ë²”ìœ„** | Force BC ìµœëŒ€ê°’ 1000N â†’ 2000N í™•ì¥ |
| **Remove Last BC** | ë§ˆì§€ë§‰ BCë§Œ ì œê±°í•˜ëŠ” ë²„íŠ¼ ì¶”ê°€ |

### í›„ì²˜ë¦¬ ì‹œê°í™” + ì „ì²˜ë¦¬ UI ëŒ€í­ ê°œì„  (2026-02-23)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë‹¤ì¤‘ ì»¬ëŸ¬ë§µ** | 6ì¢… ì§€ì›: Jet, Cool-to-Warm, Viridis, Grayscale, Rainbow, Turbo |
| **ì»¬ëŸ¬ë§µ ì„ íƒ UI** | ê·¸ë¼ë””ì–¸íŠ¸ ì¹© ê·¸ë¦¬ë“œë¡œ ì‹œê°ì  ì„ íƒ (í´ë¦­ í•œ ë²ˆ) |
| **ë²¡í„° ì»´í¬ë„ŒíŠ¸** | Magnitude / X / Y / Z ì„±ë¶„ ë³„ë„ ì‹œê°í™” ê°€ëŠ¥ |
| **CSS ê·¸ë¼ë””ì–¸íŠ¸** | `colormapToCSS()` â€” ì»¬ëŸ¬ë§µ í”„ë¦¬ë·°ìš© ë™ì  CSS ìƒì„± |
| **ë°ì´í„° ë²”ìœ„ í‘œì‹œ** | í˜„ì¬ ìŠ¤ì¹¼ë¼ í•„ë“œì˜ min~max + ë‹¨ìœ„ í‘œì‹œ |
| **ë¶ˆíˆ¬ëª…ë„ ì œì–´** | ê²°ê³¼ í¬ì¸íŠ¸ì˜ íˆ¬ëª…ë„ ì¡°ì ˆ (0.1~1.0) |
| **ì›Œí”„ ë²”ìœ„ í™•ì¥** | Warp by Vector ìŠ¤ì¼€ì¼ 0~200 ë²”ìœ„ |
| **PostProcessor í™•ì¥** | ì»´í¬ë„ŒíŠ¸ ì¶”ì¶œ, ì»¤ìŠ¤í…€ ë²”ìœ„, ì„ê³„ê°’ í•„í„°, í´ë¦¬í•‘ í‰ë©´ ë‚´ë¶€ ì§€ì› |
| **í†µê³„ ê°œì„ ** | ì…ì ìˆ˜, max ë³€ìœ„/ì‘ë ¥/ì†ìƒ, í•´ì„ ë°©ë²• í‘œì‹œ |
| **ìŠ¤í† ì–´ ë™ê¸°í™”** | `syncFromPostProcessor()` â€” PostProcessor â†” Svelte ìŠ¤í† ì–´ ìë™ ë™ê¸°í™” |
| **í˜ í¬ê¸° í”„ë¦¬ì…‹** | 50, 100, 200, 500, 1000 N ì›í´ë¦­ ë²„íŠ¼ |
| **í¬ê¸° ì§ì ‘ ì…ë ¥** | ìŠ¬ë¼ì´ë” + ìˆ«ì ì…ë ¥ í•„ë“œ ë™ì‹œ ì§€ì› (ìµœëŒ€ 10000N) |
| **ë°©í–¥ 6ì¢… í”„ë¦¬ì…‹** | ì••ì¶•/ì¸ì¥/ì¸¡ë°©/ì „ë°©/êµ´ê³¡/ì‹ ì „ (í•´ë¶€í•™ì  í•œê¸€ ë¼ë²¨) |
| **X/Y/Z ìƒ‰ìƒ ì½”ë”©** | ì¶•ë³„ ìƒ‰ìƒ ë°°ì§€ (ë¹¨ê°•=X, ì´ˆë¡=Y, íŒŒë‘=Z) |
| **í˜ ë²¡í„° ë¯¸ë¦¬ë³´ê¸°** | `F = (0, -100, 0) N` ì‹¤ì‹œê°„ ê³„ì‚° í‘œì‹œ |
| **ë°©í–¥ ì •ê·œí™”** | ë¹„ì •ê·œ ë°©í–¥ ë²¡í„°ë„ ìë™ ì •ê·œí™” ì²˜ë¦¬ |

### ëª¨ë¸ë³„ ë©€í‹°ì†”ë²„ ì§€ì • (2026-02-24)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ëª¨ë¸ë³„ ì†”ë²„ ì§€ì •** | ê° ëª¨ë¸(L4/L5/disc)ì— ë…ë¦½ì ìœ¼ë¡œ FEM/PD/SPG í• ë‹¹ ê°€ëŠ¥ |
| **SolvePanel í…Œì´ë¸”** | ëª¨ë¸ëª… + ì†”ë²„ + ì¬ë£Œë¥¼ í•œëˆˆì— ë³´ëŠ” ê·¸ë¦¬ë“œ UI |
| **ì†”ë²„ ìƒ‰ìƒ ì½”ë”©** | FEM=íŒŒë‘, PD=ë¹¨ê°•, SPG=ì£¼í™© ì /í…Œë‘ë¦¬ë¡œ ì‹œê° êµ¬ë¶„ |
| **ì¼ê´„ ì ìš©** | All FEM / All PD / All SPG ì›í´ë¦­ ë²„íŠ¼ |
| **ìš”ì•½ í‘œì‹œ** | Run Analysis ë²„íŠ¼ì— `(FEMÃ—2, PDÃ—1)` í˜•íƒœë¡œ ì†”ë²„ êµ¬ì„± í‘œì‹œ |
| **solverAssignments** | `analysisState.solverAssignments` Recordë¡œ ëª¨ë¸ë³„ ì†”ë²„ ì¶”ì  |
| **PreProcessor ì—°ë™** | `buildAnalysisRequest()` â†’ ê° materialì— `method` í•„ë“œ í¬í•¨ |
| **ë°±ì—”ë“œ ë©€í‹°ì†”ë²„** | `analysis_pipeline.py` â€” ì˜ì—­ë³„ ê·¸ë£¹ ë¶„ë¦¬ ì‹¤í–‰ í›„ ê²°ê³¼ í•©ì„± |
| **MaterialRegion.method** | Pydantic ëª¨ë¸ì— `method` í•„ë“œ ì¶”ê°€ (ê¸°ë³¸ê°’ "fem") |
| **ì†”ë²„ ì„¤ëª…** | FEM/PD/SPG ê°ê° í•œê¸€ ì„¤ëª… + ìƒ‰ìƒ ë°°ì§€ë¡œ í‘œì‹œ |

# NPZ â†’ JSON ë³€í™˜
uv run python src/fea/visualization/convert_npz.py fea_result.npz output.json

# í…ŒìŠ¤íŠ¸
uv run pytest src/ -v
```

### ì„í”Œë€íŠ¸ ì¹´íƒˆë¡œê·¸ ë°°ì¹˜ + 3D í•˜ì¤‘ í¸ì§‘ê¸° (2026-02-24)

#### ì„í”Œë€íŠ¸ ì¹´íƒˆë¡œê·¸ ë°°ì¹˜ ì‹œìŠ¤í…œ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë”ë¯¸ STL ìƒì„±** | `scripts/gen_implant_stls.py` â€” Python stdlibë§Œìœ¼ë¡œ 9ê°œ STL ìƒì„± |
| **ìŠ¤í¬ë¥˜ 5ì¢…** | M5Ã—40, M6Ã—45, M6Ã—50, M7Ã—50, M7Ã—55 (ì›ê¸°ë‘¥ í˜•íƒœ, ê° 80 ì‚¼ê°í˜•) |
| **ì¼€ì´ì§€ 4ì¢…** | cage_S(22Ã—8mm), cage_M(26Ã—10mm), cage_L(26Ã—12mm), cage_XL(32Ã—14mm) |
| **STL ìœ„ì¹˜** | `public/stl/implants/screws/` + `cages/` |
| **ImplantManager** | STL URL ê¸°ë°˜ ë¡œë“œ, í‘œë©´ ë²•ì„  ì •ë ¬ ë°°ì¹˜, TransformControls ì´ë™/íšŒì „ |
| **í‘œë©´ ìŠ¤ëƒ…** | ë¼ˆ í´ë¦­ â†’ ë²•ì„  ë°©í–¥ìœ¼ë¡œ ì„í”Œë€íŠ¸ +Y ì •ë ¬ (`Quaternion.setFromUnitVectors`) |
| **ììœ  ì´ë™/íšŒì „** | TransformControls (translate/rotate) â€” ë“œë˜ê·¸ ì¤‘ OrbitControls ìë™ ë¹„í™œì„±í™” |
| **ì¼€ì´ì§€ ì¶©ëŒ ê°ì§€** | ì‹¤ì‹œê°„ AABB(Box3) êµì°¨ ê²€ì‚¬ â€” ì¶©ëŒ ì‹œ ë¹¨ê°„ìƒ‰ ë°˜íˆ¬ëª…ìœ¼ë¡œ ê²½ê³  |
| **implantCatalog.ts** | ì¹´íƒˆë¡œê·¸ ë°ì´í„° + selectImplantForPlacement / placeImplantAtClick / deleteSelectedImplant |
| **$state ë°˜ì‘ì„±** | `implantCount = $state(0)` â†’ Svelte `$derived`ë¡œ ëª©ë¡ ê°±ì‹  |
| **ì—°ì† ë°°ì¹˜** | ë°°ì¹˜ í›„ ëª¨ë“œ ìœ ì§€ â†’ ê°™ì€ ì„í”Œë€íŠ¸ ì—¬ëŸ¬ ê°œ ì—°ì† ë°°ì¹˜ ê°€ëŠ¥ (Escë¡œ ì¢…ë£Œ) |
| **Delete í‚¤** | ì„ íƒëœ ì„í”Œë€íŠ¸ ì‚­ì œ |
| **ModelingPanel** | ì¹´íƒˆë¡œê·¸ íƒ­(Screw/Cage/Rod), ë°°ì¹˜ ëª©ë¡, Move/Rotate/Del ì»¨íŠ¸ë¡¤ |

#### 3D í•˜ì¤‘ ë²¡í„° í¸ì§‘ê¸°

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ForceArrowHandle** | ArrowHelper(ë¹¨ê°•) + êµ¬í˜• ë“œë˜ê·¸ í•¸ë“¤(ì£¼í™©) |
| **í™”ì‚´í‘œ ê¸¸ì´** | `30 + ||F|| / 10` (í˜ í¬ê¸°ì— ë¹„ë¡€) |
| **ë“œë˜ê·¸ í‰ë©´** | ì¹´ë©”ë¼ -Z ë°©í–¥ í‰ë©´ (Plane + Ray êµì°¨) |
| **ë°©í–¥/í¬ê¸° ê³„ì‚°** | ë“œë˜ê·¸ íˆíŠ¸ì  â†’ ìƒˆ ë°©í–¥ ë²¡í„° + ì´ˆê¸° í¬ê¸° ìœ ì§€ |
| **toolsState.forceVector** | 3D í•¸ë“¤ â†” PreProcessPanel X/Y/Z ì…ë ¥ ì–‘ë°©í–¥ ì‹¤ì‹œê°„ ë™ê¸°í™” |
| **3D í¸ì§‘ ë²„íŠ¼** | PreProcessPanel Force BC ì„¹ì…˜ ìƒë‹¨ì— í† ê¸€ ë²„íŠ¼ ì¶”ê°€ |
| **$effect ë™ê¸°í™”** | forceVector ë³€í™” â†’ íŒ¨ë„ dirX/Y/Z + forceMagnitude ìë™ ì—…ë°ì´íŠ¸ |
| **íŒ¨ë„â†’í™”ì‚´í‘œ ì¦‰ì‹œ ë°˜ì˜** | ë°©í–¥ í”„ë¦¬ì…‹/ìŠ¬ë¼ì´ë” ë³€ê²½ ì‹œ í™”ì‚´í‘œë„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ |

#### ì•„í‚¤í…ì²˜ ë³€ê²½

| í•­ëª© | ë‚´ìš© |
|------|------|
| **implants.ts ì •ë¦¬** | requestScrew/Cage ì œê±°, ê°€ì´ë“œë¼ì¸ ì „ìš©ìœ¼ë¡œ ì¶•ì†Œ |
| **initGuidelineLayer** | (êµ¬ initImplantLayer) ê°€ì´ë“œë¼ì¸ ì”¬ ê·¸ë£¹ë§Œ ë‹´ë‹¹ |
| **WebSocket ì„í”Œë€íŠ¸ ì œê±°** | ImplantManager + STL íŒŒì¼ ë°©ì‹ìœ¼ë¡œ ì™„ì „ ëŒ€ì²´ |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### ì¼€ì´ì§€ ë””ìŠ¤íŠ¸ë™ì…˜ (Cage Distraction) â€” êµ¬í˜„ ì™„ë£Œ (2026-02-24)

> **ì‚¬ìš©ì í”¼ë“œë°±**: "ì¼€ì´ì§€ ë„£ëŠ” ê±° ì„¤ê³„ ì˜í•´ì•¼ í•´. ì‹¤ì œì²˜ëŸ¼ ë†’ì€ ê±° ë„£ìœ¼ë©´ ë””ìŠ¤í¬ ìŠ¤í˜ì´ìŠ¤ ë†’ì´ê°€ ì˜¬ë¼ê°€ëŠ” ê±°"

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì•Œê³ ë¦¬ì¦˜** | ì¼€ì´ì§€ Y ì¤‘ì‹¬ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„/í•˜ìœ„ ì²™ì¶” ìë™ íƒìƒ‰, `deltaH = cageHeight âˆ’ originalGap` |
| **ì¼€ì´ì§€ ë†’ì´ ì†ŒìŠ¤** | ì¹´íƒˆë¡œê·¸ `heightMm` ìš°ì„  ì‚¬ìš© (ê¸°ìš¸ì–´ì§„ ë°°ì¹˜ ì‹œ AABB ì˜¤ì°¨ ë°©ì§€) |
| **ìƒìœ„ ì²™ì¶” ì´ë™** | `superiorMesh.position.y += deltaH` â€” ì¶”ê°„íŒ ê³µê°„ êµì • |
| **ì¼€ì´ì§€ ìœ„ì¹˜ ì¡°ì •** | `cage.position.y += deltaH * 0.5` â€” ë””ìŠ¤í¬ ê³µê°„ ì¤‘ì•™ ìœ ì§€ |
| **ê²°ê³¼ í”¼ë“œë°±** | í† ìŠ¤íŠ¸: "ë””ìŠ¤íŠ¸ë™ì…˜ ì ìš©: {gap}mm â†’ {cage}mm (ìƒìœ„ ì²™ì¶” +{delta}mm)" |
| **CatalogItem.heightMm** | cage_S=8, cage_M=10, cage_L=12, cage_XL=14 (mm) |
| **toolsState.pendingImplantHeightMm** | ë°°ì¹˜ ëª¨ë“œ ì§„ì… ì‹œ heightMm ì „ë‹¬ ì²´ì¸ êµ¬ì¶• |
| **undo ì§€ì›** | `undoDistraction(cageName, result)` â€” ì›ìœ„ì¹˜ ë³µì› |
| **UI** | ModelingPanel ì¼€ì´ì§€ ì„ íƒ ì‹œ ë³´ë¼ìƒ‰ Distraction ë°” í‘œì‹œ |
| **E2E ê²€ì¦** | Cage M ë°°ì¹˜ â†’ Apply â†’ "+10.0mm" ì •í™• ì ìš© âœ… |

#### ë²„ê·¸ ìˆ˜ì • ë° í˜¸í™˜ì„± (2026-02-24)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **rune_outside_svelte ìˆ˜ì •** | `ImplantManager.ts` â†’ `ImplantManager.svelte.ts` íŒŒì¼ëª… ë³€ê²½ (`$state` ë£¬ ì‚¬ìš© ê°€ëŠ¥ í™•ë³´) |
| **Three.js r170 í˜¸í™˜ì„±** | TransformControlsê°€ ë” ì´ìƒ Object3D ë¯¸ìƒì† â†’ `getHelper()` íŒ¨í„´ìœ¼ë¡œ ì”¬ ì¶”ê°€ ìˆ˜ì • |
| **Canvas3D.svelte ì •ë¦¬** | ë””ë²„ê·¸ ì½”ë“œ ì œê±° (window.__app, console.log, try-catch) â€” HMR ì¬ë¡œë“œ ë¬¸ì œ í•´ê²° |
| **ForceArrow ê°€ì‹œì„± ê°œì„ ** | `setOrigin()` â€” ëª¨ë¸ bbox ìƒë‹¨ìœ¼ë¡œ í™”ì‚´í‘œ ì´ë™, `setScale()` â€” bbox í¬ê¸°ì— ë¹„ë¡€ ìŠ¤ì¼€ì¼ |
| **ì¼ëŸ¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ë“œë˜ê·¸** | 3D í¸ì§‘ ëª¨ë“œ ì‹œ ë·°í¬íŠ¸ ì–´ë””ì„œë“  í´ë¦­-ë“œë˜ê·¸ â†’ í™”ì‚´í‘œ ë°©í–¥/í¬ê¸° ë³€ê²½ (êµ¬ í•¸ë“¤ í´ë¦­ ë¶ˆí•„ìš”) |
| **updateFromDrag ì¢Œí‘œ ìˆ˜ì •** | ê·¸ë£¹ ì´ë™ í›„ `this.group.position` ê¸°ì¤€ìœ¼ë¡œ ë°©í–¥ ê³„ì‚° (í•˜ë“œì½”ë”© ì›ì  ë²„ê·¸ ìˆ˜ì •) |
| **ê¼¬ë¦¬ ë§ˆì»¤** | í™”ì‚´í‘œ ì‹œì‘ì ì— ì£¼í™© êµ¬ í‘œì‹œ (ì‹œê°ì  ê¸°ì¤€ì ) |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### Force BC í™”ì‚´í‘œ ê¸°ì¤€ì  ì •í™•í™” (2026-02-25)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **getBrushSelectionCentroid() ì¶”ê°€** | `PreProcessor.ts`: ë¸ŒëŸ¬ì‰¬ ì„ íƒ ë³µì…€ì˜ ì›”ë“œ ì¢Œí‘œ ë¬´ê²Œ ì¤‘ì‹¬ ê³„ì‚° ë©”ì„œë“œ ì‹ ê·œ ì¶”ê°€ |
| **forceBCOrigin ìƒíƒœ** | `analysis.svelte.ts`: Force BC ì ìš© ì˜ì—­ ì¤‘ì‹¬ ì¢Œí‘œ `[x, y, z]` ì €ì¥ ìƒíƒœ ì¶”ê°€ |
| **addForceBC() ì¤‘ì‹¬ì  ì €ì¥** | `analysis.ts`: Force BC ì ìš© ì „ ë¸ŒëŸ¬ì‰¬ ì„ íƒ ì¤‘ì‹¬ì ì„ `forceBCOrigin`ì— ì €ì¥ (brushSelection ì´ˆê¸°í™” ì „) |
| **í™”ì‚´í‘œ ê¸°ì¤€ì  ìš°ì„ ìˆœìœ„** | `PreProcessPanel.svelte toggle3DEdit()`: (1) ë¼ì´ë¸Œ ë¸ŒëŸ¬ì‰¬ ì¤‘ì‹¬ â†’ (2) ì €ì¥ëœ forceBCOrigin â†’ (3) í´ë°±: bbox ìƒë‹¨ |
| **ì•ˆë‚´ í† ìŠ¤íŠ¸ ë©”ì‹œì§€** | ê° ì¼€ì´ìŠ¤ë³„ toast ë©”ì‹œì§€ë¡œ ì‚¬ìš©ìì—ê²Œ í™”ì‚´í‘œ ê¸°ì¤€ì  ì •ë³´ ì•ˆë‚´ |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### STL ìë™ ì˜¤ë¦¬ì—”í…Œì´ì…˜ + ë¡œë“œ ì¦‰ì‹œ ë³µì…€í™” + Force Arrow ê°œì„  (2026-02-25)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **autoOrientGeometry() ì¶”ê°€** | `SceneManager.ts`: ëª¨ë“  STL ë¡œë“œ ì‹œ ìµœì¥ ì¶• ìë™ ê°ì§€ â†’ Yì¶•(ìƒí•˜) ì •ë ¬ íšŒì „ ì ìš© |
| **ì˜¤ë¦¬ì—”í…Œì´ì…˜ ë¡œì§ (1ì°¨)** | Z ìµœì¥ â†’ Xì¶• -90Â° íšŒì „ (Zâ†’Y); X ìµœì¥ â†’ Zì¶• -90Â° íšŒì „; Y ìµœì¥ â†’ ë¬´ë³€í™˜ |
| **focusOnAllMeshes() ì¶”ê°€** | `SceneManager.ts`: ë³µìˆ˜ ë©”ì‰¬ AABB í•©ì‚° í›„ 3/4 ì‚¬ì„  ë·° ì¹´ë©”ë¼ í¬ì»¤ìŠ¤ (Y-up ë³´ì¥) |
| **ë¡œë“œ ì¦‰ì‹œ ë³µì…€í™”** | `loading.ts`: `loadSampleModels()` / `loadSTLFiles()` ì™„ë£Œ ì¦‰ì‹œ `initializeVoxels()` ìë™ í˜¸ì¶œ |
| **ë“œë˜ê·¸ ë°©í–¥ ì „ìš©** | `ForceArrowHandle.ts updateFromDrag()`: dragëŠ” ë°©í–¥ë§Œ ë³€ê²½, í¬ê¸°(initialMagnitude)ëŠ” ë¶ˆë³€ ìœ ì§€ |
| **PreProcessor ìë™ ì´ˆê¸°í™”** | `PreProcessPanel.svelte onMount` + `toggleBrush()` ì—ì„œ ë¯¸ì´ˆê¸°í™” ì‹œ ìë™ `initAnalysis()` í˜¸ì¶œ |
| **ë¹Œë“œ ê²€ì¦ (1ì°¨)** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### ì²™ì¶” ì˜¤ë¦¬ì—”í…Œì´ì…˜ ì •í™•í™” + ì›ì  ì¤‘ì‹¬í™” + Force BC êµ¬ ìœ„ì¹˜ ê°œì„  (2026-02-25)

**ë¬¸ì œ ë°œê²¬**: ìš”ì¶” ê°œë³„ STLì˜ ìµœì¥ì¶• = X (ì¢Œìš° í­, ~90mm) â‰  ìƒí•˜ ì¶• (Z, ~50mm).
1ì°¨ ìµœì¥ì¶• íƒì§€ ë¡œì§ì€ Xâ†’Y ì •ë ¬í•´ ì¢Œìš° í­ì„ ìˆ˜ì§ìœ¼ë¡œ ë§Œë“œëŠ” ì˜¤ë¥˜ ë°œìƒ.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì˜¤ë¦¬ì—”í…Œì´ì…˜ ë¡œì§ ìˆ˜ì •** | `SceneManager.ts autoOrientGeometry()`: ìµœì¥ì¶• íƒì§€ ì œê±°. CT Z(ìƒí•˜, scannerì¶•)â†’Y í•­ìƒ ì ìš©. `makeRotationX(-PI/2)` |
| **í•´ë¶€í•™ì  ê·¼ê±°** | L4 Z center=-1134 > L5 Z center=-1167 â†’ Zâ†’Y í›„ L4 Y > L5 Y â†’ L4 ìœ„(ë¨¸ë¦¬)/L5 ì•„ë˜(ë°œ) âœ“ |
| **ì›ì  ì¤‘ì‹¬í™”** | `loading.ts centerMeshesAtOrigin()`: ëª¨ë“  ëª¨ë¸ ë¡œë“œ+íšŒì „ í›„ combined bbox ì¤‘ì‹¬(-1149)ì„ (0,0,0)ìœ¼ë¡œ í‰í–‰ì´ë™ |
| **ìƒëŒ€ ìœ„ì¹˜ ë³´ì¡´** | ëª¨ë“  geometryì— ë™ì¼í•œ -center ì´ë™ ì ìš© â†’ L4/disc/L5 ê°„ê²©(32mm) ìœ ì§€ |
| **ì¤‘ì‹¬í™” ê²°ê³¼** | L4 Y centerâ‰ˆ+15, disc Yâ‰ˆ-4, L5 Y centerâ‰ˆ-18 â†’ ê·¸ë¦¬ë“œ(Y=0)ê°€ disc ìœ„ì— ìœ„ì¹˜ âœ“ |
| **Force êµ¬ ìœ„ì¹˜** | `PreProcessPanel toggle3DEdit()` í´ë°±: `box.max.y`(top face) â†’ `box.getCenter()`(ëª¨ë¸ ì¤‘ì‹¬) + ê²½ê³  í† ìŠ¤íŠ¸ |
| **Force êµ¬ ìš°ì„ ìˆœìœ„** | (1) ë¼ì´ë¸Œ ë¸ŒëŸ¬ì‰¬ centroid â†’ (2) forceBCOrigin(Apply Force BC í›„) â†’ (3) ëª¨ë¸ center + ê²½ê³  |
| **ìŠ¤ì¼€ì¼ ê³„ì‚° ìˆ˜ì •** | voxelMeshes ê¸°ì¤€ìœ¼ë¡œ bbox ê³„ì‚° (ì›ë³¸ STLì€ ë³µì…€í™” í›„ ìˆ¨ê²¨ì§) |
| **voxelMeshes import** | `PreProcessPanel.svelte`: `$lib/actions/loading` ì—ì„œ voxelMeshes import ì¶”ê°€ |
| **E2E ê²€ì¦** | ë¡œë“œ â†’ L4 ìœ„/L5 ì•„ë˜/disc ì¤‘ê°„ í™•ì¸ âœ“ Â· Apply Force BC ë²„íŠ¼ í™•ì¸ âœ“ Â· ì›ì  ì¤‘ì‹¬í™” í™•ì¸ âœ“ |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### Force BC ì›Œí¬í”Œë¡œìš° ê°œì„  â€” Apply ë¨¼ì €, ë°©í–¥ í¸ì§‘ ë‚˜ì¤‘ì— (2026-02-25)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **UI ì¬ë°°ì¹˜** | Step 2 Force BC ì„¹ì…˜: Apply ë²„íŠ¼ì„ ìµœìƒë‹¨ìœ¼ë¡œ ì´ë™, ë°©í–¥/í¬ê¸° í¸ì§‘ì€ Apply í›„ì—ë§Œ í‘œì‹œ |
| **ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ** | íŒíŠ¸: "1) ë¸ŒëŸ¬ì‰¬ë¡œ ì˜ì—­ ì„ íƒ â†’ 2) Apply â†’ 3) ë°©í–¥/í¬ê¸° í¸ì§‘" |
| **Apply í›„ ìë™ 3D í¸ì§‘** | `handleApplyForce()`: centroid ì €ì¥ í›„ ìë™ìœ¼ë¡œ `toggle3DEdit()` í˜¸ì¶œ â†’ í™”ì‚´í‘œ ì¦‰ì‹œ í‘œì‹œ |
| **ë¸ŒëŸ¬ì‰¬ ë¯¸ì„ íƒ ê°€ë“œ** | Apply í´ë¦­ ì‹œ brush count = 0ì´ë©´ "âš  ë¨¼ì € Brushë¡œ Force ì˜ì—­ì„ ì„ íƒí•˜ì„¸ìš”" ê²½ê³  |
| **ì¡°ê±´ë¶€ í¸ì§‘ ì„¹ì…˜** | `hasForceBC = $derived(forceBCOrigin !== null)` â†’ Apply ì „ì—ëŠ” ë°©í–¥/í¬ê¸° í¸ì§‘ ì™„ì „ ìˆ¨ê¹€ |
| **Force BC ì—…ë°ì´íŠ¸** | `handleUpdateForce()`: ë§ˆì§€ë§‰ BC ì‚­ì œ â†’ ìƒˆ ë°©í–¥/í¬ê¸°ë¡œ ì¬ì ìš© (ë°©í–¥ ë³€ê²½ ë°˜ì˜) |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

#### ìŠ¤í¬ë¥˜ 2í´ë¦­ ë°°ì¹˜ UX ê°œì„  (2026-02-25)

> **ë°°ê²½**: ì´ì „ ë“œë˜ê·¸ ë°©ì‹ì€ pointerdown~pointerup ì‚¬ì´ ì¹´ë©”ë¼ íšŒì „ ë¶ˆê°€, async STL ë¡œë“œ ê²½ìŸ ì¡°ê±´ ë“± UX ë¬¸ì œê°€ ìˆì—ˆìŒ.
> **ê°œì„ **: 2í´ë¦­(ì§„ì…ì â†’ì¹´ë©”ë¼ ììœ  íšŒì „â†’ëì ) ë°©ì‹ìœ¼ë¡œ ì „í™˜í•˜ì—¬ ì‚¬ìš©ì„± ëŒ€í­ í–¥ìƒ.

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìŠ¤í¬ë¥˜ 2í´ë¦­ ë°°ì¹˜** | 1ë‹¨ê³„: ë¼ˆ í‘œë©´ í´ë¦­ â†’ ì§„ì…ì  ì„¤ì • (ë…¸ë€ êµ¬ì²´ ë§ˆì»¤ í‘œì‹œ), ì¹´ë©”ë¼ ììœ  íšŒì „ ê°€ëŠ¥. 2ë‹¨ê³„: ëì  í´ë¦­ â†’ ì§„ì…ì â†’ëì  ë°©í–¥ìœ¼ë¡œ ìŠ¤í¬ë¥˜ ë°°ì¹˜ |
| **ImplantManager ë§ˆì»¤/í”„ë¦¬ë·°** | `showEntryMarker(pos)`: ë…¸ë€ êµ¬ì²´(r=1.5) í‘œì‹œ, `updatePreviewLine(target)`: ì§„ì…ì â†’ì»¤ì„œ ë¹¨ê°„ í”„ë¦¬ë·° ë¼ì¸, `hideEntryMarker()`: ë§ˆì»¤+ë¼ì¸ ì œê±°+GPU ë¦¬ì†ŒìŠ¤ í•´ì œ |
| **implantCatalog 2í´ë¦­ API** | `setEntryPoint()`: 1ë‹¨ê³„ ì§„ì…ì  ì €ì¥, `placeAtDirection()`: 2ë‹¨ê³„ ë°©í–¥ ë°°ì¹˜, `updateDirectionPreview()`: í”„ë¦¬ë·° ë¼ì¸ ì—…ë°ì´íŠ¸, `cancelScrewEntry()`: ì·¨ì†Œ, `hasEntryPoint()`/`getEntryPoint()`: ë‹¨ê³„ íŒë³„ |
| **Canvas3D ì´ë²¤íŠ¸ í”Œë¡œìš°** | implantPlace + screw: 1st click â†’ `setEntryPoint()`, 2nd click â†’ `placeAtDirection()`. pointermove: ì§„ì…ì  ì„¤ì • í›„ í”„ë¦¬ë·° ë¼ì¸ ì—…ë°ì´íŠ¸ (ë¼ˆ ë°–ì´ë©´ ì¹´ë©”ë¼ í‰ë©´ íˆ¬ì˜). ì¼€ì´ì§€: ê¸°ì¡´ ë‹¨ì¼ í´ë¦­ ë°°ì¹˜ ìœ ì§€ |
| **ì¹´ë©”ë¼ ììœ  íšŒì „** | 2í´ë¦­ ëª¨ë“œì—ì„œ OrbitControls ë¹„í™œì„±í™” ì—†ìŒ â€” ì§„ì…ì  ì„¤ì • í›„ ììœ ë¡­ê²Œ ì‹œì•¼ë¥¼ ëŒë ¤ ë°©í–¥ í™•ì¸ ê°€ëŠ¥ |
| **ë ˆì´ìºìŠ¤í„° ë³µì…€ ëŒ€ì‘** | `getIntersection()`ì— `voxelMeshes` ì¶”ê°€. ë³µì…€í™” í›„ ì›ë³¸ STL ë©”ì‰¬ê°€ `visible=false`ì´ë¯€ë¡œ ë³µì…€ ë©”ì‰¬ë„ ëŒ€ìƒì— í¬í•¨ |
| **ModelingPanel íŒíŠ¸** | ìŠ¤í¬ë¥˜: "ğŸ”© 1. ì§„ì…ì  í´ë¦­ â†’ ì¹´ë©”ë¼ íšŒì „ â†’ 2. ëì  í´ë¦­", ì¼€ì´ì§€: "ğŸ¦´ ë¼ˆ í‘œë©´ì„ í´ë¦­í•´ ë°°ì¹˜" |
| **E2E ê²€ì¦** | ìŠ¤í¬ë¥˜ 2í´ë¦­ ë°°ì¹˜ âœ“ Â· ì§„ì…ì  ë§ˆì»¤ í‘œì‹œ âœ“ Â· ì¹´ë©”ë¼ ììœ  íšŒì „ âœ“ Â· ì¼€ì´ì§€ í´ë¦­ ë°°ì¹˜ âœ“ Â· TransformControls âœ“ Â· ì¹´íƒˆë¡œê·¸ íƒ­ ì „í™˜ âœ“ Â· Placed Implants ëª©ë¡ âœ“ |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

**ìˆ˜ì • íŒŒì¼**:
- `src/frontend/src/lib/three/ImplantManager.svelte.ts` â€” ë“œë˜ê·¸ API ì œê±°, ì§„ì…ì  ë§ˆì»¤+í”„ë¦¬ë·° ë¼ì¸ API 3ê°œ ì¶”ê°€
- `src/frontend/src/lib/actions/implantCatalog.ts` â€” ë“œë˜ê·¸ í•¨ìˆ˜ ì œê±°, 2í´ë¦­ ë°°ì¹˜ í•¨ìˆ˜ 6ê°œ ì¶”ê°€
- `src/frontend/src/components/Canvas3D.svelte` â€” 2í´ë¦­ ì´ë²¤íŠ¸ í”Œë¡œìš° + ì¹´ë©”ë¼ í‰ë©´ íˆ¬ì˜ + `getEntryPoint` import ìˆ˜ì •
- `src/frontend/src/components/sidebar/ModelingPanel.svelte` â€” ìŠ¤í¬ë¥˜ ë°°ì¹˜ íŒíŠ¸ 2í´ë¦­ ë°©ì‹ìœ¼ë¡œ ë³€ê²½

#### ì—°ê²° ë¡œë“œ(Rod) ì¹´íƒˆë¡œê·¸ ì¶”ê°€ (2026-02-25)

| í•­ëª© | ë‚´ìš© |
|------|------|
| **Rod STL ìƒì„±** | `gen_implant_stls.py`ì— ROD_SPECS ì¶”ê°€ â€” 5ì¢… (40/50/60/80/100mm), Ã˜5.5mm ì›ê¸°ë‘¥, 16 segments |
| **ì¹´íƒˆë¡œê·¸ í•­ëª©** | `implantCatalog.ts`ì— rod 5ê°œ í•­ëª© ì¶”ê°€ â€” titanium ì¬ì§ˆ, `/stl/implants/rods/` ê²½ë¡œ |
| **2í´ë¦­ ë°°ì¹˜** | Canvas3Dì—ì„œ rodë„ screwì™€ ë™ì¼í•œ 2í´ë¦­(ì§„ì…ì â†’ëì ) ë°°ì¹˜ ì ìš© |
| **ModelingPanel UI** | Rod íƒ­ì— 5ê°œ í•­ëª© í‘œì‹œ, ğŸ”— ì•„ì´ì½˜ íŒíŠ¸, íŒŒë€ìƒ‰ [R] ë°°ì§€ ì¶”ê°€ |
| **E2E ê²€ì¦** | Rod íƒ­ í‘œì‹œ âœ“ Â· Rod 60 2í´ë¦­ ë°°ì¹˜ âœ“ Â· TransformControls âœ“ Â· Placed Implants ëª©ë¡ âœ“ |
| **ë¹Œë“œ ê²€ì¦** | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

**ìˆ˜ì •/ì‹ ê·œ íŒŒì¼**:
- `scripts/gen_implant_stls.py` â€” ROD_SPECS 5ì¢… + ë¡œë“œ STL ìƒì„± ë¡œì§ ì¶”ê°€
- `src/frontend/public/stl/implants/rods/` â€” rod_40~rod_100.stl 5ê°œ íŒŒì¼ ì‹ ê·œ
- `src/frontend/src/lib/actions/implantCatalog.ts` â€” rod ì¹´íƒˆë¡œê·¸ í•­ëª© 5ê°œ ì¶”ê°€
- `src/frontend/src/components/Canvas3D.svelte` â€” rod ì¹´í…Œê³ ë¦¬ 2í´ë¦­ ë°°ì¹˜ ì ìš©
- `src/frontend/src/components/sidebar/ModelingPanel.svelte` â€” rod íŒíŠ¸/ë°°ì§€ ì¶”ê°€

#### Material Library ì‹œìŠ¤í…œ (2026-02-25)

> **ë°°ê²½**: ê¸°ì¡´ ì¬ë£Œ ì‹œìŠ¤í…œì€ 4ê°œ í•˜ë“œì½”ë”© í”„ë¦¬ì…‹(bone/disc/ligament/titanium)ìœ¼ë¡œë§Œ êµ¬ì„±.
> ê³¨ë‹¤ê³µì¦(T-score â‰¤ -2.5), ë””ìŠ¤í¬ í‡´í–‰(Pfirrmann Grade III~V), ê²½í™”ê³¨, ë‹¤ì–‘í•œ ì„í”Œë€íŠ¸ ì¬ì§ˆ
> (PEEK, CoCr, 316L, UHMWPE) ë“± í™˜ìë³„ ë¬¼ì„± ë³€ì´ë¥¼ ë°˜ì˜í•  ìˆ˜ ì—†ì—ˆìŒ.
> ANSYS/Abaqus ìŠ¤íƒ€ì¼ Material Libraryë¥¼ êµ¬í˜„í•˜ì—¬ í•´ê²°.

**ì‹ ê·œ íŒŒì¼**:
- `src/frontend/src/lib/stores/materials.svelte.ts` â€” Material Library ìŠ¤í† ì–´ (17ì¢… ë¹ŒíŠ¸ì¸ + ì»¤ìŠ¤í…€ CRUD + localStorage)
- `src/frontend/src/components/sidebar/MaterialLibraryPanel.svelte` â€” ì¹´í…Œê³ ë¦¬ íƒ­ + ê²€ìƒ‰ + ì†ì„± í¸ì§‘ê¸° (ëŒ€ìˆ˜ E ìŠ¬ë¼ì´ë”)

**ìˆ˜ì • íŒŒì¼**:
- `src/frontend/src/lib/analysis/PreProcessor.ts` â€” ResolvedMaterial ì¸í„°í˜ì´ìŠ¤ ì¶”ê°€, materialAssignments íƒ€ì… ë³€ê²½ (string â†’ ResolvedMaterial)
- `src/frontend/src/lib/actions/analysis.ts` â€” assignMaterial ì‹œê·¸ë‹ˆì²˜ ë³€ê²½
- `src/frontend/src/components/sidebar/PreProcessPanel.svelte` â€” Step 3 â†’ MaterialLibraryPanel ì„ë² ë“œ
- `src/frontend/src/components/sidebar/SolvePanel.svelte` â€” ì¹´í…Œê³ ë¦¬ë³„ optgroup ë“œë¡­ë‹¤ìš´
- `src/server/services/auto_material.py` â€” SPINE_MATERIAL_DB ë³‘ë¦¬í•™ì  ì¬ë£Œ 12ì¢… ì¶”ê°€ (ì´ 20ì¢…)

**ì¬ë£Œ ì¹´í…Œê³ ë¦¬ (17ì¢…)**:
| ì¹´í…Œê³ ë¦¬ | ì¬ë£Œ |
|----------|------|
| Bone (5) | í”¼ì§ˆê³¨, í•´ë©´ê³¨, ê³¨ë‹¤ê³µì¦ í”¼ì§ˆê³¨, ê³¨ë‹¤ê³µì¦ í•´ë©´ê³¨, ê²½í™”ê³¨ |
| Disc (4) | ì •ìƒ ë””ìŠ¤í¬, í‡´í–‰ III, í‡´í–‰ IV, í‡´í–‰ V |
| Implant (5) | Ti-6Al-4V, PEEK, CoCr, 316L, UHMWPE |
| Soft Tissue (3) | ì¸ëŒ€, ì„íšŒí™” ì¸ëŒ€, ì—°ì¡°ì§ |

#### í•´ì„ íŒŒì´í”„ë¼ì¸ ì•ˆì •ì„± 9-Step ê°œì„  (2026-02-25)

> **ë°°ê²½**: ë°±ì—”ë“œ ì†”ë²„(FEM/PD/SPG)ëŠ” ì˜ êµ¬í˜„ë˜ì–´ ìˆì§€ë§Œ, í”„ë¡ íŠ¸ì—”ë“œâ†’ë°±ì—”ë“œ ì—°ê²°ë¶€ì—ì„œ
> ê²€ì¦ ë¶€ì¬, íƒ€ì„ì•„ì›ƒ/ì·¨ì†Œ ì—†ìŒ, WS ì—ëŸ¬ ë³µêµ¬ ë¶ˆì•ˆì •, ë©”ëª¨ë¦¬ ëˆ„ìˆ˜, DICOM UI ë¶€ì¬ ë“±ì˜
> ì•ˆì •ì„± ë¬¸ì œë¥¼ 9ê°œ Stepìœ¼ë¡œ ì¼ê´„ ê°œì„ .

##### Step 1 (P0): í•´ì„ ì‹¤í–‰ ì „ ì¢…í•© ê²€ì¦

| í•­ëª© | ë‚´ìš© |
|------|------|
| **canRun ê²Œí„°** | `analysis.svelte.ts`: BC > 0, ë¯¸ì‹¤í–‰, preProcessor ì´ˆê¸°í™” í™•ì¸ â†’ falseë©´ Run ë²„íŠ¼ ë¹„í™œì„±í™” |
| **validationErrors ê²Œí„°** | ì „ì²˜ë¦¬ê¸° ë¯¸ì´ˆê¸°í™”, BC ë¯¸ì„¤ì •, Fixed BC ì—†ìŒ ë“± ê²€ì¦ ì‹¤íŒ¨ ëª©ë¡ ë°˜í™˜ |
| **lastError / elapsedMs** | ë§ˆì§€ë§‰ ì—ëŸ¬ ë©”ì‹œì§€ + ì†Œìš” ì‹œê°„ ìƒíƒœ ì¶”ê°€ |
| **runAnalysis() ê°•í™”** | `analysis.ts`: ì„œë²„ ì „ì†¡ ì „ `validationErrors` í™•ì¸, 100ms íƒ€ì´ë¨¸ë¡œ ì†Œìš” ì‹œê°„ ì¶”ì  |
| **SolvePanel ê²€ì¦ UI** | ê²€ì¦ ì—ëŸ¬ ì£¼í™©ìƒ‰ ê²½ê³  ë°•ìŠ¤ + ë¹„í™œì„±í™” Run ë²„íŠ¼ + ì™„ë£Œ í›„ ì†Œìš” ì‹œê°„ í‘œì‹œ |

##### Step 5 (P0): Force BC ì…ë ¥ ê²€ì¦ ê°•í™”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **buildAnalysisRequest â†’ null** | `PreProcessor.ts`: ë°˜í™˜ íƒ€ì… `AnalysisRequest \| null`, ê²€ì¦ ì‹¤íŒ¨ ì‹œ null |
| **ê²€ì¦ í•­ëª©** | ë¹ˆ ë³µì…€ ê·¸ë¦¬ë“œ, BC 0ê°œ, Fixed BC ì—†ìŒ, Force ë²¡í„° ì°¨ì›â‰ 3, í¬ê¸° < 1e-6 |
| **toast í”¼ë“œë°±** | ê° ê²€ì¦ ì‹¤íŒ¨ ì‹œ í•œê¸€ ê²½ê³  ë©”ì‹œì§€ í† ìŠ¤íŠ¸ í‘œì‹œ |
| **í˜¸ì¶œì ìˆ˜ì •** | `runAnalysis()`: null ë°˜í™˜ ì‹œ ì¤‘ë‹¨ ì²˜ë¦¬ |

##### Step 2 (P1): í•´ì„ íƒ€ì„ì•„ì›ƒ + ì·¨ì†Œ ê¸°ëŠ¥

| í•­ëª© | ë‚´ìš© |
|------|------|
| **sendAnalysis()** | `client.ts`: `crypto.randomUUID()` ìš”ì²­ ID ìƒì„± + 10ë¶„ íƒ€ì„ì•„ì›ƒ ìë™ ì„¤ì • |
| **cancelAnalysis()** | í´ë¼ì´ì–¸íŠ¸: `cancel_analysis` WS ë©”ì‹œì§€ ì „ì†¡ + íƒ€ì„ì•„ì›ƒ ì •ë¦¬ |
| **ì„œë²„ í•¸ë“¤ëŸ¬** | `ws_handler.py`: `_running_tasks` ë”•ì…”ë„ˆë¦¬ë¡œ asyncio.Task ì¶”ì , `task.cancel()` í˜¸ì¶œ |
| **cancelled ë©”ì‹œì§€** | ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸: `CancelledError` ë°œìƒ ì‹œ `cancelled` ì‘ë‹µ ì „ì†¡ |
| **Cancel ë²„íŠ¼** | SolvePanel: í•´ì„ ì¤‘ì¼ ë•Œ "â¹ Cancel" ë²„íŠ¼ í‘œì‹œ |
| **íƒ€ì„ì•„ì›ƒ ì—ëŸ¬** | 10ë¶„ ì´ˆê³¼ ì‹œ ìë™ ì·¨ì†Œ + "ë©”ì‰¬ë¥¼ ë‹¨ìˆœí™”í•˜ê±°ë‚˜ ì„œë²„ í™•ì¸" ì•ˆë‚´ |

##### Step 3 (P1): WS ì—ëŸ¬ ë³µêµ¬ ê°•í™”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì—°ê²°** | `client.ts`: 2s â†’ 4s â†’ 8s â†’ 16s â†’ 30s (ìµœëŒ€), 5íšŒê¹Œì§€ ì‹œë„ |
| **WSStatus í™•ì¥** | `websocket.svelte.ts`: `'disconnected' \| 'connecting' \| 'connected' \| 'failed'` |
| **reconnectAttempt ì¶”ì ** | ì—°ê²° ì„±ê³µ ì‹œ ì¹´ìš´í„° ë¦¬ì…‹, ìµœëŒ€ ì´ˆê³¼ ì‹œ `setFailed()` |
| **resetReconnect()** | ìˆ˜ë™ ì¬ì—°ê²° ì‹œ ì¹´ìš´í„° ì´ˆê¸°í™” ë©”ì„œë“œ |

##### Step 4 (P1): SceneManager ë©”ëª¨ë¦¬ ê´€ë¦¬

| í•­ëª© | ë‚´ìš© |
|------|------|
| **dispose() ê°•í™”** | `SceneManager.ts`: ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì¤‘ë‹¨ + ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° + OrbitControls dispose |
| **ì”¬ ë¦¬ì†ŒìŠ¤ ì •ë¦¬** | traverse: Mesh/InstancedMesh/Line/Points geometry + material ì „ë¶€ dispose |
| **í…ìŠ¤ì²˜ ì •ë¦¬** | `_disposeMaterial()`: map, normalMap, roughnessMap, emissiveMap ë“± í…ìŠ¤ì²˜ í•´ì œ |
| **GPU ì»¨í…ìŠ¤íŠ¸** | `renderer.dispose()` + `renderer.forceContextLoss()` + ìº”ë²„ìŠ¤ DOM ì œê±° |

##### Step 6 (P2): í´ë¦¬í•‘ í‰ë©´ UI

| í•­ëª© | ë‚´ìš© |
|------|------|
| **PostProcessPanel ì„¹ì…˜** | Clip Plane: í™œì„±í™” í† ê¸€, ì¶•(X/Y/Z) ì„ íƒ, ìœ„ì¹˜ ìŠ¬ë¼ì´ë”(-1~1), ë°˜ì „ í† ê¸€ |
| **PostProcessor ì—°ë™** | `setClipPlane({ enabled, axis, position, invert })` í˜¸ì¶œ |
| **analysisState ë™ê¸°í™”** | `clipEnabled, clipAxis, clipPosition, clipInvert` ìƒíƒœ ê´€ë¦¬ |

##### Step 7 (P2): ê²°ê³¼ ë‚´ë³´ë‚´ê¸°

| í•­ëª© | ë‚´ìš© |
|------|------|
| **exportResultsCSV()** | `analysis.ts`: node, dx, dy, dz, von_mises_stress, damage ì—´ë¡œ CSV ìƒì„± |
| **_downloadBlob()** | Blob â†’ URL.createObjectURL â†’ a íƒœê·¸ í´ë¦­ â†’ URL í•´ì œ |
| **Export ë²„íŠ¼** | PostProcessPanel: "ğŸ“„ Export CSV" ë²„íŠ¼ |

##### Step 8 (P3): ViewPanel ê°•í™”

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ë Œë”ë§ ëª¨ë“œ** | Solid / Wire / Solid+Wire 3ì¢… í† ê¸€ (`_addWireOverlay` / `_clearWireOverlay`) |
| **ì™€ì´ì–´í”„ë ˆì„ ì˜¤ë²„ë ˆì´** | MeshBasicMaterial(wireframe, opacity=0.15) í´ë¡  ë©”ì‰¬ ì¶”ê°€ |
| **íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë”** | ëª¨ë¸ë³„ opacity 0.1~1.0 (depthWrite ìë™ ê´€ë¦¬) |
| **ì¡°ëª… ê°•ë„ ìŠ¬ë¼ì´ë”** | directional light intensity 0.0~2.0 |
| **ìŠ¤í¬ë¦°ìƒ· ìº¡ì²˜** | `renderer.domElement.toDataURL('image/png')` â†’ ìë™ ë‹¤ìš´ë¡œë“œ |

##### Step 9 (P1): CT DICOM ìë™ íŒŒì´í”„ë¼ì¸ UI

| í•­ëª© | ë‚´ìš© |
|------|------|
| **FilePanel DICOM ë²„íŠ¼** | "ğŸ¥ Load DICOM (CT/MRI)" â€” webkitdirectory í´ë” ì„ íƒ |
| **íŒŒì´í”„ë¼ì¸ ì§„í–‰ UI** | ë‹¨ê³„ë³„ ì§„í–‰ë¥  ë°” + í•œê¸€ ë‹¨ê³„ ì„¤ëª… (ì—…ë¡œë“œ/ì„¸ê·¸ë©˜í…Œì´ì…˜/ë©”ì‰¬ì¶”ì¶œ) |
| **ìë™ ë©”ì‰¬ ë¡œë“œ** | `pipeline.ts _loadPipelineMeshes()`: ê²°ê³¼ STL ê²½ë¡œ â†’ Three.js ìë™ ë¡œë“œ + ë³µì…€í™” |
| **loadSTLFromURL()** | `loading.ts`: ì„œë²„ ê²½ë¡œ fetch â†’ STLLoader.parse â†’ CT ì¢Œí‘œ íšŒì „(-PI/2) â†’ ì”¬ ì¶”ê°€ |
| **_autoColor()** | êµ¬ì¡°ëª… ê¸°ë°˜ ìë™ ìƒ‰ìƒ: discâ†’ì£¼í™©, L*â†’ë² ì´ì§€, C*â†’ì²­ë¡, T*â†’íšŒì²­ |
| **ì›Œí¬í”Œë¡œìš°** | DICOM ì„ íƒ â†’ REST ì—…ë¡œë“œ â†’ WS 3ë‹¨ê³„ ìë™ ì‹¤í–‰ â†’ ë©”ì‰¬ ìë™ ë¡œë“œ â†’ ë°”ë¡œ ì‘ì—… ê°€ëŠ¥ |

##### ìˆ˜ì • íŒŒì¼ ì´ê´„ (9 Step)

| íŒŒì¼ | Step | ë³€ê²½ ë‚´ìš© |
|------|------|----------|
| `lib/stores/analysis.svelte.ts` | 1 | `canRun`, `validationErrors`, `lastError`, `elapsedMs` |
| `lib/actions/analysis.ts` | 1, 2, 7 | `runAnalysis()` ê²€ì¦ + `cancelAnalysis()` + `exportResultsCSV()` |
| `components/sidebar/SolvePanel.svelte` | 1, 2 | ê²€ì¦ UI + Cancel ë²„íŠ¼ + ì†Œìš” ì‹œê°„ |
| `lib/ws/client.ts` | 2, 3 | íƒ€ì„ì•„ì›ƒ/ì·¨ì†Œ + ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì—°ê²° |
| `lib/ws/types.ts` | 2 | `cancelled` ë©”ì‹œì§€ íƒ€ì… + `CancelledCallback` |
| `lib/stores/websocket.svelte.ts` | 3 | WSStatus í™•ì¥ + reconnectAttempt |
| `server/ws_handler.py` | 2 | `cancel_analysis` í•¸ë“¤ëŸ¬ + asyncio.Task ì¶”ì  |
| `lib/three/SceneManager.ts` | 4 | `dispose()` ì „ë©´ ê°•í™” |
| `lib/analysis/PreProcessor.ts` | 5 | `buildAnalysisRequest()` â†’ null ë°˜í™˜ ê²€ì¦ |
| `components/sidebar/PostProcessPanel.svelte` | 6, 7 | í´ë¦¬í•‘ í‰ë©´ UI + Export CSV ë²„íŠ¼ |
| `components/sidebar/ViewPanel.svelte` | 8 | ë Œë”ë§ ëª¨ë“œ + íˆ¬ëª…ë„ + ì¡°ëª… + ìŠ¤í¬ë¦°ìƒ· |
| `components/sidebar/FilePanel.svelte` | 9 | DICOM ì—…ë¡œë“œ + íŒŒì´í”„ë¼ì¸ ì§„í–‰ UI |
| `lib/actions/pipeline.ts` | 9 | ê²°ê³¼ ë©”ì‰¬ ìë™ ë¡œë“œ ì½œë°± |
| `lib/actions/loading.ts` | 9 | `loadSTLFromURL()` + `_autoColor()` |
| **ë¹Œë“œ ê²€ì¦** | ì „ì²´ | `npm run build` â†’ 0 ì˜¤ë¥˜, 0 ê²½ê³  âœ… |

